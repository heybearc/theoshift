"use strict";(()=>{var e={};e.id=5097,e.ids=[5097,660],e.modules={481:(e,t,a)=>{a.r(t),a.d(t,{config:()=>O,default:()=>T,getServerSideProps:()=>q,getStaticPaths:()=>z,getStaticProps:()=>U,reportWebVitals:()=>Z,routeModule:()=>L,unstable_getServerProps:()=>I,unstable_getServerSideProps:()=>_,unstable_getStaticParams:()=>B,unstable_getStaticPaths:()=>M,unstable_getStaticProps:()=>D});var n={};a.r(n),a.d(n,{default:()=>$,getServerSideProps:()=>F});var s=a(7093),r=a(5244),i=a(1323),o=a(2899),l=a.n(o),c=a(6814),d=a(997),u=a(3227),p=a(6847),g=a(6689),h=a(1163),m=a(1649),x=a(968),f=a.n(x),v=a(1664),j=a.n(v);class S{async getAttendants(e){let t=new URLSearchParams;e.page&&t.append("page",e.page.toString()),e.limit&&t.append("limit",e.limit.toString()),e.search&&t.append("search",e.search),e.congregation&&t.append("congregation",e.congregation),e.formsOfService?.length&&t.append("formsOfService",e.formsOfService.join(",")),void 0!==e.isActive&&t.append("isActive",e.isActive.toString()),void 0!==e.hasUser&&t.append("hasUser",e.hasUser.toString()),e.includeStats&&t.append("includeStats","true");let a=await fetch(`${this.baseUrl}?${t}`);if(!a.ok)throw Error(`Failed to fetch attendants: ${a.statusText}`);return a.json()}async getAttendant(e){let t=await fetch(`${this.baseUrl}/${e}`);if(!t.ok)throw Error(`Failed to fetch attendant: ${t.statusText}`);return t.json()}async createAttendant(e){let t=await fetch(this.baseUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json()).error||"Failed to create attendant");return t.json()}async updateAttendant(e,t){let a=await fetch(`${this.baseUrl}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw Error((await a.json()).error||"Failed to update attendant");return a.json()}async deleteAttendant(e){let t=await fetch(`${this.baseUrl}/${e}`,{method:"DELETE"});if(!t.ok)throw Error((await t.json()).error||"Failed to delete attendant");return t.json()}async bulkImport(e){let t=await fetch(this.baseUrl,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json();throw console.error("Bulk import error:",e),Error(e.error||`Failed to import attendants (${t.status}: ${t.statusText})`)}return t.json()}async getEventAttendants(e,t){let a=new URLSearchParams({eventId:e});t?.page&&a.append("page",t.page.toString()),t?.limit&&a.append("limit",t.limit.toString()),t?.search&&a.append("search",t.search),t?.congregation&&a.append("congregation",t.congregation),t?.formsOfService?.length&&a.append("formsOfService",t.formsOfService.join(",")),t?.isActive!==void 0&&a.append("isActive",t.isActive.toString()),t?.hasUser!==void 0&&a.append("hasUser",t.hasUser.toString()),t?.includeStats&&a.append("includeStats","true");let n=await fetch(`${this.baseUrl}?${a}`);if(!n.ok)throw Error(`Failed to fetch event attendants: ${n.statusText}`);return n.json()}async addAttendantToEvent(e,t){let a=await fetch(`/api/event-attendants/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({attendantIds:[t]})});if(!a.ok)throw Error((await a.json()).error||"Failed to add attendant to event");return a.json()}async removeAttendantFromEvent(e,t){let a=await fetch(`/api/event-attendants/${e}/${t}`,{method:"DELETE"});if(!a.ok)throw Error((await a.json()).error||"Failed to remove attendant from event");return a.json()}constructor(){this.baseUrl="/api/attendants"}}let b=new S;var y=a(2085),w=a(6603),k=a(2808),N=a(9939),E=a(9470),A=a(1571);function P({eventId:e,eventName:t}){(0,h.useRouter)();let{data:a}=(0,m.useSession)(),[n,s]=(0,g.useState)(!1),[r,i]=(0,g.useState)(!1),[o,l]=(0,g.useState)(null),[c,u]=(0,g.useState)([]),[p,x]=(0,g.useState)([]),{attendants:v,loading:S,error:P,pagination:C,stats:$,filters:F,setFilters:T,setPage:U,setPageSize:z,refresh:q,createAttendant:O,updateAttendant:Z,deleteAttendant:D}=function(e={}){let{eventId:t,initialFilters:a={},pageSize:n=10,includeStats:s=!1}=e,[r,i]=(0,g.useState)([]),[o,l]=(0,g.useState)(!0),[c,d]=(0,g.useState)(null),[u,p]=(0,g.useState)(),[h,m]=(0,g.useState)(a),[x,f]=(0,g.useState)({page:1,limit:n,total:0,pages:0}),v=(0,g.useCallback)(async()=>{try{console.log("fetchAttendants called with:"),console.log("- eventId:",t),console.log("- pagination:",x),console.log("- filters:",h),l(!0),d(null);let e=t?await b.getEventAttendants(t,{...h,page:x.page,limit:x.limit,includeStats:s}):await b.getAttendants({...h,page:x.page,limit:x.limit,includeStats:s});console.log("API response:",e),console.log("Attendants returned:",e.data?.attendants?.length||0),e.success?(i(e.data.attendants),f(e.data.pagination),e.data.stats&&p(e.data.stats)):d(e.error||"Failed to fetch attendants")}catch(e){d(e instanceof Error?e.message:"An error occurred")}finally{l(!1)}},[t,h,x.page,x.limit,s]),j=(0,g.useCallback)(e=>{console.log("Setting page to:",e),f(t=>{let a={...t,page:e};return console.log("New pagination state:",a),a})},[]),S=(0,g.useCallback)(e=>{console.log("Setting page size to:",e),f(t=>{let a={...t,limit:-1===e?999999:e,page:1};return console.log("New pagination state:",a),a})},[]),y=(0,g.useCallback)(async()=>{await v()},[v]),w=(0,g.useCallback)(async e=>{try{d(null);let t=await b.createAttendant(e);if(t.success)await y();else throw Error(t.error||"Failed to create attendant")}catch(t){let e=t instanceof Error?t.message:"Failed to create attendant";throw d(e),Error(e)}},[y]),k=(0,g.useCallback)(async(e,t)=>{try{d(null);let a=await b.updateAttendant(e,t);if(a.success)await y();else throw Error(a.error||"Failed to update attendant")}catch(t){let e=t instanceof Error?t.message:"Failed to update attendant";throw d(e),Error(e)}},[y]),N=(0,g.useCallback)(async e=>{try{if(d(null),(await b.deleteAttendant(e)).success)await y();else throw Error("Failed to delete attendant")}catch(t){let e=t instanceof Error?t.message:"Failed to delete attendant";throw d(e),Error(e)}},[y]);return{attendants:r,loading:o,error:c,pagination:x,stats:u,filters:h,setFilters:m,setPage:j,setPageSize:S,refresh:y,createAttendant:w,updateAttendant:k,deleteAttendant:N}}({eventId:e,pageSize:25,includeStats:!0}),M=async e=>{o?await Z(o.id,e):await O(e),l(null)},B=async e=>{try{let t=await b.bulkImport(e);return await q(),t.data}catch(e){throw console.error("Bulk import error:",e),e}},I=async(e,t)=>{try{let a=e.map(e=>b.updateAttendant(e,{isActive:t}));await Promise.all(a),await q(),u([])}catch(e){throw console.error("Bulk status change error:",e),e}},_=async e=>{confirm("Are you sure you want to delete this attendant? This action cannot be undone.")&&(await D(e),u(t=>t.filter(t=>t!==e)))},L=async()=>{if(0!==c.length&&confirm(`Are you sure you want to delete ${c.length} attendant(s)? This action cannot be undone.`))try{await Promise.all(c.map(e=>D(e))),u([])}catch(e){console.error("Error deleting attendants:",e)}},J=e?`${t||"Event"} - Attendants`:"Attendant Management";return(0,d.jsxs)(d.Fragment,{children:[d.jsx(f(),{children:(0,d.jsxs)("title",{children:[J," | JW Attendant Scheduler"]})}),(0,d.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,d.jsxs)("div",{className:"mb-8",children:[e&&(0,d.jsxs)("nav",{className:"flex items-center space-x-2 text-sm text-gray-500 mb-4",children:[d.jsx(j(),{href:"/events",className:"hover:text-gray-700",children:"Events"}),d.jsx("span",{children:"›"}),d.jsx(j(),{href:`/events/${e}`,className:"hover:text-gray-700",children:t||"Event"}),d.jsx("span",{children:"›"}),d.jsx("span",{className:"text-gray-900",children:"Attendants"})]}),(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[d.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:e?"Event Attendants":"Attendant Management"}),d.jsx("p",{className:"text-gray-600 mt-2",children:e?`Manage attendants for ${t}`:"Manage all attendants across the organization"})]}),(0,d.jsxs)("div",{className:"flex space-x-3",children:[e&&d.jsx(j(),{href:`/events/${e}`,className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium transition-colors",children:"← Back to Event"}),d.jsx(A.Z,{onClick:()=>i(!0),variant:"secondary",children:"\uD83D\uDCE5 Bulk Import"}),d.jsx(A.Z,{onClick:()=>{l(null),s(!0)},variant:"primary",children:"+ Add Attendant"})]})]})]}),P&&d.jsx("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-md p-4",children:(0,d.jsxs)("div",{className:"flex",children:[d.jsx("svg",{className:"w-5 h-5 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,d.jsxs)("div",{className:"ml-3",children:[d.jsx("h4",{className:"text-sm font-medium text-red-800",children:"Error"}),d.jsx("p",{className:"text-sm text-red-700 mt-1",children:P})]})]})}),$&&!S&&d.jsx("div",{className:"mb-6",children:d.jsx(E.Z,{stats:$})}),d.jsx("div",{className:"mb-6",children:d.jsx(y.Z,{filters:F,onFiltersChange:T,congregations:p,loading:S})}),c.length>0&&d.jsx("div",{className:"mb-6 bg-blue-50 border border-blue-200 rounded-md p-4",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center",children:[d.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,d.jsxs)("span",{className:"ml-2 text-sm font-medium text-blue-800",children:[c.length," attendant(s) selected"]})]}),(0,d.jsxs)("div",{className:"flex flex-wrap gap-2",children:[d.jsx(A.Z,{onClick:()=>u([]),variant:"secondary",size:"sm",children:"Clear Selection"}),d.jsx(A.Z,{onClick:()=>I(c,!0),variant:"primary",size:"sm",children:"Activate Selected"}),d.jsx(A.Z,{onClick:()=>I(c,!1),variant:"secondary",size:"sm",children:"Deactivate Selected"}),d.jsx(A.Z,{onClick:L,variant:"danger",size:"sm",children:"Delete Selected"})]})]})}),d.jsx("div",{className:"mb-6",children:d.jsx(w.Z,{attendants:v,loading:S,onEdit:e=>{l(e),s(!0)},onDelete:_,onSelect:u,selectedIds:c,onBulkStatusChange:I})}),(0,d.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 py-4 bg-white rounded-lg shadow px-4",children:[(0,d.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[(0,d.jsxs)("div",{className:"text-sm text-gray-700",children:["Showing ",(C.page-1)*C.limit+1," to"," ",Math.min(C.page*C.limit,C.total)," of"," ",C.total," results"]}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[d.jsx("label",{htmlFor:"pageSize",className:"text-sm text-gray-700",children:"Show:"}),(0,d.jsxs)("select",{id:"pageSize",value:999999===C.limit?-1:C.limit,onChange:e=>{console.log("Select changed, setPageSize function:",typeof z),console.log("New value:",e.target.value),e.preventDefault(),z(Number(e.target.value))},disabled:S,className:"border border-gray-300 rounded-md px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[d.jsx("option",{value:10,children:"10"}),d.jsx("option",{value:25,children:"25"}),d.jsx("option",{value:50,children:"50"}),d.jsx("option",{value:100,children:"100"}),d.jsx("option",{value:-1,children:"All"})]}),d.jsx("span",{className:"text-sm text-gray-700",children:"per page"})]}),d.jsx(A.Z,{onClick:()=>{console.log("DEBUG: Test button clicked!"),console.log("setPageSize type:",typeof z),console.log("Current pagination:",C),z(50)},variant:"primary",size:"sm",type:"button",children:"Test Button (Set to 50)"})]}),C.pages>1&&(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[d.jsx(A.Z,{onClick:()=>{console.log("Previous button clicked, setPage function:",typeof U),console.log("Current pagination:",C),U(C.page-1)},disabled:C.page<=1||S,variant:"secondary",size:"sm",type:"button",children:"Previous"}),(0,d.jsxs)("span",{className:"px-3 py-1 text-sm text-gray-700",children:["Page ",C.page," of ",C.pages]}),d.jsx(A.Z,{onClick:()=>{console.log("Next button clicked, setPage function:",typeof U),console.log("Current pagination:",C),U(C.page+1)},disabled:C.page>=C.pages||S,variant:"secondary",size:"sm",type:"button",children:"Next"})]})]})]}),d.jsx(k.Z,{isOpen:n,onClose:()=>{s(!1),l(null)},onSave:M,attendant:o}),d.jsx(N.Z,{isOpen:r,onClose:()=>i(!1),onImport:B,eventId:e})]})}var C=a(9927);function $(){return d.jsx(C.Z,{title:"Attendant Management | JW Attendant Scheduler",breadcrumbs:[{label:"Home",href:"/events"},{label:"Attendants"}],children:d.jsx(P,{})})}let F=async e=>{let t=await (0,u.getServerSession)(e.req,e.res,p.L);return t?["ADMIN","OVERSEER"].includes(t.user?.role||"")?{props:{}}:{redirect:{destination:"/events",permanent:!1}}:{redirect:{destination:"/auth/signin",permanent:!1}}},T=(0,i.l)(n,"default"),U=(0,i.l)(n,"getStaticProps"),z=(0,i.l)(n,"getStaticPaths"),q=(0,i.l)(n,"getServerSideProps"),O=(0,i.l)(n,"config"),Z=(0,i.l)(n,"reportWebVitals"),D=(0,i.l)(n,"unstable_getStaticProps"),M=(0,i.l)(n,"unstable_getStaticPaths"),B=(0,i.l)(n,"unstable_getStaticParams"),I=(0,i.l)(n,"unstable_getServerProps"),_=(0,i.l)(n,"unstable_getServerSideProps"),L=new s.PagesRouteModule({definition:{kind:r.x.PAGES,page:"/attendants",pathname:"/attendants",bundlePath:"",filename:""},components:{App:c.default,Document:l()},userland:n})},3524:e=>{e.exports=require("@prisma/client")},8432:e=>{e.exports=require("bcryptjs")},3227:e=>{e.exports=require("next-auth")},7449:e=>{e.exports=require("next-auth/providers/credentials")},1649:e=>{e.exports=require("next-auth/react")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{e.exports=require("next/head")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},6162:e=>{e.exports=require("stream")},1568:e=>{e.exports=require("zlib")}};var t=require("../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),n=t.X(0,[2899,8342,1664,4937],()=>a(481));module.exports=n})();