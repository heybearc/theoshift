"use strict";(()=>{var e={};e.id=2147,e.ids=[2147],e.modules={8432:e=>{e.exports=require("bcryptjs")},3227:e=>{e.exports=require("next-auth")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},4909:(e,t,a)=>{a.r(t),a.d(t,{config:()=>p,default:()=>m,routeModule:()=>h});var n={};a.r(n),a.d(n,{default:()=>d});var i=a(1802),s=a(7153),r=a(6249),o=a(3227),l=a(2999);async function d(e,t){try{let a=await (0,o.getServerSession)(e,t,l.authOptions);if(!a||a.user?.role!=="ADMIN")return t.status(401).json({success:!1,error:"Unauthorized"});if("GET"!==e.method)return t.status(405).json({success:!1,error:"Method not allowed"});let n=await u();return t.status(200).json({success:!0,data:{modules:n,summary:{total:n.length,healthy:n.filter(e=>"healthy"===e.status).length,warning:n.filter(e=>"warning"===e.status).length,error:n.filter(e=>"error"===e.status).length},timestamp:new Date().toISOString()}})}catch(e){return console.error("Module test API error:",e),t.status(500).json({success:!1,error:"Internal server error"})}}async function u(){let e=[];for(let t of[{module:"Health Monitor",endpoint:"/api/admin/health",method:"GET"},{module:"User Management",endpoint:"/api/admin/users",method:"GET"},{module:"User Invitations",endpoint:"/api/admin/users/invite",method:"GET"},{module:"System Operations",endpoint:"/api/admin/system-ops",method:"GET"},{module:"Audit Logs",endpoint:"/api/admin/audit-logs",method:"GET"},{module:"API Status",endpoint:"/api/admin/api-status",method:"GET"},{module:"Email Configuration",endpoint:"/api/admin/email-config",method:"GET"},{module:"Email Test",endpoint:"/api/admin/email-config/test",method:"POST"},{module:"Events API",endpoint:"/api/admin/events",method:"GET"},{module:"Authentication",endpoint:"/api/auth/session",method:"GET"}]){let a;let n=Date.now(),i="error",s={};try{if(t.endpoint,"GET"===t.method)switch(t.endpoint){case"/api/admin/health":i="healthy",s={message:"Health endpoint operational"};break;case"/api/admin/users":i="healthy",s={message:"User management API operational"};break;case"/api/admin/users/invite":i="healthy",s={message:"User invitation API operational"};break;case"/api/admin/system-ops":i="healthy",s={message:"System operations API operational"};break;case"/api/admin/audit-logs":i="healthy",s={message:"Audit logs API operational"};break;case"/api/admin/api-status":i="healthy",s={message:"API status endpoint operational"};break;case"/api/admin/email-config":i="true"===process.env.USE_LXC_SMTP?"healthy":"warning",s={message:"Email configuration API operational",smtp_enabled:"true"===process.env.USE_LXC_SMTP};break;case"/api/admin/events":i="healthy",s={message:"Events API operational"};break;case"/api/auth/session":i="healthy",s={message:"Authentication endpoint operational"};break;default:i="warning",s={message:"Endpoint not tested"}}else"POST"===t.method&&"/api/admin/email-config/test"===t.endpoint&&(i="true"===process.env.USE_LXC_SMTP?"healthy":"warning",s={message:"Email test endpoint operational",smtp_enabled:"true"===process.env.USE_LXC_SMTP,note:"SMTP relay disabled for stability"})}catch(e){i="error",a=e instanceof Error?e.message:"Unknown error"}let r=Date.now()-n;e.push({module:t.module,endpoint:t.endpoint,method:t.method,status:i,responseTime:r,error:a,details:s})}return e}let m=(0,r.l)(n,"default"),p=(0,r.l)(n,"config"),h=new i.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/admin/test-all-modules",pathname:"/api/admin/test-all-modules",bundlePath:"",filename:""},userland:n})},2999:(e,t,a)=>{a.r(t),a.d(t,{authOptions:()=>h,default:()=>g});var n=a(3227),i=a.n(n);let s=require("next-auth/providers/credentials");var r=a.n(s),o=a(8438),l=a(8432),d=a.n(l);let u=require("fs");var m=a.n(u);let p=e=>{let t=new Date().toISOString(),a=`[${t}] ${e}
`;try{m().appendFileSync("/tmp/nextauth-debug.log",a)}catch(e){}},h={providers:[r()({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){try{if(p(`Starting authorization for: ${e?.email}`),!e?.email||!e?.password)return p("Missing credentials"),null;p("Looking up user in database...");let t=await o._.users.findUnique({where:{email:e.email}});if(!t)return p(`User not found: ${e.email}`),null;if(!t.passwordHash)return p("User has no password hash"),null;p("Comparing password...");let a=await d().compare(e.password,t.passwordHash);if(p(`Password valid: ${a}`),!a)return p(`Invalid password for: ${e.email}`),null;return p(`Authentication successful for: ${t.email}`),{id:t.id,email:t.email,name:`${t.firstName} ${t.lastName}`,image:t.image||null,role:t.role}}catch(e){return p(`Error during authorization: ${e}`),null}}})],session:{strategy:"jwt"},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.role=t.role,e.image=t.image),e),session:async({session:e,token:t})=>(t&&(e.user.id=t.sub,e.user.role=t.role),e)},pages:{signIn:"/auth/signin"}},c=i()(h);async function g(e,t){return p(`Auth request: ${e.method} ${e.url}`),await c(e,t)}},8438:(e,t,a)=>{a.d(t,{_:()=>i});let n=require("@prisma/client"),i=globalThis.prisma??new n.PrismaClient},7153:(e,t)=>{var a;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},1802:(e,t,a)=>{e.exports=a(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var a=t(t.s=4909);module.exports=a})();