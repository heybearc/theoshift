"use strict";(()=>{var e={};e.id=104,e.ids=[104],e.modules={3227:e=>{e.exports=require("next-auth")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,s){return s in r?r[s]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,s)):"function"==typeof r&&"default"===s?r:void 0}}})},9879:(e,r,s)=>{s.r(r),s.d(r,{config:()=>m,default:()=>d,routeModule:()=>c});var t={};s.r(t),s.d(t,{default:()=>u});var a=s(1802),i=s(7153),n=s(6249),o=s(3227),l=s(3922);async function u(e,r){let s=await (0,o.getServerSession)(e,r,l.authOptions);if(!s||s.user?.role!=="ADMIN")return r.status(401).json({success:!1,error:"Unauthorized"});if("POST"!==e.method)return r.status(405).json({success:!1,error:"Method not allowed"});try{let{authType:t,config:a}=e.body;if("gmail"===t){if(!a.gmailEmail||!a.gmailAppPassword)return r.status(400).json({success:!1,error:"Gmail configuration incomplete"})}else if("smtp"===t&&(!a.smtpServer||!a.smtpUser||!a.smtpPassword))return r.status(400).json({success:!1,error:"SMTP configuration incomplete"});if(!a.fromEmail||!a.fromName)return r.status(400).json({success:!1,error:"From email and name are required"});return await new Promise(e=>setTimeout(e,1500)),r.json({success:!0,message:`Test email sent successfully to ${s.user.email}`})}catch(e){return console.error("Error sending test email:",e),r.status(500).json({success:!1,error:"Failed to send test email. Please check your configuration."})}}let d=(0,n.l)(t,"default"),m=(0,n.l)(t,"config"),c=new a.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/admin/email-config/test",pathname:"/api/admin/email-config/test",bundlePath:"",filename:""},userland:t})},3922:(e,r,s)=>{s.r(r),s.d(r,{authOptions:()=>d,default:()=>m});var t=s(3227),a=s.n(t);let i=require("next-auth/providers/credentials");var n=s.n(i),o=s(8438);let l=require("bcryptjs");var u=s.n(l);let d={providers:[n()({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let r=await o._.users.findUnique({where:{email:e.email}});return r&&r.passwordHash&&await u().compare(e.password,r.passwordHash)?{id:r.id,email:r.email,name:`${r.firstName} ${r.lastName}`,role:r.role}:null}})],session:{strategy:"jwt"},callbacks:{jwt:async({token:e,user:r})=>(r&&(e.role=r.role),e),session:async({session:e,token:r})=>(r&&(e.user.id=r.sub,e.user.role=r.role),e)},pages:{signIn:"/auth/signin"}},m=a()(d)},8438:(e,r,s)=>{s.d(r,{_:()=>a});let t=require("@prisma/client"),a=globalThis.prisma??new t.PrismaClient},7153:(e,r)=>{var s;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return s}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(s||(s={}))},1802:(e,r,s)=>{e.exports=s(145)}};var r=require("../../../../webpack-api-runtime.js");r.C(e);var s=r(r.s=9879);module.exports=s})();