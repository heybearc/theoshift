"use strict";(()=>{var e={};e.id=5994,e.ids=[5994],e.modules={3524:e=>{e.exports=require("@prisma/client")},8432:e=>{e.exports=require("bcryptjs")},3227:e=>{e.exports=require("next-auth")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,n){return n in t?t[n]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,n)):"function"==typeof t&&"default"===n?t:void 0}}})},3789:(e,t,n)=>{n.r(t),n.d(t,{config:()=>h,default:()=>m,routeModule:()=>v});var r={};n.r(r),n.d(r,{default:()=>l});var a=n(1802),s=n(7153),i=n(6249),o=n(3227),d=n(3515),u=n(4507);async function l(e,t){let{id:n,attendantId:r}=e.query;if(!n||"string"!=typeof n)return t.status(400).json({error:"Event ID is required"});if(!r||"string"!=typeof r)return t.status(400).json({error:"Attendant ID is required"});let a=await (0,o.getServerSession)(e,t,d.authOptions);if(!a||!a.user)return t.status(401).json({error:"Unauthorized"});try{if(!await u._.events.findUnique({where:{id:n}}))return t.status(404).json({error:"Event not found"});if("GET"===e.method)return await c(e,t,n,r);if("PUT"===e.method)return await f(e,t,n,r);if("DELETE"===e.method)return await p(e,t,n,r);return t.setHeader("Allow",["GET","PUT","DELETE"]),t.status(405).json({error:"Method not allowed"})}catch(e){return console.error("Attendant API error:",e),t.status(500).json({error:"Internal server error"})}}async function c(e,t,n,r){try{let e=await u._.attendants.findUnique({where:{id:r}});if(!e)return t.status(404).json({error:"Attendant not found"});if(!await u._.event_attendant_associations.findFirst({where:{eventId:n,attendantId:r}}))return t.status(404).json({error:"Attendant not associated with this event"});return t.status(200).json({success:!0,data:{id:e.id,firstName:e.firstName,lastName:e.lastName,email:e.email,phone:e.phone,congregation:e.congregation||"",formsOfService:e.formsOfService||[],isActive:!1!==e.isActive,notes:e.notes,userId:e.userId,createdAt:e.createdAt,updatedAt:e.updatedAt}})}catch(e){return console.error("Get attendant error:",e),t.status(500).json({error:"Failed to fetch attendant"})}}async function f(e,t,n,r){try{let{firstName:a,lastName:s,email:i,phone:o,congregation:d,notes:l,formsOfService:c,isActive:f}=e.body;if(console.log(`ðŸ”§ API Update attendant ${r}:`,{firstName:a,lastName:s,isActive:f,congregation:d,formsOfService:c}),!await u._.attendants.findUnique({where:{id:r}}))return console.error(`âŒ Attendant not found: ${r}`),t.status(404).json({error:"Attendant not found"});if(!await u._.event_attendant_associations.findFirst({where:{eventId:n,attendantId:r}}))return console.error(`âŒ Attendant ${r} not associated with event ${n}`),t.status(404).json({error:"Attendant not associated with this event"});let p=[];c&&(Array.isArray(c)?p=c:"string"==typeof c&&(p=c.split(",").map(e=>e.trim()).filter(e=>""!==e)));let m={};void 0!==a&&(m.firstName=a),void 0!==s&&(m.lastName=s),void 0!==i&&(m.email=i),void 0!==o&&(m.phone=o||null),void 0!==l&&(m.notes=l||null),void 0!==d&&(m.congregation=d||""),p.length>0&&(m.formsOfService=p),void 0!==f&&(m.isActive=f,console.log(`ðŸ”§ Setting isActive to: ${f} (type: ${typeof f})`)),m.updatedAt=new Date,console.log(`ðŸ“¡ Updating attendant ${r} with data:`,m);let h=await u._.attendants.update({where:{id:r},data:m});return console.log(`âœ… Successfully updated attendant ${r}:`,{isActive:h.isActive,congregation:h.congregation}),t.status(200).json({success:!0,data:{id:h.id,firstName:h.firstName,lastName:h.lastName,email:h.email,phone:h.phone,congregation:h.congregation||"",formsOfService:h.formsOfService||[],isActive:!1!==h.isActive,notes:h.notes,userId:h.userId,createdAt:h.createdAt,updatedAt:h.updatedAt}})}catch(e){return console.error("Update attendant error:",e),t.status(500).json({error:"Failed to update attendant"})}}async function p(e,t,n,r){try{if(!await u._.attendants.findUnique({where:{id:r}}))return t.status(404).json({error:"Attendant not found"});await u._.event_attendant_associations.deleteMany({where:{eventId:n,attendantId:r}});let e=await u._.event_attendant_associations.findMany({where:{attendantId:r}});return 0===e.length&&await u._.attendants.delete({where:{id:r}}),t.status(200).json({success:!0,message:"Attendant removed from event"})}catch(e){return console.error("Delete attendant error:",e),t.status(500).json({error:"Failed to delete attendant"})}}let m=(0,i.l)(r,"default"),h=(0,i.l)(r,"config"),v=new a.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/events/[id]/attendants/[attendantId]",pathname:"/api/events/[id]/attendants/[attendantId]",bundlePath:"",filename:""},userland:r})},3515:(e,t,n)=>{n.r(t),n.d(t,{authOptions:()=>l,default:()=>c});var r=n(3227),a=n.n(r);let s=require("next-auth/providers/credentials");var i=n.n(s),o=n(4507),d=n(8432),u=n.n(d);let l={providers:[i()({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await o._.users.findUnique({where:{email:e.email}});return t&&t.passwordHash&&await u().compare(e.password,t.passwordHash)?{id:t.id,email:t.email,name:`${t.firstName} ${t.lastName}`,role:t.role}:null}})],callbacks:{jwt:async({token:e,user:t})=>(t&&(e.role=t.role),e),session:async({session:e,token:t})=>(t&&(e.user.id=t.sub,e.user.role=t.role),e)},pages:{signIn:"/auth/signin"},session:{strategy:"jwt",maxAge:2592e3},cookies:{sessionToken:{name:"__Secure-next-auth.session-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0}}},secret:"staging-nextauth-secret-2024"},c=a()(l)},4507:(e,t,n)=>{n.d(t,{_:()=>a});var r=n(3524);let a=globalThis.prisma??new r.PrismaClient},7153:(e,t)=>{var n;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return n}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(n||(n={}))},1802:(e,t,n)=>{e.exports=n(145)}};var t=require("../../../../../webpack-api-runtime.js");t.C(e);var n=t(t.s=3789);module.exports=n})();