"use strict";(()=>{var e={};e.id=4106,e.ids=[4106],e.modules={8432:e=>{e.exports=require("bcryptjs")},3227:e=>{e.exports=require("next-auth")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},9926:e=>{e.exports=import("zod")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,s){return s in t?t[s]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,s)):"function"==typeof t&&"default"===s?t:void 0}}})},6106:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{config:()=>c,default:()=>u,routeModule:()=>d});var n=s(1802),o=s(7153),a=s(6249),i=s(1345),l=e([i]);i=(l.then?(await l)():l)[0];let u=(0,a.l)(i,"default"),c=(0,a.l)(i,"config"),d=new n.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/events/[id]/positions/bulk-create",pathname:"/api/events/[id]/positions/bulk-create",bundlePath:"",filename:""},userland:i});r()}catch(e){r(e)}})},3515:(e,t,s)=>{s.r(t),s.d(t,{authOptions:()=>c,default:()=>d});var r=s(3227),n=s.n(r);let o=require("next-auth/providers/credentials");var a=s.n(o),i=s(8438),l=s(8432),u=s.n(l);let c={providers:[a()({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await i._.users.findUnique({where:{email:e.email}});return t&&t.passwordHash&&await u().compare(e.password,t.passwordHash)?{id:t.id,email:t.email,name:`${t.firstName} ${t.lastName}`,role:t.role}:null}})],callbacks:{jwt:async({token:e,user:t})=>(t&&(e.role=t.role),e),session:async({session:e,token:t})=>(t&&(e.user.id=t.sub,e.user.role=t.role),e)},pages:{signIn:"/auth/signin"},session:{strategy:"jwt",maxAge:2592e3},cookies:{sessionToken:{name:"__Secure-next-auth.session-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0}}},secret:"staging-nextauth-secret-2024"},d=n()(c)},1345:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{default:()=>c});var n=s(3227),o=s(3515),a=s(8438),i=s(9926),l=s(4770),u=e([i]);let m=(i=(u.then?(await u)():u)[0]).z.object({startNumber:i.z.number().min(1).max(1e3),endNumber:i.z.number().min(1).max(1e3),namePrefix:i.z.string().default("Position"),area:i.z.string().optional(),shiftTemplateId:i.z.string().optional(),customShifts:i.z.array(i.z.object({name:i.z.string(),startTime:i.z.string().optional(),endTime:i.z.string().optional(),isAllDay:i.z.boolean().default(!1)})).optional()});async function c(e,t){console.log("\uD83D\uDD0D BULK CREATE API CALLED");try{if(console.log("1. Checking session..."),!await (0,n.getServerSession)(e,t,o.authOptions))return console.log("❌ No session found"),t.status(401).json({success:!1,error:"Unauthorized"});console.log("✅ Session valid");let{id:s}=e.query;if(console.log("2. Event ID:",s),!s||"string"!=typeof s)return console.log("❌ Invalid event ID"),t.status(400).json({success:!1,error:"Event ID is required"});console.log("3. Verifying event exists...");let r=await a._.events.findUnique({where:{id:s}});if(!r)return console.log("❌ Event not found"),t.status(404).json({success:!1,error:"Event not found"});if(console.log("✅ Event found:",r.name),"POST"===e.method)return console.log("4. Calling handleBulkCreate..."),await d(e,t,s);return t.status(405).json({success:!1,error:"Method not allowed"})}catch(e){return console.error("❌ BULK CREATE API ERROR:",e.message),console.error("Stack:",e.stack),t.status(500).json({success:!1,error:"Internal server error"})}}async function d(e,t,s){console.log("\uD83D\uDCDD handleBulkCreate started");try{console.log("5. Parsing request body...");let r=m.parse(e.body);if(console.log("✅ Validated data:",r),r.endNumber<r.startNumber)return t.status(400).json({success:!1,error:"End number must be greater than or equal to start number"});if(r.endNumber-r.startNumber+1>100)return t.status(400).json({success:!1,error:"Cannot create more than 100 positions at once"});let n=await a._.positions.findMany({where:{eventId:s,positionNumber:{gte:r.startNumber,lte:r.endNumber}},select:{positionNumber:!0}});if(n.length>0){let e=n.map(e=>e.positionNumber).sort();return t.status(400).json({success:!1,error:`Positions already exist: ${e.join(", ")}`})}let o=r.customShifts||[];if(r.shiftTemplateId&&!r.customShifts){let e=await a._.shift_templates.findUnique({where:{id:r.shiftTemplateId}});e&&(o=e.shifts)}console.log("6. Starting transaction...");let i=await a._.$transaction(async e=>{let t=[];console.log(`7. Creating ${r.endNumber-r.startNumber+1} positions...`);for(let n=r.startNumber;n<=r.endNumber;n++){console.log(`   Creating position ${n}...`);let a=await e.positions.create({data:{id:(0,l.randomUUID)(),eventId:s,positionNumber:n,name:`${r.namePrefix} ${n}`,area:r.area,sequence:n,updatedAt:new Date}});if(console.log(`   ✅ Position ${n} created`),o.length>0){console.log(`   Creating ${o.length} shifts for position ${n}...`);for(let t=0;t<o.length;t++){let s=o[t];await e.position_shifts.create({data:{id:(0,l.randomUUID)(),positionId:a.id,name:s.name,startTime:s.startTime||null,endTime:s.endTime||null,isAllDay:s.isAllDay||!1,sequence:t+1}})}console.log(`   ✅ Shifts created for position ${n}`)}t.push(a)}return t});return t.status(201).json({success:!0,data:{created:i.length,positions:i,message:`Successfully created ${i.length} positions (${r.startNumber}-${r.endNumber})`}})}catch(e){if(e instanceof i.z.ZodError)return t.status(400).json({success:!1,error:e.errors[0].message});return console.error("Bulk create error:",e),t.status(500).json({success:!1,error:"Failed to create positions"})}}r()}catch(e){r(e)}})},8438:(e,t,s)=>{s.d(t,{_:()=>n});let r=require("@prisma/client"),n=globalThis.prisma??new r.PrismaClient},7153:(e,t)=>{var s;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return s}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(s||(s={}))},1802:(e,t,s)=>{e.exports=s(145)}};var t=require("../../../../../webpack-api-runtime.js");t.C(e);var s=t(t.s=6106);module.exports=s})();