"use strict";(()=>{var e={};e.id=421,e.ids=[421],e.modules={3524:e=>{e.exports=require("@prisma/client")},8432:e=>{e.exports=require("bcryptjs")},3227:e=>{e.exports=require("next-auth")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,s)=>{Object.defineProperty(s,"l",{enumerable:!0,get:function(){return function e(s,t){return t in s?s[t]:"then"in s&&"function"==typeof s.then?s.then(s=>e(s,t)):"function"==typeof s&&"default"===t?s:void 0}}})},8347:(e,s,t)=>{t.r(s),t.d(s,{config:()=>c,default:()=>m,routeModule:()=>p});var n={};t.r(n),t.d(n,{default:()=>d});var r=t(1802),i=t(7153),o=t(6249),a=t(3227),l=t(3515),u=t(4507);async function d(e,s){try{let t=await (0,a.getServerSession)(e,s,l.authOptions);if(!t)return s.status(401).json({error:"Unauthorized"});let{id:n,assignmentId:r}=e.query;if(!n||"string"!=typeof n)return s.status(400).json({error:"Event ID is required"});if(!r||"string"!=typeof r)return s.status(400).json({error:"Assignment ID is required"});let i=await u._.users.findUnique({where:{email:t.user?.email||""}});if(!i||!["ADMIN","OVERSEER","admin","overseer"].includes(i.role))return s.status(403).json({error:"Insufficient permissions"});if("DELETE"===e.method){console.log(`ðŸ—‘ï¸ Removing assignment ${r} from event ${n}`);let e=await u._.position_assignments.findUnique({where:{id:r},include:{position:!0,attendant:{select:{firstName:!0,lastName:!0}}}});if(!e)return console.error(`âŒ Assignment not found: ${r}`),s.status(404).json({error:"Assignment not found"});if(e.position.eventId!==n)return console.error(`âŒ Assignment ${r} does not belong to event ${n}`),s.status(400).json({error:"Assignment does not belong to this event"});return console.log(`ðŸ“‹ Removing ${e.attendant.firstName} ${e.attendant.lastName} from position ${e.position.name}`),await u._.position_assignments.delete({where:{id:r}}),console.log(`âœ… Successfully removed assignment ${r}`),s.status(200).json({success:!0,message:"Assignment removed successfully"})}return s.setHeader("Allow",["DELETE"]),s.status(405).json({error:"Method not allowed"})}catch(e){return console.error("Assignment deletion API error:",e),s.status(500).json({error:"Internal server error"})}}let m=(0,o.l)(n,"default"),c=(0,o.l)(n,"config"),p=new r.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/events/[id]/assignments/[assignmentId]",pathname:"/api/events/[id]/assignments/[assignmentId]",bundlePath:"",filename:""},userland:n})},3515:(e,s,t)=>{t.r(s),t.d(s,{authOptions:()=>d,default:()=>m});var n=t(3227),r=t.n(n);let i=require("next-auth/providers/credentials");var o=t.n(i),a=t(4507),l=t(8432),u=t.n(l);let d={providers:[o()({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let s=await a._.users.findUnique({where:{email:e.email}});return s&&s.passwordHash&&await u().compare(e.password,s.passwordHash)?{id:s.id,email:s.email,name:`${s.firstName} ${s.lastName}`,role:s.role}:null}})],callbacks:{jwt:async({token:e,user:s})=>(s&&(e.role=s.role),e),session:async({session:e,token:s})=>(s&&(e.user.id=s.sub,e.user.role=s.role),e)},pages:{signIn:"/auth/signin"},session:{strategy:"jwt",maxAge:2592e3},cookies:{sessionToken:{name:"__Secure-next-auth.session-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0}}},secret:"staging-nextauth-secret-2024"},m=r()(d)},4507:(e,s,t)=>{t.d(s,{_:()=>r});var n=t(3524);let r=globalThis.prisma??new n.PrismaClient},7153:(e,s)=>{var t;Object.defineProperty(s,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,s,t)=>{e.exports=t(145)}};var s=require("../../../../../webpack-api-runtime.js");s.C(e);var t=s(s.s=8347);module.exports=t})();