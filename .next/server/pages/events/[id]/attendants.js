"use strict";(()=>{var e={};e.id=7199,e.ids=[7199,660],e.modules={1849:(e,t,a)=>{a.r(t),a.d(t,{config:()=>z,default:()=>$,getServerSideProps:()=>F,getStaticPaths:()=>R,getStaticProps:()=>D,reportWebVitals:()=>q,routeModule:()=>O,unstable_getServerProps:()=>Z,unstable_getServerSideProps:()=>B,unstable_getStaticParams:()=>T,unstable_getStaticPaths:()=>X,unstable_getStaticProps:()=>G});var s={};a.r(s),a.d(s,{default:()=>U,getServerSideProps:()=>I});var n=a(7093),r=a(5244),l=a(1323),o=a(2899),i=a.n(o),c=a(6814),d=a(997),u=a(3227),p=a(6847),h=a(6689),g=a(1163),m=a(1649),x=a(968),v=a.n(x),f=a(1664),A=a.n(f);class E{getBaseUrl(e){return`/api/events/${e}/attendants`}async getEventAttendants(e,t){let a=new URLSearchParams;t?.page&&a.append("page",t.page.toString()),t?.limit&&a.append("limit",t.limit.toString()),t?.search&&a.append("search",t.search),t?.congregation&&a.append("congregation",t.congregation),t?.formsOfService?.length&&a.append("formsOfService",t.formsOfService.join(",")),t?.isActive!==void 0&&a.append("isActive",t.isActive.toString()),t?.hasUser!==void 0&&a.append("hasUser",t.hasUser.toString()),t?.includeStats&&a.append("includeStats","true");let s=await fetch(`${this.getBaseUrl(e)}?${a}`);if(!s.ok)throw Error(`Failed to fetch event attendants: ${s.statusText}`);return s.json()}async getEventAttendant(e,t){let a=await fetch(`${this.getBaseUrl(e)}/${t}`);if(!a.ok)throw Error(`Failed to fetch event attendant: ${a.statusText}`);return a.json()}async createEventAttendant(e,t){let a=await fetch(this.getBaseUrl(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw Error((await a.json()).error||`Failed to create event attendant (${a.status}: ${a.statusText})`);return a.json()}async updateEventAttendant(e,t,a){let s=await fetch(`${this.getBaseUrl(e)}/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!s.ok)throw Error((await s.json()).error||`Failed to update event attendant (${s.status}: ${s.statusText})`);return s.json()}async deleteEventAttendant(e,t){let a=await fetch(`${this.getBaseUrl(e)}/${t}`,{method:"DELETE"});if(!a.ok)throw Error((await a.json()).error||`Failed to delete event attendant (${a.status}: ${a.statusText})`);return a.json()}async bulkImportEventAttendants(e,t){let a=await fetch(this.getBaseUrl(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){let e=await a.json();throw console.error("Bulk import error:",e),Error(e.error||`Failed to import event attendants (${a.status}: ${a.statusText})`)}return a.json()}async bulkUpdateEventAttendantStatus(e,t,a){let s=t.map(t=>this.updateEventAttendant(e,t,{isActive:a}));try{return await Promise.all(s),{success:!0}}catch(e){throw Error(`Failed to bulk update attendant status: ${e instanceof Error?e.message:"Unknown error"}`)}}async bulkDeleteEventAttendants(e,t){let a=t.map(t=>this.deleteEventAttendant(e,t));try{return await Promise.all(a),{success:!0}}catch(e){throw Error(`Failed to bulk delete attendants: ${e instanceof Error?e.message:"Unknown error"}`)}}}let y=new E;var b=a(2085),j=a(6603),w=a(2808),S=a(9939),N=a(9470),P=a(1571);function k({eventId:e,eventName:t}){(0,g.useRouter)();let{data:a}=(0,m.useSession)(),{attendants:s,loading:n,error:r,pagination:l,stats:o,filters:i,eventInfo:c,setFilters:u,setPage:p,setPageSize:x,refresh:f,createAttendant:E,updateAttendant:k,deleteAttendant:C,bulkUpdateStatus:U,bulkDelete:I,bulkImport:$}=function({eventId:e,pageSize:t=10,includeStats:a=!1,initialFilters:s={}}){let[n,r]=(0,h.useState)([]),[l,o]=(0,h.useState)(!1),[i,c]=(0,h.useState)(null),[d,u]=(0,h.useState)(null),[p,g]=(0,h.useState)({eventId:e,eventName:void 0}),[m,x]=(0,h.useState)(s),[v,f]=(0,h.useState)({page:1,limit:t,total:0,pages:0}),A=(0,h.useCallback)(async()=>{if(!e){console.error("No eventId provided to useEventAttendants");return}try{console.log("APEX GUARDIAN: fetchEventAttendants called with:"),console.log("- eventId:",e),console.log("- pagination:",v),console.log("- filters:",m),o(!0),c(null);let t=await y.getEventAttendants(e,{...m,page:v.page,limit:v.limit,includeStats:a});console.log("APEX GUARDIAN: API response:",t),console.log("APEX GUARDIAN: Attendants returned:",t.data?.attendants?.length||0),t.success?(r(t.data.attendants),f(t.data.pagination),g({eventId:t.data.eventId||e,eventName:t.data.eventName}),t.data.stats&&u(t.data.stats)):c(t.error||"Failed to fetch event attendants")}catch(t){let e=t instanceof Error?t.message:"An error occurred";console.error("APEX GUARDIAN: fetchEventAttendants error:",e),c(e)}finally{o(!1)}},[e,m,v.page,v.limit,a]),E=(0,h.useCallback)(e=>{console.log("APEX GUARDIAN: Setting page to:",e),f(t=>{let a={...t,page:e};return console.log("APEX GUARDIAN: New pagination state:",a),a})},[]),b=(0,h.useCallback)(e=>{console.log("APEX GUARDIAN: Setting page size to:",e),f(t=>{let a={...t,limit:-1===e?999999:e,page:1};return console.log("APEX GUARDIAN: New pagination state:",a),a})},[]),j=(0,h.useCallback)(async()=>{await A()},[A]),w=(0,h.useCallback)(async t=>{try{c(null);let a=await y.createEventAttendant(e,t);if(a.success)await j();else throw Error(a.error||"Failed to create attendant")}catch(t){let e=t instanceof Error?t.message:"Failed to create attendant";throw c(e),Error(e)}},[e,j]),S=(0,h.useCallback)(async(t,a)=>{try{c(null);let s=await y.updateEventAttendant(e,t,a);if(s.success)await j();else throw Error(s.error||"Failed to update attendant")}catch(t){let e=t instanceof Error?t.message:"Failed to update attendant";throw c(e),Error(e)}},[e,j]),N=(0,h.useCallback)(async t=>{try{if(c(null),(await y.deleteEventAttendant(e,t)).success)await j();else throw Error("Failed to delete attendant")}catch(t){let e=t instanceof Error?t.message:"Failed to delete attendant";throw c(e),Error(e)}},[e,j]),P=(0,h.useCallback)(async(t,a)=>{try{c(null),await y.bulkUpdateEventAttendantStatus(e,t,a),await j()}catch(t){let e=t instanceof Error?t.message:"Failed to bulk update status";throw c(e),Error(e)}},[e,j]),k=(0,h.useCallback)(async t=>{try{c(null),await y.bulkDeleteEventAttendants(e,t),await j()}catch(t){let e=t instanceof Error?t.message:"Failed to bulk delete";throw c(e),Error(e)}},[e,j]),C=(0,h.useCallback)(async t=>{try{if(c(null),(await y.bulkImportEventAttendants(e,t)).success)await j();else throw Error("Failed to import attendants")}catch(t){let e=t instanceof Error?t.message:"Failed to import attendants";throw c(e),Error(e)}},[e,j]);return{attendants:n,loading:l,error:i,pagination:v,stats:d,filters:m,eventInfo:p,setFilters:x,setPage:E,setPageSize:b,refresh:j,createAttendant:w,updateAttendant:S,deleteAttendant:N,bulkUpdateStatus:P,bulkDelete:k,bulkImport:C}}({eventId:e,pageSize:25,includeStats:!0}),[D,R]=(0,h.useState)([]),[F,z]=(0,h.useState)([]),[q,G]=(0,h.useState)(!1),[X,T]=(0,h.useState)(!1),[Z,B]=(0,h.useState)(null),O=a?.user&&["ADMIN","OVERSEER"].includes(a.user.role),_=()=>{G(!1),B(null)},L=async e=>{try{Z?await k(Z.id,e):await E(e),_()}catch(e){console.error("Error saving attendant:",e)}},M=async e=>{if(confirm("Are you sure you want to delete this attendant?"))try{await C(e)}catch(e){console.error("Error deleting attendant:",e)}},J=async(e,t)=>{try{await U(e,t),z([])}catch(e){console.error("Error updating attendant status:",e)}},W=async e=>{if(confirm(`Are you sure you want to delete ${e.length} attendant(s)?`))try{await I(e),z([])}catch(e){console.error("Error deleting attendants:",e)}},V=async e=>{try{await $(e),T(!1)}catch(e){console.error("Error importing attendants:",e)}};return O?(0,d.jsxs)("div",{className:"space-y-6",children:[d.jsx(v(),{children:(0,d.jsxs)("title",{children:[c.eventName||t||"Event"," - Attendants | JW Attendant Scheduler"]})}),(0,d.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,d.jsxs)("div",{children:[d.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Event Attendants"}),(0,d.jsxs)("p",{className:"text-gray-600",children:["Manage attendants for ",c.eventName||t||"this event"]})]}),(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[d.jsx(A(),{href:`/events/${e}`,className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"â† Back to Event"}),d.jsx(P.Z,{onClick:()=>T(!0),variant:"secondary",size:"sm",children:"Bulk Import"}),d.jsx(P.Z,{onClick:()=>{B(null),G(!0)},variant:"primary",size:"sm",children:"Add Attendant"})]})]}),o&&d.jsx(N.Z,{stats:o,loading:n}),d.jsx(b.Z,{filters:i,onFiltersChange:u,congregations:D,loading:n}),r&&d.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,d.jsxs)("div",{className:"flex",children:[d.jsx("div",{className:"flex-shrink-0",children:d.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:d.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,d.jsxs)("div",{className:"ml-3",children:[d.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),d.jsx("div",{className:"mt-2 text-sm text-red-700",children:d.jsx("p",{children:r})})]})]})}),F.length>0&&d.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[d.jsx("div",{className:"flex items-center",children:(0,d.jsxs)("span",{className:"text-sm font-medium text-blue-900",children:[F.length," attendant(s) selected"]})}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[d.jsx(P.Z,{onClick:()=>z([]),variant:"secondary",size:"sm",children:"Clear Selection"}),d.jsx(P.Z,{onClick:()=>J(F,!0),variant:"success",size:"sm",children:"Activate Selected"}),d.jsx(P.Z,{onClick:()=>J(F,!1),variant:"secondary",size:"sm",children:"Deactivate Selected"}),d.jsx(P.Z,{onClick:()=>W(F),variant:"danger",size:"sm",children:"Delete Selected"})]})]})}),d.jsx("div",{className:"bg-white shadow rounded-lg",children:d.jsx(j.Z,{attendants:s,loading:n,onEdit:e=>{B(e),G(!0)},onDelete:M,onSelect:z,selectedIds:F,onBulkStatusChange:J})}),(0,d.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 py-4 bg-white rounded-lg shadow px-4",children:[(0,d.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[(0,d.jsxs)("div",{className:"text-sm text-gray-700",children:["Showing ",(l.page-1)*l.limit+1," to"," ",Math.min(l.page*l.limit,l.total)," of"," ",l.total," results"]}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[d.jsx("label",{htmlFor:"pageSize",className:"text-sm text-gray-700",children:"Show:"}),(0,d.jsxs)("select",{id:"pageSize",value:999999===l.limit?-1:l.limit,onChange:e=>{console.log("APEX GUARDIAN: Select changed, setPageSize function:",typeof x),console.log("APEX GUARDIAN: New value:",e.target.value),e.preventDefault(),x(Number(e.target.value))},disabled:n,className:"border border-gray-300 rounded-md px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[d.jsx("option",{value:10,children:"10"}),d.jsx("option",{value:25,children:"25"}),d.jsx("option",{value:50,children:"50"}),d.jsx("option",{value:100,children:"100"}),d.jsx("option",{value:-1,children:"All"})]}),d.jsx("span",{className:"text-sm text-gray-700",children:"per page"})]}),d.jsx(P.Z,{onClick:()=>{console.log("APEX GUARDIAN: Test button clicked!"),console.log("setPageSize type:",typeof x),console.log("Current pagination:",l),x(50)},variant:"primary",size:"sm",type:"button",children:"Test Button (Set to 50)"})]}),l.pages>1&&(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[d.jsx(P.Z,{onClick:()=>{console.log("APEX GUARDIAN: Previous button clicked, setPage function:",typeof p),console.log("APEX GUARDIAN: Current pagination:",l),p(l.page-1)},disabled:l.page<=1||n,variant:"secondary",size:"sm",type:"button",children:"Previous"}),(0,d.jsxs)("span",{className:"px-3 py-1 text-sm text-gray-700",children:["Page ",l.page," of ",l.pages]}),d.jsx(P.Z,{onClick:()=>{console.log("APEX GUARDIAN: Next button clicked, setPage function:",typeof p),console.log("APEX GUARDIAN: Current pagination:",l),p(l.page+1)},disabled:l.page>=l.pages||n,variant:"secondary",size:"sm",type:"button",children:"Next"})]})]}),d.jsx(w.Z,{isOpen:q,onClose:_,onSave:L,attendant:Z}),d.jsx(S.Z,{isOpen:X,onClose:()=>T(!1),onImport:V})]}):d.jsx("div",{className:"flex items-center justify-center min-h-screen",children:(0,d.jsxs)("div",{className:"text-center",children:[d.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Access Denied"}),d.jsx("p",{className:"text-gray-600 mb-4",children:"You don't have permission to manage attendants."}),d.jsx(A(),{href:"/events",className:"text-blue-600 hover:text-blue-800",children:"Return to Events"})]})})}var C=a(9927);function U({eventId:e,event:t}){return d.jsx(C.Z,{title:`${t?.name||"Event"} - Attendants | JW Attendant Scheduler`,breadcrumbs:[{label:"Events",href:"/events"},{label:t?.name||"Event",href:`/events/${e}`},{label:"Attendants"}],selectedEvent:{id:e,name:t?.name||"Event",status:t?.status},children:d.jsx(k,{eventId:e,eventName:t?.name})})}let I=async e=>{if(!await (0,u.getServerSession)(e.req,e.res,p.L))return{redirect:{destination:"/auth/signin",permanent:!1}};let{id:t}=e.params,a=null;try{let e=await fetch(`http://localhost:3001/api/events/${t}`);if(e.ok){let t=await e.json();t.success&&(a=t.data)}}catch(e){console.error("Error fetching event:",e),a=null}return{props:{eventId:t,event:a}}},$=(0,l.l)(s,"default"),D=(0,l.l)(s,"getStaticProps"),R=(0,l.l)(s,"getStaticPaths"),F=(0,l.l)(s,"getServerSideProps"),z=(0,l.l)(s,"config"),q=(0,l.l)(s,"reportWebVitals"),G=(0,l.l)(s,"unstable_getStaticProps"),X=(0,l.l)(s,"unstable_getStaticPaths"),T=(0,l.l)(s,"unstable_getStaticParams"),Z=(0,l.l)(s,"unstable_getServerProps"),B=(0,l.l)(s,"unstable_getServerSideProps"),O=new n.PagesRouteModule({definition:{kind:r.x.PAGES,page:"/events/[id]/attendants",pathname:"/events/[id]/attendants",bundlePath:"",filename:""},components:{App:c.default,Document:i()},userland:s})},3524:e=>{e.exports=require("@prisma/client")},8432:e=>{e.exports=require("bcryptjs")},3227:e=>{e.exports=require("next-auth")},7449:e=>{e.exports=require("next-auth/providers/credentials")},1649:e=>{e.exports=require("next-auth/react")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{e.exports=require("next/head")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},6162:e=>{e.exports=require("stream")},1568:e=>{e.exports=require("zlib")}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[2899,8342,1664,4937],()=>a(1849));module.exports=s})();