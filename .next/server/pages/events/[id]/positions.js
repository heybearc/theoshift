(()=>{var e={};e.id=2801,e.ids=[2801,2888,660],e.modules={4483:(e,t,s)=>{"use strict";s.r(t),s.d(t,{config:()=>T,default:()=>S,getServerSideProps:()=>$,getStaticPaths:()=>A,getStaticProps:()=>k,reportWebVitals:()=>C,routeModule:()=>F,unstable_getServerProps:()=>I,unstable_getServerSideProps:()=>O,unstable_getStaticParams:()=>E,unstable_getStaticPaths:()=>P,unstable_getStaticProps:()=>D});var i={};s.r(i),s.d(i,{default:()=>j,getServerSideProps:()=>w});var a=s(7093),n=s(5244),r=s(1323),l=s(2899),o=s.n(l),d=s(6814),c=s(997),m=s(6689),u=s(1163),x=s(1649),h=s(968),p=s.n(h),g=s(1664),f=s.n(g);function b({eventId:e,onClose:t,onSuccess:s}){let[i,a]=(0,m.useState)(!1),[n,r]=(0,m.useState)(""),[l,o]=(0,m.useState)(""),d=async t=>{if(t.preventDefault(),!n.trim()){alert("Please enter position names");return}try{a(!0);let t=n.split("\n").map(e=>e.trim()).filter(e=>e.length>0);if(0===t.length){alert("Please enter at least one position name");return}console.log(`ðŸš€ Processing ${t.length} positions for event ${e}`);let i=0,r=0,o=0,d=0,c=[];try{let t=await fetch(`/api/events/${e}/positions?includeInactive=true&limit=1000`);if(t.ok){let e=await t.json();c=e.data?.positions||[],console.log(`ðŸ“Š Found ${c.length} existing positions (active + inactive)`)}}catch(e){console.warn("Could not fetch existing positions, proceeding with creation only")}let m=e=>{let t=e.match(/(?:Station|Position)\s+(\d+)/i);return t?parseInt(t[1],10):null};for(let s=0;s<t.length;s++){let a=t[s],n=m(a);try{let t=c.find(e=>e.name.toLowerCase().trim()===a.toLowerCase().trim()),m=n?c.find(e=>e.positionNumber===n):null;if(t)t.isActive?(console.log(`âœ… Position already exists and active: ${a}`),d++):(console.log(`ðŸ”„ Reactivating existing position: ${a}`),(await fetch(`/api/events/${e}/positions/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a,area:l||t.area,isActive:!0})})).ok?o++:r++);else if(m&&!m.isActive)console.log(`â™»ï¸ Reusing inactive position number ${n} for: ${a}`),(await fetch(`/api/events/${e}/positions/${m.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a,area:l||void 0,isActive:!0})})).ok?o++:r++;else if(n&&!m)console.log(`ðŸ†• Creating new position ${n}: ${a}`),(await fetch(`/api/events/${e}/positions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({positionNumber:n,name:a,area:l||void 0,sequence:n})})).ok?i++:(r++,console.error(`Failed to create position: ${a}`));else{let t=c.reduce((e,t)=>Math.max(e,t.positionNumber||0),0)+1+s;console.log(`ðŸ“ Creating position with next available number ${t}: ${a}`),(await fetch(`/api/events/${e}/positions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({positionNumber:t,name:a,area:l||void 0,sequence:t})})).ok?i++:(r++,console.error(`Failed to create position: ${a}`))}}catch(e){r++,console.error(`Error processing position ${a}:`,e)}}let u=i+o+d;if(u>0){let e=[];i>0&&e.push(`${i} created`),o>0&&e.push(`${o} reactivated`),d>0&&e.push(`${d} already active`),r>0&&e.push(`${r} failed`);let t={created:u,failed:r,message:`Processed ${u} positions: ${e.join(", ")}`};console.log(`âœ… Successfully processed ${u} positions`),s(t)}else alert("Failed to process positions")}catch(e){console.error("Bulk create error:",e),alert("Failed to create positions")}finally{a(!1)}},u=`Position 1
Position 2
Position 3
Parking Lot Attendant
Information Desk
Sound Booth
Stage Attendant`;return c.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:c.jsx("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:(0,c.jsxs)("form",{onSubmit:d,children:[(0,c.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"\uD83D\uDE80 Bulk Create Positions"}),c.jsx("button",{type:"button",onClick:t,className:"text-gray-400 hover:text-gray-600",children:"âœ•"})]}),(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsxs)("div",{children:[c.jsx("label",{htmlFor:"defaultArea",className:"block text-sm font-medium text-gray-700 mb-1",children:"Default Area (Optional)"}),c.jsx("input",{type:"text",id:"defaultArea",value:l,onChange:e=>o(e.target.value),placeholder:"e.g., Main Auditorium, Parking, Lobby",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),c.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This area will be applied to all positions (can be edited individually later)"})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{htmlFor:"positionsText",className:"block text-sm font-medium text-gray-700 mb-1",children:"Position Names (One per line)"}),c.jsx("textarea",{id:"positionsText",value:n,onChange:e=>r(e.target.value),placeholder:u,rows:10,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),c.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter one position name per line. Empty lines will be ignored."})]}),(0,c.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[c.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-2",children:"\uD83D\uDCA1 Tips:"}),(0,c.jsxs)("ul",{className:"text-xs text-blue-700 space-y-1",children:[c.jsx("li",{children:"â€¢ Position names will be created exactly as entered"}),c.jsx("li",{children:"â€¢ Positions will be automatically numbered in sequence"}),c.jsx("li",{children:"â€¢ All positions will be created as Active by default"}),c.jsx("li",{children:"â€¢ You can edit individual positions after creation"})]})]})]}),(0,c.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[c.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors",children:"Cancel"}),c.jsx("button",{type:"submit",disabled:i||!n.trim(),className:"px-4 py-2 text-sm font-medium text-white bg-green-600 hover:bg-green-700 disabled:bg-gray-400 rounded-md transition-colors",children:i?"Creating...":`Create ${n.split("\n").filter(e=>e.trim()).length} Positions`})]})]})})})}let y=require("next-auth/next");var v=s(5175);function N(e){if(!e)return"";let[t,s]=e.split(":"),i=parseInt(t,10);return`${0===i?12:i>12?i-12:i}:${s} ${i>=12?"PM":"AM"}`}function j({eventId:e,event:t,positions:s,attendants:i,stats:a}){let n=(0,u.useRouter)(),[r,l]=(0,m.useState)(!1),[o,d]=(0,m.useState)(""),[h,g]=(0,m.useState)(!1),[y,v]=(0,m.useState)(!1),[j,w]=(0,m.useState)(!1),[S,k]=(0,m.useState)(!1),[A,$]=(0,m.useState)(!1),[T,C]=(0,m.useState)(!1),[D,P]=(0,m.useState)(!1),[E,I]=(0,m.useState)(!1),[O,F]=(0,m.useState)(null),[L,q]=(0,m.useState)(null),[M,B]=(0,m.useState)(null),[R,z]=(0,m.useState)(null),[U,J]=(0,m.useState)(!1),[_,H]=(0,m.useState)(""),[K,V]=(0,m.useState)(new Set),[W,Y]=(0,m.useState)(!1),[G,X]=(0,m.useState)({startTime:"",endTime:"",isAllDay:!1}),[Q,Z]=(0,m.useState)({overseerId:"",keymanId:"",responsibilities:""}),[ee,et]=(0,m.useState)({positionNumber:1,name:"",area:"",description:""}),es=async t=>{if(t.preventDefault(),!ee.name.trim()){alert("Position name is required");return}try{let t=M?`/api/events/${e}/positions/${M.id}`:`/api/events/${e}/positions`,s=await fetch(t,{method:M?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ee)});if(s.ok)alert(M?"Position updated successfully":"Position created successfully"),g(!1),B(null),et({positionNumber:1,name:"",area:"",description:""}),eh();else{let e=await s.json();alert(e.error||"Failed to save position")}}catch(e){console.error("Error saving position:",e),alert("Failed to save position")}},ei=e=>{B(e),et({positionNumber:e.positionNumber,name:e.name,area:e.area||"",description:e.description||""}),g(!0)},ea=async t=>{if(confirm("Are you sure you want to deactivate this position? It can be reactivated later."))try{J(!0);let s=await fetch(`/api/events/${e}/positions/${t}`,{method:"DELETE"});if(s.ok)eh();else{let e=await s.json();alert(`Failed to deactivate position: ${e.error}`)}}catch(e){alert("Failed to deactivate position")}finally{J(!1)}},en=()=>{g(!1),B(null),et({positionNumber:1,name:"",area:"",description:""})},er=async t=>{if(t.preventDefault(),O)try{let t=await fetch(`/api/events/${e}/positions/${O.id}/shifts`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({startTime:G.startTime,endTime:G.endTime,isAllDay:G.isAllDay,positionId:O.id})});if(t.ok)alert("Shift added successfully"),w(!1),X({startTime:"",endTime:"",isAllDay:!1}),n.reload();else{let e=await t.json();alert(`Failed to add shift: ${e.error||"Unknown error"}`)}}catch(e){console.error("Error adding shift:",e),alert("Failed to add shift")}},el=async t=>{if(t.preventDefault(),O)try{let t=await fetch(`/api/events/${e}/positions/${O.id}/overseer`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({overseerId:Q.overseerId,keymanId:Q.keymanId||null,responsibilities:Q.responsibilities,positionId:O.id})});if(t.ok)alert("Overseer assigned successfully"),k(!1),Z({overseerId:"",keymanId:"",responsibilities:""}),n.reload();else{let e=await t.json();alert(`Failed to assign overseer: ${e.error||"Unknown error"}`)}}catch(e){console.error("Error assigning overseer:",e),alert("Failed to assign overseer")}},eo=async()=>{if(confirm(`Delete ${K.size} selected positions? This action cannot be undone.`))try{J(!0);let t=0,s=0;for(let i of K)try{(await fetch(`/api/events/${e}/positions/${i}`,{method:"DELETE"})).ok?t++:(s++,console.error(`Failed to delete position ${i}`))}catch(e){s++,console.error(`Error deleting position ${i}:`,e)}t>0?(alert(`Successfully deleted ${t} position(s)${s>0?`. ${s} failed.`:""}`),V(new Set),eh()):alert("Failed to delete positions")}catch(e){console.error("Bulk delete error:",e),alert("Failed to delete positions")}finally{J(!1)}},ed=async t=>{if(confirm("Are you sure you want to remove this assignment?"))try{(await fetch(`/api/events/${e}/assignments/${t}`,{method:"DELETE"})).ok?n.reload():alert("Failed to remove assignment")}catch(e){console.error("Error removing assignment:",e),alert("Failed to remove assignment")}},ec=async()=>{if(confirm("Auto-assign available attendants to unfilled positions?"))try{J(!0),console.log("\uD83C\uDFAF Starting Hierarchy-Based Auto-Assign...");let t=new Set,a=new Set;s.forEach(e=>{e.assignments?.forEach(e=>{e.attendant?.id&&t.add(e.attendant.id),e.overseer?.id&&a.add(e.overseer.id),e.keyman?.id&&a.add(e.keyman.id)})});let r=i.filter(e=>e.isActive&&!t.has(e.id)&&!a.has(e.id)),l=new Map;r.forEach(e=>{let t=`${e.overseerId||"none"}-${e.keymanId||"none"}`;l.has(t)||l.set(t,[]),l.get(t).push(e)});let o=new Map;s.filter(e=>e.isActive&&2>(e.assignments?.length||0)).forEach(e=>{let t=`${e.overseerId||"none"}-${e.keymanId||"none"}`;o.has(t)||o.set(t,[]),o.get(t).push(e)});let d=0,c=0,m=0;for(let[s,i]of(console.log(`ðŸ“Š Leadership Groups: ${l.size} attendant groups, ${o.size} position groups`),o)){let a=l.get(s)||[];if(a.length>0){for(let n of(console.log(`ðŸŽ¯ Matching leadership group: ${s} (${a.length} attendants â†’ ${i.length} positions)`),i)){if(0===a.length)break;let s=a.shift();s&&(await fetch(`/api/events/${e}/assignments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({positionId:n.id,attendantId:s.id,role:"ATTENDANT"})})).ok&&(d++,c++,t.add(s.id),console.log(`âœ… Hierarchy match: ${s.firstName} ${s.lastName} â†’ ${n.positionName}`))}l.set(s,a)}}let u=[];for(let e of l.values())u.push(...e);let x=[];for(let e of o.values())x.push(...e.filter(e=>2>(e.assignments?.length||0)&&!t.has(e.id)));for(let t of(console.log(`ðŸ”„ Fallback phase: ${u.length} attendants â†’ ${x.length} positions`),x)){if(0===u.length)break;let s=u.shift();s&&(await fetch(`/api/events/${e}/assignments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({positionId:t.id,attendantId:s.id,role:"ATTENDANT"})})).ok&&(d++,m++,console.log(`âš¡ Fallback assignment: ${s.firstName} ${s.lastName} â†’ ${t.positionName}`))}console.log("\uD83D\uDCC5 Phase 3: Ensuring balanced shift coverage...");let h=0;for(let t of s.filter(e=>e.shifts&&e.shifts.length>0))if(t.shifts)for(let s of t.shifts){let i=t.assignments?.filter(e=>e.shift?.id===s.id).length||0;if(0===i&&r.length>0){let i=r.shift();i&&(await fetch(`/api/events/${e}/assignments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({positionId:t.id,attendantId:i.id,shiftId:s.id,role:"ATTENDANT"})})).ok&&(h++,console.log(`ðŸ“… Shift coverage: ${i.firstName} ${i.lastName} â†’ ${t.name} (${s.name})`))}}let p=d>0?Math.round(c/d*100):0,g=d+h;alert(`ðŸŽ¯ Advanced Auto-Assign Complete!

âœ… Position Assignments: ${d}
ðŸŽ¯ Hierarchy Matches: ${c} (${p}%)
âš¡ Fallback Assignments: ${m}
ðŸ“… Shift Coverage: ${h}
ðŸŽ‰ Total Assignments: ${g}

System ensures every shift has at least one attendant with leadership-based prioritization.`),n.reload()}catch(e){console.error("Auto-assign error:",e),alert("Failed to auto-assign attendants")}finally{J(!1)}},em=()=>{let e=new Set,t=new Set;return s.forEach(s=>{s.assignments?.forEach(s=>{s.attendant?.id&&e.add(s.attendant.id),s.overseer?.id&&t.add(s.overseer.id),s.keyman?.id&&t.add(s.keyman.id)})}),i.filter(s=>s.isActive&&!e.has(s.id)&&!t.has(s.id)).length},{data:eu}=(0,x.useSession)(),ex=eu?.user?.role==="ADMIN",eh=()=>{let e=new URL(window.location.href);W?e.searchParams.set("showInactive","true"):e.searchParams.delete("showInactive"),window.location.href=e.toString()};return r?c.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,c.jsxs)("div",{className:"text-center",children:[c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),c.jsx("p",{className:"mt-4 text-gray-600",children:"Loading positions..."})]})}):eu?(0,c.jsxs)(c.Fragment,{children:[c.jsx(p(),{children:(0,c.jsxs)("title",{children:[t?.name?`${t.name} - Positions`:"Event Positions"," | JW Attendant Scheduler"]})}),(0,c.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,c.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,c.jsxs)("div",{className:"mb-8",children:[(0,c.jsxs)("nav",{className:"flex items-center space-x-2 text-sm text-gray-500 mb-4",children:[c.jsx(f(),{href:"/events",className:"hover:text-gray-700",children:"Events"}),c.jsx("span",{children:"â€º"}),c.jsx(f(),{href:`/events/${e}`,className:"hover:text-gray-700",children:t?.name||"Event"}),c.jsx("span",{children:"â€º"}),c.jsx("span",{className:"text-gray-900",children:"Positions"})]}),(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsxs)("div",{children:[c.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Event Positions"}),(0,c.jsxs)("p",{className:"text-gray-600 mt-2",children:["Manage positions and roles for ",t?.name]})]}),(0,c.jsxs)("div",{className:"flex space-x-3",children:[c.jsx(f(),{href:`/events/${e}`,className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium transition-colors",children:"â† Back to Event"}),K.size>0&&(0,c.jsxs)("div",{className:"flex items-center space-x-2 bg-blue-50 border border-blue-200 rounded-lg px-3 py-2",children:[(0,c.jsxs)("span",{className:"text-sm text-blue-700 font-medium",children:[K.size," selected"]}),c.jsx("button",{onClick:()=>I(!0),disabled:0===K.size,className:"text-xs bg-green-100 hover:bg-green-200 text-green-700 px-2 py-1 rounded",title:"Apply shift template to selected positions",children:"\uD83D\uDCC5 Apply Template"}),c.jsx("button",{onClick:eo,disabled:0===K.size,className:"text-xs bg-red-100 hover:bg-red-200 text-red-700 px-2 py-1 rounded",children:"Delete"}),c.jsx("button",{onClick:()=>P(!0),className:"text-xs bg-blue-100 hover:bg-blue-200 text-blue-700 px-2 py-1 rounded",children:"Edit"}),c.jsx("button",{onClick:()=>V(new Set),className:"text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 px-2 py-1 rounded",children:"Clear"})]}),(0,c.jsxs)("button",{onClick:ec,disabled:U||0===em(),className:"bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg font-medium transition-colors",title:`Auto-assign ${em()} available attendants`,children:["\uD83E\uDD16 Auto-Assign (",em(),")"]}),(0,c.jsxs)("button",{onClick:()=>{let t=!W;Y(t),localStorage.setItem(`showInactive-event-${e}`,t.toString());let s=new URL(window.location.href);t?s.searchParams.set("showInactive","true"):s.searchParams.delete("showInactive"),window.history.replaceState({},"",s.toString())},className:`px-4 py-2 rounded-lg font-medium transition-colors ${W?"bg-purple-600 hover:bg-purple-700 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,title:W?"Hide inactive positions":"Show inactive positions",children:["\uD83D\uDC41ï¸ ",W?"Hide Inactive":"Show Inactive"]}),c.jsx("button",{onClick:()=>$(!0),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"\uD83D\uDE80 Bulk Create"}),c.jsx("button",{onClick:()=>g(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"+ Create Position"})]})]})]}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[c.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:(0,c.jsxs)("div",{className:"flex items-center",children:[c.jsx("div",{className:"flex-shrink-0",children:c.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:c.jsx("span",{className:"text-blue-600 font-semibold",children:"\uD83D\uDCCB"})})}),(0,c.jsxs)("div",{className:"ml-4",children:[c.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Positions"}),c.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:s.filter(e=>e.isActive).length})]})]})}),c.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:(0,c.jsxs)("div",{className:"flex items-center",children:[c.jsx("div",{className:"flex-shrink-0",children:c.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center",children:c.jsx("span",{className:"text-green-600 font-semibold",children:"âœ“"})})}),(0,c.jsxs)("div",{className:"ml-4",children:[c.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Active Positions"}),c.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:s.filter(e=>e.isActive).length})]})]})}),c.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:(0,c.jsxs)("div",{className:"flex items-center",children:[c.jsx("div",{className:"flex-shrink-0",children:c.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:c.jsx("span",{className:"text-purple-600 font-semibold",children:"\uD83C\uDFE2"})})}),(0,c.jsxs)("div",{className:"ml-4",children:[c.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Areas"}),c.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:new Set(s.filter(e=>e.isActive).map(e=>e.area).filter(Boolean)).size})]})]})}),c.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:(0,c.jsxs)("div",{className:"flex items-center",children:[c.jsx("div",{className:"flex-shrink-0",children:c.jsx("div",{className:"w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center",children:c.jsx("span",{className:"text-orange-600 font-semibold",children:"\uD83D\uDC65"})})}),(0,c.jsxs)("div",{className:"ml-4",children:[c.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Attendants"}),c.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:s.filter(e=>e.isActive).reduce((e,t)=>e+(t.assignments?.filter(e=>"ATTENDANT"===e.role).length||0),0)})]})]})})]}),c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:0===s.filter(e=>e.isActive).length?(0,c.jsxs)("div",{className:"col-span-full bg-white rounded-lg shadow p-12 text-center",children:[c.jsx("span",{className:"text-6xl mb-4 block",children:"\uD83D\uDCCB"}),c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No positions created"}),c.jsx("p",{className:"text-gray-500 mb-4",children:"Create your first position to get started"}),(0,c.jsxs)("div",{className:"flex justify-center space-x-4",children:[c.jsx("button",{onClick:()=>$(!0),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"\uD83D\uDE80 Bulk Create"}),c.jsx("button",{onClick:()=>g(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"Create Position"})]})]}):s.filter(e=>!!W||e.isActive).map(t=>c.jsx("div",{className:`rounded-lg shadow hover:shadow-md transition-shadow ${t.isActive?"bg-white":"bg-gray-50 border-2 border-dashed border-gray-300"}`,children:(0,c.jsxs)("div",{className:"p-6",children:[(0,c.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,c.jsxs)("div",{className:"flex items-start space-x-3",children:[c.jsx("input",{type:"checkbox",checked:K.has(t.id),onChange:e=>{let s=new Set(K);e.target.checked?s.add(t.id):s.delete(t.id),V(s)},className:"mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,c.jsxs)("div",{children:[(0,c.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[c.jsx("h3",{className:`text-lg font-semibold mb-0 ${t.isActive?"text-gray-900":"text-gray-500"}`,children:t.name}),!t.isActive&&c.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:"Inactive"})]}),t.area&&c.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:t.area})]})]}),c.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t.isActive?"Active":"Inactive"})]}),t.description&&c.jsx("p",{className:"text-sm text-gray-600 mb-3",children:t.description}),t.assignments&&t.assignments.length>0&&c.jsx("div",{className:"mb-3",children:t.assignments.some(e=>e.overseer||e.keyman)&&(0,c.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-3",children:[c.jsx("p",{className:"text-xs font-medium text-blue-800 mb-2",children:"\uD83D\uDC65 Leadership"}),(0,c.jsxs)("div",{className:"space-y-1",children:[t.assignments.filter(e=>e.overseer).map(e=>(0,c.jsxs)("div",{className:"text-xs text-blue-700",children:[c.jsx("span",{className:"font-medium",children:"Overseer:"})," ",e.overseer?.firstName," ",e.overseer?.lastName]},e.id)),t.assignments.filter(e=>e.keyman).map(e=>(0,c.jsxs)("div",{className:"text-xs text-blue-700",children:[c.jsx("span",{className:"font-medium",children:"Keyman:"})," ",e.keyman?.firstName," ",e.keyman?.lastName]},e.id))]})]})}),(0,c.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-500 mb-4",children:[(0,c.jsxs)("span",{children:["Position #",t.positionNumber]}),(0,c.jsxs)("span",{children:[t.shifts?.length||0," shifts â€¢ ",t.assignments?.filter(e=>"ATTENDANT"===e.role).length||0," attendants"]})]}),t.shifts&&t.shifts.length>0?(0,c.jsxs)("div",{className:"mb-4",children:[c.jsx("p",{className:"text-xs font-medium text-gray-500 mb-2",children:"\uD83D\uDD50 Shift Assignments"}),c.jsx("div",{className:"space-y-2",children:t.shifts.map(e=>{let s=t.assignments?.filter(t=>t.shift?.id===e.id)||[],i=s.filter(e=>"ATTENDANT"===e.role),a=s.filter(e=>"OVERSEER"===e.role||"KEYMAN"===e.role);return(0,c.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-2",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,c.jsxs)("div",{className:"flex items-center space-x-2",children:[c.jsx("span",{className:"text-xs font-medium text-gray-700",children:e.name}),!e.isAllDay&&(0,c.jsxs)("span",{className:"text-xs text-gray-500",children:[e.startTime," - ",e.endTime]}),e.isAllDay&&c.jsx("span",{className:"text-xs text-blue-600 bg-blue-100 px-1 rounded",children:"All Day"})]}),(0,c.jsxs)("span",{className:"text-xs text-gray-400",children:[i.length," attendant",1!==i.length?"s":"",a.length>0&&` + ${a.length} leadership`]})]}),a.length>0&&(0,c.jsxs)("div",{className:"mb-2",children:[c.jsx("p",{className:"text-xs font-medium text-gray-600 mb-1",children:"Leadership:"}),c.jsx("div",{className:"space-y-1",children:a.map(e=>{let t="OVERSEER"===e.role?"text-blue-700":"text-purple-700",s="OVERSEER"===e.role?"bg-blue-50 border-blue-100":"bg-purple-50 border-purple-100";return(0,c.jsxs)("div",{className:`flex items-center justify-between ${s} border rounded px-2 py-1`,children:[(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsxs)("span",{className:`text-xs font-medium ${t}`,children:[e.attendant?.firstName," ",e.attendant?.lastName]}),(0,c.jsxs)("span",{className:"ml-2 text-xs text-gray-500",children:["(",e.role,")"]})]}),c.jsx("button",{onClick:()=>ed(e.id),className:"text-xs text-red-600 hover:text-red-800 px-1",title:"Remove assignment",children:"âœ•"})]},e.id)})})]}),i.length>0?c.jsx("div",{className:"space-y-1",children:i.map(e=>(0,c.jsxs)("div",{className:"flex items-center justify-between bg-green-50 border-green-100 border rounded px-2 py-1",children:[(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsxs)("span",{className:"text-xs font-medium text-green-700",children:[e.attendant?.firstName," ",e.attendant?.lastName]}),(0,c.jsxs)("span",{className:"ml-2 text-xs text-gray-500",children:["(",e.role||"Attendant",")"]})]}),c.jsx("button",{onClick:()=>ed(e.id),className:"text-xs text-red-600 hover:text-red-800 px-1",title:"Remove assignment",children:"âœ•"})]},e.id))}):c.jsx("button",{onClick:()=>{F(t),q(e),C(!0)},className:"w-full text-xs text-blue-600 hover:text-blue-800 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded px-2 py-1 transition-colors",children:"+ Assign Attendant"})]},e.id)})}),c.jsx("button",{onClick:()=>{F(t),w(!0)},className:"w-full mt-2 text-xs text-green-600 hover:text-green-800 bg-green-50 hover:bg-green-100 border border-green-200 rounded px-2 py-1 transition-colors",children:"+ Add Shift"})]}):(0,c.jsxs)("div",{className:"mb-4",children:[c.jsx("p",{className:"text-xs font-medium text-gray-500 mb-2",children:"\uD83D\uDD50 No Shifts Created"}),c.jsx("button",{onClick:()=>{F(t),w(!0)},className:"w-full text-xs text-blue-600 hover:text-blue-800 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded px-2 py-1 transition-colors",children:"+ Create First Shift"})]}),(!t.shifts||0===t.shifts.length)&&t.assignments&&t.assignments.length>0&&(0,c.jsxs)("div",{className:"mb-4",children:[c.jsx("p",{className:"text-xs font-medium text-gray-500 mb-2",children:"\uD83D\uDC64 Legacy Assignments"}),(0,c.jsxs)("div",{className:"space-y-1",children:[t.assignments.filter(e=>!e.shift).map(e=>(0,c.jsxs)("div",{className:"flex items-center justify-between bg-yellow-50 border border-yellow-200 rounded px-2 py-1",children:[(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsxs)("span",{className:"text-xs font-medium text-yellow-700",children:[e.attendant?.firstName," ",e.attendant?.lastName]}),c.jsx("span",{className:"ml-2 text-xs text-yellow-600",children:"(Needs Shift Assignment)"})]}),c.jsx("button",{onClick:()=>ed(e.id),className:"text-xs text-red-600 hover:text-red-800 px-1",title:"Remove assignment",children:"âœ•"})]},e.id)),c.jsx("button",{onClick:()=>{F(t),C(!0)},className:"w-full text-xs bg-blue-50 hover:bg-blue-100 text-blue-700 border border-blue-200 rounded px-2 py-1 transition-colors",children:"+ Assign Attendant"})]})]}),(0,c.jsxs)("div",{className:"flex flex-wrap gap-2 mb-4",children:[c.jsx("button",{onClick:()=>{if(t.shifts?.some(e=>e.isAllDay)){alert("Cannot add shifts: This position has an All-Day shift which covers the entire 24-hour period.");return}F(t),w(!0)},className:`text-xs px-2 py-1 rounded transition-colors ${t.shifts?.some(e=>e.isAllDay)?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-100 hover:bg-blue-200 text-blue-800"}`,disabled:t.shifts?.some(e=>e.isAllDay),children:"â° Add Shifts"}),c.jsx("button",{onClick:()=>{F(t),k(!0)},className:"text-xs bg-green-100 hover:bg-green-200 text-green-800 px-2 py-1 rounded transition-colors",children:"\uD83D\uDC65 Assign Overseer"}),c.jsx("button",{onClick:()=>ei(t),className:"text-xs bg-gray-100 hover:bg-gray-200 text-gray-800 px-2 py-1 rounded transition-colors",children:"âœï¸ Edit"})]}),t.shifts&&t.shifts.length>0&&(0,c.jsxs)("div",{className:"mb-4",children:[c.jsx("p",{className:"text-xs font-medium text-gray-500 mb-2",children:"â° Shifts:"}),(0,c.jsxs)("div",{className:"space-y-2",children:[t.shifts.map((s,i)=>(0,c.jsxs)("div",{className:`flex items-center justify-between px-3 py-2 rounded-lg text-xs border ${s.isAllDay?"bg-green-50 border-green-200 text-green-800":"bg-gray-50 border-gray-200 text-gray-700"}`,children:[(0,c.jsxs)("div",{className:"flex items-center",children:[c.jsx("span",{className:"font-medium",children:s.name}),s.isAllDay?c.jsx("span",{className:"ml-2 text-green-600",children:"(24 hours)"}):s.startTime&&s.endTime&&(0,c.jsxs)("span",{className:"ml-2 text-gray-600",children:[N(s.startTime)," - ",N(s.endTime)]})]}),c.jsx("button",{onClick:async()=>{if(confirm(`Delete shift "${s.name}"? This cannot be undone.`))try{let i=await fetch(`/api/events/${e}/positions/${t.id}/shifts`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({shiftId:s.id})});if(i.ok)n.reload();else{let e=await i.json();alert(`Failed to delete shift: ${e.error}`)}}catch(e){console.error("Error deleting shift:",e),alert("Failed to delete shift")}},className:"ml-2 text-red-500 hover:text-red-700 hover:bg-red-50 rounded p-1 transition-colors",title:"Delete shift",children:"\uD83D\uDDD1ï¸"})]},i)),t.shifts.some(e=>e.isAllDay)&&c.jsx("div",{className:"text-xs text-amber-600 bg-amber-50 border border-amber-200 rounded px-2 py-1",children:"âš ï¸ All-day shift active - no additional shifts allowed"})]})]}),c.jsx("div",{className:"flex space-x-2",children:t.isActive?(0,c.jsxs)(c.Fragment,{children:[c.jsx("button",{onClick:()=>ei(t),className:"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded text-sm font-medium transition-colors",children:"Edit"}),c.jsx("button",{onClick:()=>ea(t.id),className:"flex-1 bg-red-100 hover:bg-red-200 text-red-700 px-3 py-2 rounded text-sm font-medium transition-colors",children:"Delete"})]}):(0,c.jsxs)(c.Fragment,{children:[c.jsx("button",{onClick:async()=>{try{(await fetch(`/api/events/${e}/positions/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({isActive:!0})})).ok?eh():alert("Failed to activate position")}catch(e){alert("Failed to activate position")}},className:"flex-1 bg-green-100 hover:bg-green-200 text-green-700 px-3 py-2 rounded text-sm font-medium transition-colors",children:"âœ… Activate"}),ex&&c.jsx("button",{onClick:async()=>{if(confirm(`âš ï¸ PERMANENT DELETION âš ï¸

This will permanently delete "${t.name}" from the database.
This action CANNOT be undone.

Are you absolutely sure?`))try{let s=await fetch(`/api/events/${e}/positions/${t.id}?hardDelete=true`,{method:"DELETE"}),i=await s.json();s.ok?(alert(`Position "${t.name}" permanently deleted.`),eh()):i.dependencies?alert(`Cannot delete - has dependencies:
â€¢ ${i.dependencies.assignments} assignments
â€¢ ${i.dependencies.shifts} shifts

Remove dependencies first.`):alert(`Failed: ${i.error}`)}catch(e){alert("Failed to permanently delete position")}},className:"flex-1 bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded text-sm font-medium transition-colors",title:"Permanently delete position (Admin only)",children:"\uD83D\uDDD1ï¸ Delete Forever"})]})})]})},t.id))})]}),A&&c.jsx(b,{eventId:e,onClose:()=>$(!1),onSuccess:e=>{alert(`Successfully created ${e.created} positions`),$(!1),eh()}}),h&&c.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:c.jsx("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:(0,c.jsxs)("form",{onSubmit:es,children:[(0,c.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900",children:M?"Edit Position":"Create New Position"}),(0,c.jsxs)("button",{type:"button",onClick:en,className:"text-gray-400 hover:text-gray-600",children:[c.jsx("span",{className:"sr-only",children:"Close"}),c.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsxs)("div",{children:[c.jsx("label",{htmlFor:"positionNumber",className:"block text-sm font-medium text-gray-700 mb-1",children:"Position Number *"}),c.jsx("input",{type:"number",id:"positionNumber",value:ee.positionNumber,onChange:e=>et({...ee,positionNumber:parseInt(e.target.value)||1}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"1",max:"1000",required:!0})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Position Name *"}),c.jsx("input",{type:"text",id:"name",value:ee.name,onChange:e=>et({...ee,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Sound Operator, Parking Attendant",required:!0})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{htmlFor:"area",className:"block text-sm font-medium text-gray-700 mb-1",children:"Area"}),c.jsx("input",{type:"text",id:"area",value:ee.area,onChange:e=>et({...ee,area:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Main Hall, Parking Lot A"})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),c.jsx("textarea",{id:"description",value:ee.description,onChange:e=>et({...ee,description:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Brief description of the position..."})]})]}),(0,c.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[c.jsx("button",{type:"button",onClick:en,className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium transition-colors",children:"Cancel"}),c.jsx("button",{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:M?"Update Position":"Create Position"})]})]})})}),j&&O&&c.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:c.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,c.jsxs)("div",{className:"mt-3",children:[(0,c.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Add Shifts to ",O.name]}),(0,c.jsxs)("form",{onSubmit:er,children:[(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Time"}),c.jsx("input",{type:"time",value:G.startTime,onChange:e=>X({...G,startTime:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:G.isAllDay})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Time"}),c.jsx("input",{type:"time",value:G.endTime,onChange:e=>X({...G,endTime:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:G.isAllDay})]})]}),c.jsx("div",{children:(0,c.jsxs)("label",{className:"flex items-center",children:[c.jsx("input",{type:"checkbox",checked:G.isAllDay,onChange:e=>X({...G,isAllDay:e.target.checked}),className:"mr-2"}),c.jsx("span",{className:"text-sm text-gray-700",children:"All Day Shift"})]})})]}),(0,c.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[c.jsx("button",{type:"button",onClick:()=>w(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),c.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md",children:"Add Shift"})]})]})]})})}),S&&O&&c.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:c.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,c.jsxs)("div",{className:"mt-3",children:[(0,c.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Assign Overseer to ",O.name]}),(0,c.jsxs)("form",{onSubmit:el,children:[(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Overseer"}),(0,c.jsxs)("select",{value:Q.overseerId,onChange:e=>Z({...Q,overseerId:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[c.jsx("option",{value:"",children:"Select an overseer..."}),i?.filter(e=>(Array.isArray(e.formsOfService)?e.formsOfService:"string"==typeof e.formsOfService?e.formsOfService.split(",").map(e=>e.trim()):[]).some(e=>"overseer"===e.toLowerCase())).map(e=>c.jsxs("option",{value:e.id,children:[e.firstName," ",e.lastName," (Elder)"]},e.id))]})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Keyman (Optional)"}),(0,c.jsxs)("select",{value:Q.keymanId,onChange:e=>Z({...Q,keymanId:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[c.jsx("option",{value:"",children:"Select a keyman..."}),i?.filter(e=>(Array.isArray(e.formsOfService)?e.formsOfService:"string"==typeof e.formsOfService?e.formsOfService.split(",").map(e=>e.trim()):[]).some(e=>"keyman"===e.toLowerCase())).map(e=>c.jsxs("option",{value:e.id,children:[e.firstName," ",e.lastName," (MS)"]},e.id))]})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Responsibilities"}),c.jsx("textarea",{rows:3,value:Q.responsibilities,onChange:e=>Z({...Q,responsibilities:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Special instructions or responsibilities..."})]})]}),(0,c.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[c.jsx("button",{type:"button",onClick:()=>k(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),c.jsx("button",{type:"submit",className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md",children:"Assign Overseer"})]})]})]})})}),T&&O&&c.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:c.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,c.jsxs)("div",{className:"mt-3",children:[(0,c.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Assign Attendant to ",O.name,L&&(0,c.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:["Shift: ",L.name," ",!L.isAllDay&&`(${L.startTime} - ${L.endTime})`]})]}),(0,c.jsxs)("form",{onSubmit:async t=>{t.preventDefault();let s=new FormData(t.currentTarget),i=s.get("attendantId"),a=s.get("shiftId");if(!i){alert("Please select an attendant");return}if(!a){alert("Please select a shift");return}try{let t=await fetch(`/api/events/${e}/assignments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({positionId:O.id,attendantId:i,shiftId:a,role:"ATTENDANT"})});if(t.ok)alert("Attendant assigned successfully"),C(!1),q(null),n.reload();else{let e=await t.json();409===t.status?"DUPLICATE_SHIFT_ASSIGNMENT"===e.conflictType?alert("âš ï¸ Conflict: This attendant is already assigned to this shift."):"TIME_OVERLAP"===e.conflictType?alert(`âš ï¸ Time Conflict: This attendant has conflicting assignments:

${e.conflicts?.map(e=>`â€¢ ${e.positionName} - ${e.shiftName}`).join("\n")}

Please choose a different attendant or shift.`):"SHIFT_FULL"===e.conflictType?alert("âš ï¸ Shift Full: This shift already has the maximum number of attendants assigned (1)."):"ROLE_OCCUPIED"===e.conflictType?alert(`âš ï¸ Role Occupied: ${e.message}`):alert(`âš ï¸ Assignment Conflict: ${e.message||"Unable to assign attendant to this shift."}`):alert(`Failed to assign attendant: ${e.error||"Unknown error"}`)}}catch(e){console.error("Error assigning attendant:",e),alert("Failed to assign attendant")}},children:[(0,c.jsxs)("div",{className:"mb-4",children:[(0,c.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Select Attendant",(()=>{let e=O.assignments?.find(e=>"OVERSEER"===e.role)?.attendant,t=O.assignments?.find(e=>"KEYMAN"===e.role)?.attendant;return e||t?(0,c.jsxs)("span",{className:"text-xs text-blue-600 font-normal block mt-1",children:["Filtered to attendants under ",e?`${e.firstName} ${e.lastName} (Overseer)`:"",e&&t?" and ":"",t?`${t.firstName} ${t.lastName} (Keyman)`:""]}):null})()]}),(0,c.jsxs)("select",{name:"attendantId",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[c.jsx("option",{value:"",children:"Select an attendant..."}),(()=>{let e=O.assignments?.find(e=>"OVERSEER"===e.role)?.attendant,t=O.assignments?.find(e=>"KEYMAN"===e.role)?.attendant,s=i?.filter(e=>e.isActive)||[];return(e||t)&&(s=s.filter(s=>e&&s.overseerId===e.id||t&&s.keymanId===t.id)),s.map(s=>(0,c.jsxs)("option",{value:s.id,children:[s.firstName," ",s.lastName,s.congregation&&` (${s.congregation})`,e&&s.overseerId===e.id&&" - Under Overseer",t&&s.keymanId===t.id&&" - Under Keyman"]},s.id))})()]})]}),(0,c.jsxs)("div",{className:"mb-4",children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Shift"}),(0,c.jsxs)("select",{name:"shiftId",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,defaultValue:L?.id||"",children:[c.jsx("option",{value:"",children:"Select a shift..."}),O.shifts?.map(e=>c.jsxs("option",{value:e.id,children:[e.name," ",!e.isAllDay&&`(${e.startTime} - ${e.endTime})`]},e.id))]})]}),(0,c.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[c.jsx("button",{type:"button",onClick:()=>{C(!1),q(null)},className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),c.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md",children:"Assign Attendant"})]})]})]})})}),D&&K.size>0&&c.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:c.jsx("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white max-h-screen overflow-y-auto",children:(0,c.jsxs)("div",{className:"mt-3",children:[(0,c.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Bulk Operations - ",K.size," Positions Selected"]}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,c.jsxs)("div",{className:"space-y-4",children:[c.jsx("h4",{className:"font-medium text-gray-900",children:"Basic Properties"}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Area (leave blank to keep current)"}),c.jsx("input",{id:"bulk-area",type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Main Hall, Parking, etc."})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,c.jsxs)("select",{id:"bulk-status",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[c.jsx("option",{value:"",children:"Keep current status"}),c.jsx("option",{value:"true",children:"Active"}),c.jsx("option",{value:"false",children:"Inactive"})]})]})]}),(0,c.jsxs)("div",{className:"space-y-4",children:[c.jsx("h4",{className:"font-medium text-gray-900",children:"Leadership Assignment"}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assign Overseer to All"}),(0,c.jsxs)("select",{id:"bulk-overseer",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",children:[c.jsx("option",{value:"",children:"No change"}),i?.filter(e=>e.isActive&&Array.isArray(e.formsOfService)&&e.formsOfService.some(e=>"overseer"===e.toLowerCase())).map(e=>c.jsxs("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assign Keyman to All"}),(0,c.jsxs)("select",{id:"bulk-keyman",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",children:[c.jsx("option",{value:"",children:"No change"}),i?.filter(e=>e.isActive&&Array.isArray(e.formsOfService)&&e.formsOfService.some(e=>"keyman"===e.toLowerCase())).map(e=>c.jsxs("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]})]})]}),(0,c.jsxs)("div",{className:"md:col-span-2 space-y-4",children:[c.jsx("h4",{className:"font-medium text-gray-900",children:"Add Shift to All Positions"}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Shift Name"}),c.jsx("input",{id:"bulk-shift-name",type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"e.g., Morning Shift"})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Time"}),c.jsx("input",{id:"bulk-shift-start",type:"time",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Time"}),c.jsx("input",{id:"bulk-shift-end",type:"time",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]})]}),(0,c.jsxs)("div",{className:"flex items-center",children:[c.jsx("input",{id:"bulk-shift-allday",type:"checkbox",className:"h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded"}),c.jsx("label",{htmlFor:"bulk-shift-allday",className:"ml-2 block text-sm text-gray-900",children:"All Day Shift (24 hours)"})]})]})]}),(0,c.jsxs)("div",{className:"flex justify-end space-x-3 mt-8 pt-6 border-t",children:[c.jsx("button",{type:"button",onClick:()=>P(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),c.jsx("button",{onClick:async()=>{try{J(!0);let t=0,s=document.getElementById("bulk-area")?.value,i=document.getElementById("bulk-status")?.value,a=document.getElementById("bulk-overseer")?.value,r=document.getElementById("bulk-keyman")?.value,l=document.getElementById("bulk-shift-name")?.value,o=document.getElementById("bulk-shift-start")?.value,d=document.getElementById("bulk-shift-end")?.value,c=document.getElementById("bulk-shift-allday")?.checked;for(let n of K){if(s||""!==i){let t={};s&&(t.area=s),""!==i&&(t.isActive="true"===i);let a=await fetch(`/api/events/${e}/positions/${n}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){let e=await a.json();throw console.error(`Failed to update position ${n}:`,e),Error(`Position update failed: ${e.error}`)}}if(a||r){let t={positionId:n};a&&(t.overseerId=a),r&&(t.keymanId=r);let s=await fetch(`/api/events/${e}/positions/${n}/overseer`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok){let e=await s.json();throw console.error(`Failed to assign overseer/keyman to position ${n}:`,e),Error(`Overseer assignment failed: ${e.error}`)}}if(console.log("Shift form values:",{shiftName:l,shiftStart:o,shiftEnd:d,isAllDay:c}),c||o&&d){console.log(`Creating shift for position ${n}`);let t=await fetch(`/api/events/${e}/positions/${n}/shifts`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({startTime:c?null:o,endTime:c?null:d,isAllDay:c})});if(console.log(`Shift API response status: ${t.status}`),t.ok){let e=await t.json();console.log(`Successfully created shift for position ${n}:`,e)}else{let e=await t.json();throw console.error(`Failed to create shift for position ${n}:`,e),Error(`Shift creation failed: ${e.error}`)}}else console.log("Skipping shift creation - no valid shift data provided");t++}alert(`Successfully processed ${t} of ${K.size} positions`),P(!1),V(new Set),n.reload()}catch(e){console.error("Error in bulk operations:",e),alert("Failed to complete bulk operations")}finally{J(!1)}},disabled:U,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-md font-medium",children:U?"Processing...":`Apply to ${K.size} Positions`})]})]})})}),E&&K.size>0&&c.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:c.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,c.jsxs)("div",{className:"mt-3",children:[(0,c.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Apply Shift Template to ",K.size," Position(s)"]}),(0,c.jsxs)("form",{onSubmit:async t=>{t.preventDefault();let s=new FormData(t.currentTarget).get("templateType");if(!s){alert("Please select a template");return}try{J(!0);let t=await fetch(`/api/events/${e}/positions/apply-shift-template`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({positionIds:Array.from(K),templateType:s})});if(t.ok){let e=await t.json();alert(`âœ… Template Applied Successfully!

â€¢ Positions: ${e.data.positionsProcessed}
â€¢ Shifts Created: ${e.data.totalShiftsCreated}
â€¢ Template: ${e.data.templateType}`),I(!1),V(new Set),n.reload()}else{let e=await t.json();alert(`Failed to apply template: ${e.error||"Unknown error"}`)}}catch(e){console.error("Error applying template:",e),alert("Failed to apply template")}finally{J(!1)}},children:[(0,c.jsxs)("div",{className:"mb-4",children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Shift Template"}),(0,c.jsxs)("select",{name:"templateType",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[c.jsx("option",{value:"",children:"Choose a template..."}),c.jsx("option",{value:"standard",children:"Standard Day (7:50-10, 10-12, 12-2, 2-5)"}),c.jsx("option",{value:"extended",children:"Extended Day (6:30-8:30, 8:30-10:30, 10:30-12:45, 12:45-3, 3-Close)"})]})]}),c.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:(0,c.jsxs)("p",{className:"text-xs text-blue-800",children:[c.jsx("strong",{children:"Note:"})," This will create shifts for all selected positions. Existing shifts will not be affected."]})}),(0,c.jsxs)("div",{className:"flex justify-end space-x-3",children:[c.jsx("button",{type:"button",onClick:()=>{I(!1)},className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),c.jsx("button",{type:"submit",disabled:U,className:"px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white rounded-md",children:U?"Applying...":"Apply Template"})]})]})]})})})]})]}):null}let w=async e=>{if(!await (0,y.getServerSession)(e.req,e.res,v.L))return{redirect:{destination:"/auth/signin",permanent:!1}};let{id:t}=e.params;try{let{prisma:e}=await Promise.resolve().then(s.bind(s,8925)),i=await e.events.findUnique({where:{id:t},include:{positions:{include:{assignments:{include:{attendant:{select:{id:!0,firstName:!0,lastName:!0}},overseer:{select:{id:!0,firstName:!0,lastName:!0}},keyman:{select:{id:!0,firstName:!0,lastName:!0}}}},shifts:!0},orderBy:[{positionNumber:"asc"}]}}}),a=await e.attendants.findMany({where:{isActive:!0},select:{id:!0,firstName:!0,lastName:!0,formsOfService:!0,congregation:!0,isActive:!0},orderBy:[{firstName:"asc"},{lastName:"asc"}]});if(!i)return{notFound:!0};let n={id:i.id,name:i.name,eventType:i.eventType,startDate:i.startDate?.toISOString()||null,endDate:i.endDate?.toISOString()||null,status:i.status},r=i.positions.map(e=>({id:e.id,positionNumber:e.positionNumber,name:e.name,description:e.description,area:e.area||null,sequence:e.sequence||e.positionNumber,isActive:e.isActive,assignments:e.assignments.map(e=>({id:e.id,role:e.role||"ATTENDANT",attendant:e.attendant?{id:e.attendant.id,firstName:e.attendant.firstName,lastName:e.attendant.lastName}:null,overseer:e.overseer?{id:e.overseer.id,firstName:e.overseer.firstName,lastName:e.overseer.lastName}:null,keyman:e.keyman?{id:e.keyman.id,firstName:e.keyman.firstName,lastName:e.keyman.lastName}:null})).filter(e=>null!==e.attendant),shifts:e.shifts||[]}));return{props:{eventId:t,event:n,positions:r,attendants:a,stats:{total:r.length,active:r.filter(e=>e.isActive).length,assigned:r.filter(e=>e.assignments.length>0).length}}}}catch(e){return console.error("Error fetching positions data:",e),{notFound:!0}}},S=(0,r.l)(i,"default"),k=(0,r.l)(i,"getStaticProps"),A=(0,r.l)(i,"getStaticPaths"),$=(0,r.l)(i,"getServerSideProps"),T=(0,r.l)(i,"config"),C=(0,r.l)(i,"reportWebVitals"),D=(0,r.l)(i,"unstable_getStaticProps"),P=(0,r.l)(i,"unstable_getStaticPaths"),E=(0,r.l)(i,"unstable_getStaticParams"),I=(0,r.l)(i,"unstable_getServerProps"),O=(0,r.l)(i,"unstable_getServerSideProps"),F=new a.PagesRouteModule({definition:{kind:n.x.PAGES,page:"/events/[id]/positions",pathname:"/events/[id]/positions",bundlePath:"",filename:""},components:{App:d.default,Document:o()},userland:i})},6814:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n});var i=s(997),a=s(1649);function n({Component:e,pageProps:{session:t,...s}}){return i.jsx(a.SessionProvider,{session:t,children:i.jsx(e,{...s})})}s(6764)},5175:(e,t,s)=>{"use strict";s.d(t,{L:()=>c});var i=s(3227),a=s.n(i);let n=require("next-auth/providers/credentials");var r=s.n(n),l=s(8925);let o=require("bcryptjs");var d=s.n(o);let c={providers:[r()({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await l.prisma.users.findUnique({where:{email:e.email}});return t&&t.passwordHash&&await d().compare(e.password,t.passwordHash)?{id:t.id,email:t.email,name:`${t.firstName} ${t.lastName}`,role:t.role}:null}})],callbacks:{jwt:async({token:e,user:t})=>(t&&(e.role=t.role),e),session:async({session:e,token:t})=>(t&&(e.user.id=t.sub,e.user.role=t.role),e)},pages:{signIn:"/auth/signin"},session:{strategy:"jwt",maxAge:2592e3},cookies:{sessionToken:{name:"__Secure-next-auth.session-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0}}},secret:"staging-nextauth-secret-2024"};a()(c)},8925:(e,t,s)=>{"use strict";s.r(t),s.d(t,{prisma:()=>a});let i=require("@prisma/client"),a=globalThis.prisma??new i.PrismaClient},6764:()=>{},3227:e=>{"use strict";e.exports=require("next-auth")},1649:e=>{"use strict";e.exports=require("next-auth/react")},2785:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{"use strict";e.exports=require("next/head")},6689:e=>{"use strict";e.exports=require("react")},6405:e=>{"use strict";e.exports=require("react-dom")},997:e=>{"use strict";e.exports=require("react/jsx-runtime")},2048:e=>{"use strict";e.exports=require("fs")},5315:e=>{"use strict";e.exports=require("path")},6162:e=>{"use strict";e.exports=require("stream")},1568:e=>{"use strict";e.exports=require("zlib")}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),i=t.X(0,[2899,8342,1664],()=>s(4483));module.exports=i})();