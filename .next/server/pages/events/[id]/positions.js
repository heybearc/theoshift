(()=>{var e={};e.id=2801,e.ids=[2801,2888,660],e.modules={109:(e,s,t)=>{"use strict";t.r(s),t.d(s,{config:()=>C,default:()=>w,getServerSideProps:()=>A,getStaticPaths:()=>k,getStaticProps:()=>S,reportWebVitals:()=>D,routeModule:()=>I,unstable_getServerProps:()=>$,unstable_getServerSideProps:()=>O,unstable_getStaticParams:()=>E,unstable_getStaticPaths:()=>T,unstable_getStaticProps:()=>P});var a={};t.r(a),t.d(a,{default:()=>j,getServerSideProps:()=>N});var r=t(7093),i=t(5244),n=t(1323),l=t(2899),o=t.n(l),d=t(6814),c=t(997),m=t(6689),u=t(1163),x=t(1649),h=t(968),g=t.n(h),p=t(1664),b=t.n(p);let f=require("next-auth/next");var y=t(5175);function v(e){if(!e)return"";let[s,t]=e.split(":"),a=parseInt(s,10);return`${0===a?12:a>12?a-12:a}:${t} ${a>=12?"PM":"AM"}`}function j({eventId:e,event:s,positions:t,attendants:a,stats:r}){let i=(0,u.useRouter)(),[n,l]=(0,m.useState)(!1),[o,d]=(0,m.useState)(""),[h,p]=(0,m.useState)(!1),[f,y]=(0,m.useState)(!1),[j,N]=(0,m.useState)(!1),[w,S]=(0,m.useState)(!1),[k,A]=(0,m.useState)(!1),[C,D]=(0,m.useState)(!1),[P,T]=(0,m.useState)(!1),[E,$]=(0,m.useState)(null),[O,I]=(0,m.useState)(null),[q,F]=(0,m.useState)(null),[z,B]=(0,m.useState)(!1),[L,_]=(0,m.useState)(""),[M,U]=(0,m.useState)(new Set),[J,R]=(0,m.useState)({startTime:"",endTime:"",isAllDay:!1}),[H,W]=(0,m.useState)({overseerId:"",keymanId:"",responsibilities:""}),[K,V]=(0,m.useState)({positionNumber:1,name:"",area:"",description:""}),G=async s=>{if(s.preventDefault(),!K.name.trim()){alert("Position name is required");return}try{let s=O?`/api/events/${e}/positions/${O.id}`:`/api/events/${e}/positions`,t=await fetch(s,{method:O?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(K)});if(t.ok)alert(O?"Position updated successfully":"Position created successfully"),p(!1),I(null),V({positionNumber:1,name:"",area:"",description:""}),i.reload();else{let e=await t.json();alert(e.error||"Failed to save position")}}catch(e){console.error("Error saving position:",e),alert("Failed to save position")}},X=e=>{I(e),V({positionNumber:e.positionNumber,name:e.name,area:e.area||"",description:e.description||""}),p(!0)},Q=async s=>{if(confirm(`Are you sure you want to delete position #${s}? This action cannot be undone.`))try{let t=await fetch(`/api/events/${e}/positions/${s}`,{method:"DELETE"});if(t.ok)alert("Position deleted successfully"),i.reload();else{let e=await t.json();alert(e.error||"Failed to delete position")}}catch(e){console.error("Error deleting position:",e),alert("Failed to delete position")}},Y=()=>{p(!1),I(null),V({positionNumber:1,name:"",area:"",description:""})},Z=async s=>{if(s.preventDefault(),E)try{let s=await fetch(`/api/events/${e}/positions/${E.id}/shifts`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({startTime:J.startTime,endTime:J.endTime,isAllDay:J.isAllDay,positionId:E.id})});if(s.ok)alert("Shift added successfully"),N(!1),R({startTime:"",endTime:"",isAllDay:!1}),i.reload();else{let e=await s.json();alert(`Failed to add shift: ${e.error||"Unknown error"}`)}}catch(e){console.error("Error adding shift:",e),alert("Failed to add shift")}},ee=async s=>{if(s.preventDefault(),E)try{let s=await fetch(`/api/events/${e}/positions/${E.id}/overseer`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({overseerId:H.overseerId,keymanId:H.keymanId||null,responsibilities:H.responsibilities,positionId:E.id})});if(s.ok)alert("Overseer assigned successfully"),S(!1),W({overseerId:"",keymanId:"",responsibilities:""}),i.reload();else{let e=await s.json();alert(`Failed to assign overseer: ${e.error||"Unknown error"}`)}}catch(e){console.error("Error assigning overseer:",e),alert("Failed to assign overseer")}},es=async s=>{if(confirm("Are you sure you want to remove this assignment?"))try{(await fetch(`/api/events/${e}/assignments/${s}`,{method:"DELETE"})).ok?i.reload():alert("Failed to remove assignment")}catch(e){console.error("Error removing assignment:",e),alert("Failed to remove assignment")}},et=async()=>{if(confirm("Auto-assign available attendants to unfilled positions?"))try{B(!0);let s=new Set,r=new Set;t.forEach(e=>{e.assignments?.forEach(e=>{e.attendant?.id&&s.add(e.attendant.id),e.overseer?.id&&r.add(e.overseer.id),e.keyman?.id&&r.add(e.keyman.id)})});let n=a.filter(e=>e.isActive&&!s.has(e.id)&&!r.has(e.id)),l=t.filter(e=>e.isActive&&2>(e.assignments?.length||0)),o=0;for(let t of l){if(0===n.length)break;let a=n.shift();a&&(await fetch(`/api/events/${e}/assignments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({positionId:t.id,attendantId:a.id,role:"ATTENDANT"})})).ok&&(o++,s.add(a.id))}alert(`Auto-assigned ${o} attendants successfully!`),i.reload()}catch(e){console.error("Auto-assign error:",e),alert("Failed to auto-assign attendants")}finally{B(!1)}},ea=()=>{let e=new Set,s=new Set;return t.forEach(t=>{t.assignments?.forEach(t=>{t.attendant?.id&&e.add(t.attendant.id),t.overseer?.id&&s.add(t.overseer.id),t.keyman?.id&&s.add(t.keyman.id)})}),a.filter(t=>t.isActive&&!e.has(t.id)&&!s.has(t.id)).length},{data:er}=(0,x.useSession)();return n?c.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,c.jsxs)("div",{className:"text-center",children:[c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),c.jsx("p",{className:"mt-4 text-gray-600",children:"Loading positions..."})]})}):er?(0,c.jsxs)(c.Fragment,{children:[c.jsx(g(),{children:(0,c.jsxs)("title",{children:[s?.name?`${s.name} - Positions`:"Event Positions"," | JW Attendant Scheduler"]})}),(0,c.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,c.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,c.jsxs)("div",{className:"mb-8",children:[(0,c.jsxs)("nav",{className:"flex items-center space-x-2 text-sm text-gray-500 mb-4",children:[c.jsx(b(),{href:"/events",className:"hover:text-gray-700",children:"Events"}),c.jsx("span",{children:"›"}),c.jsx(b(),{href:`/events/${e}`,className:"hover:text-gray-700",children:s?.name||"Event"}),c.jsx("span",{children:"›"}),c.jsx("span",{className:"text-gray-900",children:"Positions"})]}),(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsxs)("div",{children:[c.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Event Positions"}),(0,c.jsxs)("p",{className:"text-gray-600 mt-2",children:["Manage positions and roles for ",s?.name]})]}),(0,c.jsxs)("div",{className:"flex space-x-3",children:[c.jsx(b(),{href:`/events/${e}`,className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium transition-colors",children:"← Back to Event"}),M.size>0&&(0,c.jsxs)("div",{className:"flex items-center space-x-2 bg-blue-50 border border-blue-200 rounded-lg px-3 py-2",children:[(0,c.jsxs)("span",{className:"text-sm text-blue-700 font-medium",children:[M.size," selected"]}),c.jsx("button",{onClick:()=>{confirm(`Delete ${M.size} selected positions?`)&&alert("Bulk delete coming soon!")},className:"text-xs bg-red-100 hover:bg-red-200 text-red-700 px-2 py-1 rounded",children:"Delete"}),c.jsx("button",{onClick:()=>T(!0),className:"text-xs bg-blue-100 hover:bg-blue-200 text-blue-700 px-2 py-1 rounded",children:"Edit"}),c.jsx("button",{onClick:()=>U(new Set),className:"text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 px-2 py-1 rounded",children:"Clear"})]}),(0,c.jsxs)("button",{onClick:et,disabled:z||0===ea(),className:"bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg font-medium transition-colors",title:`Auto-assign ${ea()} available attendants`,children:["\uD83E\uDD16 Auto-Assign (",ea(),")"]}),c.jsx("button",{onClick:()=>A(!0),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"\uD83D\uDE80 Bulk Create"}),c.jsx("button",{onClick:()=>p(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"+ Create Position"})]})]})]}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[c.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:(0,c.jsxs)("div",{className:"flex items-center",children:[c.jsx("div",{className:"flex-shrink-0",children:c.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:c.jsx("span",{className:"text-blue-600 font-semibold",children:"\uD83D\uDCCB"})})}),(0,c.jsxs)("div",{className:"ml-4",children:[c.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Positions"}),c.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:t.length})]})]})}),c.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:(0,c.jsxs)("div",{className:"flex items-center",children:[c.jsx("div",{className:"flex-shrink-0",children:c.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center",children:c.jsx("span",{className:"text-green-600 font-semibold",children:"✓"})})}),(0,c.jsxs)("div",{className:"ml-4",children:[c.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Active Positions"}),c.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:t.filter(e=>e.isActive).length})]})]})}),c.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:(0,c.jsxs)("div",{className:"flex items-center",children:[c.jsx("div",{className:"flex-shrink-0",children:c.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:c.jsx("span",{className:"text-purple-600 font-semibold",children:"\uD83C\uDFE2"})})}),(0,c.jsxs)("div",{className:"ml-4",children:[c.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Areas"}),c.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:new Set(t.map(e=>e.area).filter(Boolean)).size})]})]})}),c.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:(0,c.jsxs)("div",{className:"flex items-center",children:[c.jsx("div",{className:"flex-shrink-0",children:c.jsx("div",{className:"w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center",children:c.jsx("span",{className:"text-orange-600 font-semibold",children:"\uD83D\uDC65"})})}),(0,c.jsxs)("div",{className:"ml-4",children:[c.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Assignments"}),c.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:t.reduce((e,s)=>e+(s.assignments?.length||0),0)})]})]})})]}),c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:0===t.length?(0,c.jsxs)("div",{className:"col-span-full bg-white rounded-lg shadow p-12 text-center",children:[c.jsx("span",{className:"text-6xl mb-4 block",children:"\uD83D\uDCCB"}),c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No positions created"}),c.jsx("p",{className:"text-gray-500 mb-4",children:"Create your first position to get started"}),(0,c.jsxs)("div",{className:"flex justify-center space-x-4",children:[c.jsx("button",{onClick:()=>A(!0),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"\uD83D\uDE80 Bulk Create"}),c.jsx("button",{onClick:()=>p(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"Create Position"})]})]}):t.map(e=>c.jsx("div",{className:"bg-white rounded-lg shadow hover:shadow-md transition-shadow",children:(0,c.jsxs)("div",{className:"p-6",children:[(0,c.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,c.jsxs)("div",{className:"flex items-start space-x-3",children:[c.jsx("input",{type:"checkbox",checked:M.has(e.id),onChange:s=>{let t=new Set(M);s.target.checked?t.add(e.id):t.delete(e.id),U(t)},className:"mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,c.jsxs)("div",{children:[c.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:e.name}),e.area&&c.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:e.area})]})]}),c.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:e.isActive?"Active":"Inactive"})]}),e.description&&c.jsx("p",{className:"text-sm text-gray-600 mb-3",children:e.description}),e.assignments&&e.assignments.length>0&&c.jsx("div",{className:"mb-3",children:e.assignments.some(e=>e.overseer||e.keyman)&&(0,c.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-3",children:[c.jsx("p",{className:"text-xs font-medium text-blue-800 mb-2",children:"\uD83D\uDC65 Leadership"}),(0,c.jsxs)("div",{className:"space-y-1",children:[e.assignments.filter(e=>e.overseer).map(e=>(0,c.jsxs)("div",{className:"text-xs text-blue-700",children:[c.jsx("span",{className:"font-medium",children:"Overseer:"})," ",e.overseer?.firstName," ",e.overseer?.lastName]},e.id)),e.assignments.filter(e=>e.keyman).map(e=>(0,c.jsxs)("div",{className:"text-xs text-blue-700",children:[c.jsx("span",{className:"font-medium",children:"Keyman:"})," ",e.keyman?.firstName," ",e.keyman?.lastName]},e.id))]})]})}),(0,c.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-500 mb-4",children:[(0,c.jsxs)("span",{children:["Position #",e.positionNumber]}),(0,c.jsxs)("span",{children:[e.assignments?.length||0," assignments"]})]}),e.assignments&&e.assignments.length>0&&(0,c.jsxs)("div",{className:"mb-4",children:[c.jsx("p",{className:"text-xs font-medium text-gray-500 mb-2",children:"\uD83D\uDC64 Assigned Attendants"}),(0,c.jsxs)("div",{className:"space-y-1",children:[e.assignments.filter(e=>"OVERSEER"!==e.role).map(e=>(0,c.jsxs)("div",{className:"flex items-center justify-between bg-gray-50 border border-gray-200 rounded px-2 py-1",children:[(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsxs)("span",{className:"text-xs font-medium text-gray-700",children:[e.attendant?.firstName," ",e.attendant?.lastName]}),(0,c.jsxs)("span",{className:"ml-2 text-xs text-gray-500",children:["(",e.role||"Attendant",")"]})]}),c.jsx("button",{onClick:()=>es(e.id),className:"text-xs text-red-600 hover:text-red-800 px-1",title:"Remove assignment",children:"✕"})]},e.id)),c.jsx("button",{onClick:()=>{$(e),D(!0)},className:"w-full text-xs bg-blue-50 hover:bg-blue-100 text-blue-700 border border-blue-200 rounded px-2 py-1 transition-colors",children:"+ Assign Attendant"})]})]}),(0,c.jsxs)("div",{className:"flex flex-wrap gap-2 mb-4",children:[c.jsx("button",{onClick:()=>{if(e.shifts?.some(e=>e.isAllDay)){alert("Cannot add shifts: This position has an All-Day shift which covers the entire 24-hour period.");return}$(e),N(!0)},className:`text-xs px-2 py-1 rounded transition-colors ${e.shifts?.some(e=>e.isAllDay)?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-100 hover:bg-blue-200 text-blue-800"}`,disabled:e.shifts?.some(e=>e.isAllDay),children:"⏰ Add Shifts"}),c.jsx("button",{onClick:()=>{$(e),S(!0)},className:"text-xs bg-green-100 hover:bg-green-200 text-green-800 px-2 py-1 rounded transition-colors",children:"\uD83D\uDC65 Assign Overseer"}),c.jsx("button",{onClick:()=>X(e),className:"text-xs bg-gray-100 hover:bg-gray-200 text-gray-800 px-2 py-1 rounded transition-colors",children:"✏️ Edit"})]}),e.shifts&&e.shifts.length>0&&(0,c.jsxs)("div",{className:"mb-4",children:[c.jsx("p",{className:"text-xs font-medium text-gray-500 mb-2",children:"⏰ Shifts:"}),(0,c.jsxs)("div",{className:"space-y-2",children:[e.shifts.map((e,s)=>(0,c.jsxs)("div",{className:`inline-flex items-center px-3 py-2 rounded-lg text-xs border ${e.isAllDay?"bg-green-50 border-green-200 text-green-800":"bg-gray-50 border-gray-200 text-gray-700"}`,children:[c.jsx("span",{className:"font-medium",children:e.name}),e.isAllDay?c.jsx("span",{className:"ml-2 text-green-600",children:"(24 hours)"}):e.startTime&&e.endTime&&(0,c.jsxs)("span",{className:"ml-2 text-gray-600",children:[v(e.startTime)," - ",v(e.endTime)]})]},s)),e.shifts.some(e=>e.isAllDay)&&c.jsx("div",{className:"text-xs text-amber-600 bg-amber-50 border border-amber-200 rounded px-2 py-1",children:"⚠️ All-day shift active - no additional shifts allowed"})]})]}),(0,c.jsxs)("div",{className:"flex space-x-2",children:[c.jsx("button",{onClick:()=>X(e),className:"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded text-sm font-medium transition-colors",children:"Edit"}),c.jsx("button",{onClick:()=>Q(e.id),className:"flex-1 bg-red-100 hover:bg-red-200 text-red-700 px-3 py-2 rounded text-sm font-medium transition-colors",children:"Delete"})]})]})},e.id))})]}),k&&c.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:c.jsx("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:(0,c.jsxs)("div",{className:"text-center p-8",children:[c.jsx("h3",{className:"text-lg font-medium mb-4",children:"Bulk Position Creator"}),c.jsx("p",{className:"text-gray-600 mb-4",children:"Coming in Phase 2 - Bulk position operations"}),c.jsx("button",{onClick:()=>A(!1),className:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded",children:"Close"})]})})}),h&&c.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:c.jsx("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:(0,c.jsxs)("form",{onSubmit:G,children:[(0,c.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900",children:O?"Edit Position":"Create New Position"}),(0,c.jsxs)("button",{type:"button",onClick:Y,className:"text-gray-400 hover:text-gray-600",children:[c.jsx("span",{className:"sr-only",children:"Close"}),c.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsxs)("div",{children:[c.jsx("label",{htmlFor:"positionNumber",className:"block text-sm font-medium text-gray-700 mb-1",children:"Position Number *"}),c.jsx("input",{type:"number",id:"positionNumber",value:K.positionNumber,onChange:e=>V({...K,positionNumber:parseInt(e.target.value)||1}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"1",max:"1000",required:!0})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Position Name *"}),c.jsx("input",{type:"text",id:"name",value:K.name,onChange:e=>V({...K,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Sound Operator, Parking Attendant",required:!0})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{htmlFor:"area",className:"block text-sm font-medium text-gray-700 mb-1",children:"Area"}),c.jsx("input",{type:"text",id:"area",value:K.area,onChange:e=>V({...K,area:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Main Hall, Parking Lot A"})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),c.jsx("textarea",{id:"description",value:K.description,onChange:e=>V({...K,description:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Brief description of the position..."})]})]}),(0,c.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[c.jsx("button",{type:"button",onClick:Y,className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium transition-colors",children:"Cancel"}),c.jsx("button",{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:O?"Update Position":"Create Position"})]})]})})}),j&&E&&c.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:c.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,c.jsxs)("div",{className:"mt-3",children:[(0,c.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Add Shifts to ",E.name]}),(0,c.jsxs)("form",{onSubmit:Z,children:[(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Time"}),c.jsx("input",{type:"time",value:J.startTime,onChange:e=>R({...J,startTime:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:J.isAllDay})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Time"}),c.jsx("input",{type:"time",value:J.endTime,onChange:e=>R({...J,endTime:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:J.isAllDay})]})]}),c.jsx("div",{children:(0,c.jsxs)("label",{className:"flex items-center",children:[c.jsx("input",{type:"checkbox",checked:J.isAllDay,onChange:e=>R({...J,isAllDay:e.target.checked}),className:"mr-2"}),c.jsx("span",{className:"text-sm text-gray-700",children:"All Day Shift"})]})})]}),(0,c.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[c.jsx("button",{type:"button",onClick:()=>N(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),c.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md",children:"Add Shift"})]})]})]})})}),w&&E&&c.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:c.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,c.jsxs)("div",{className:"mt-3",children:[(0,c.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Assign Overseer to ",E.name]}),(0,c.jsxs)("form",{onSubmit:ee,children:[(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Overseer"}),(0,c.jsxs)("select",{value:H.overseerId,onChange:e=>W({...H,overseerId:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[c.jsx("option",{value:"",children:"Select an overseer..."}),a?.filter(e=>(Array.isArray(e.formsOfService)?e.formsOfService:"string"==typeof e.formsOfService?e.formsOfService.split(",").map(e=>e.trim()):[]).some(e=>"overseer"===e.toLowerCase())).map(e=>c.jsxs("option",{value:e.id,children:[e.firstName," ",e.lastName," (Elder)"]},e.id))]})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Keyman (Optional)"}),(0,c.jsxs)("select",{value:H.keymanId,onChange:e=>W({...H,keymanId:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[c.jsx("option",{value:"",children:"Select a keyman..."}),a?.filter(e=>(Array.isArray(e.formsOfService)?e.formsOfService:"string"==typeof e.formsOfService?e.formsOfService.split(",").map(e=>e.trim()):[]).some(e=>"keyman"===e.toLowerCase())).map(e=>c.jsxs("option",{value:e.id,children:[e.firstName," ",e.lastName," (MS)"]},e.id))]})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Responsibilities"}),c.jsx("textarea",{rows:3,value:H.responsibilities,onChange:e=>W({...H,responsibilities:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Special instructions or responsibilities..."})]})]}),(0,c.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[c.jsx("button",{type:"button",onClick:()=>S(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),c.jsx("button",{type:"submit",className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md",children:"Assign Overseer"})]})]})]})})}),C&&E&&c.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:c.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,c.jsxs)("div",{className:"mt-3",children:[(0,c.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Assign Attendant to ",E.name]}),(0,c.jsxs)("form",{onSubmit:async s=>{s.preventDefault();let t=new FormData(s.currentTarget).get("attendantId");if(!t){alert("Please select an attendant");return}try{(await fetch(`/api/events/${e}/assignments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({positionId:E.id,attendantId:t,role:"ATTENDANT"})})).ok?(alert("Attendant assigned successfully"),D(!1),i.reload()):alert("Failed to assign attendant")}catch(e){console.error("Error assigning attendant:",e),alert("Failed to assign attendant")}},children:[(0,c.jsxs)("div",{className:"mb-4",children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Attendant"}),(0,c.jsxs)("select",{name:"attendantId",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[c.jsx("option",{value:"",children:"Select an attendant..."}),a?.filter(e=>e.isActive).map(e=>c.jsxs("option",{value:e.id,children:[e.firstName," ",e.lastName,e.congregation&&` (${e.congregation})`]},e.id))]})]}),(0,c.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[c.jsx("button",{type:"button",onClick:()=>D(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),c.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md",children:"Assign Attendant"})]})]})]})})}),P&&M.size>0&&c.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:c.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,c.jsxs)("div",{className:"mt-3",children:[(0,c.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Bulk Edit ",M.size," Positions"]}),(0,c.jsxs)("form",{onSubmit:async s=>{s.preventDefault();let t=new FormData(s.currentTarget),a=t.get("area"),r=t.get("isActive");try{let s=0;for(let t of M){let i={};a&&(i.area=a),""!==r&&(i.isActive="true"===r),(await fetch(`/api/events/${e}/positions/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})).ok&&s++}alert(`Successfully updated ${s} of ${M.size} positions`),T(!1),U(new Set),i.reload()}catch(e){console.error("Error bulk editing positions:",e),alert("Failed to update positions")}},children:[(0,c.jsxs)("div",{className:"mb-4",children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Area (leave blank to keep current)"}),c.jsx("input",{name:"area",type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Main Hall, Parking, etc."})]}),(0,c.jsxs)("div",{className:"mb-4",children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,c.jsxs)("select",{name:"isActive",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[c.jsx("option",{value:"",children:"Keep current status"}),c.jsx("option",{value:"true",children:"Active"}),c.jsx("option",{value:"false",children:"Inactive"})]})]}),(0,c.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[c.jsx("button",{type:"button",onClick:()=>T(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),(0,c.jsxs)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md",children:["Update ",M.size," Positions"]})]})]})]})})})]})]}):null}let N=async e=>{if(!await (0,f.getServerSession)(e.req,e.res,y.L))return{redirect:{destination:"/auth/signin",permanent:!1}};let{id:s}=e.params;try{let{prisma:e}=await Promise.resolve().then(t.bind(t,8925)),a=await e.events.findUnique({where:{id:s},include:{positions:{include:{assignments:{include:{attendant:{select:{id:!0,firstName:!0,lastName:!0}},overseer:{select:{id:!0,firstName:!0,lastName:!0}},keyman:{select:{id:!0,firstName:!0,lastName:!0}}}},shifts:!0},orderBy:[{positionNumber:"asc"}]}}}),r=await e.attendants.findMany({where:{isActive:!0},select:{id:!0,firstName:!0,lastName:!0,formsOfService:!0,congregation:!0,isActive:!0},orderBy:[{firstName:"asc"},{lastName:"asc"}]});if(!a)return{notFound:!0};let i={id:a.id,name:a.name,eventType:a.eventType,startDate:a.startDate?.toISOString()||null,endDate:a.endDate?.toISOString()||null,status:a.status},n=a.positions.map(e=>({id:e.id,positionNumber:e.positionNumber,name:e.name,description:e.description,area:e.area||null,sequence:e.sequence||e.positionNumber,isActive:e.isActive,assignments:e.assignments.map(e=>({id:e.id,role:e.role||"ATTENDANT",attendant:e.attendant?{id:e.attendant.id,firstName:e.attendant.firstName,lastName:e.attendant.lastName}:null,overseer:e.overseer?{id:e.overseer.id,firstName:e.overseer.firstName,lastName:e.overseer.lastName}:null,keyman:e.keyman?{id:e.keyman.id,firstName:e.keyman.firstName,lastName:e.keyman.lastName}:null})).filter(e=>null!==e.attendant),shifts:e.shifts||[]}));return{props:{eventId:s,event:i,positions:n,attendants:r,stats:{total:n.length,active:n.filter(e=>e.isActive).length,assigned:n.filter(e=>e.assignments.length>0).length}}}}catch(e){return console.error("Error fetching positions data:",e),{notFound:!0}}},w=(0,n.l)(a,"default"),S=(0,n.l)(a,"getStaticProps"),k=(0,n.l)(a,"getStaticPaths"),A=(0,n.l)(a,"getServerSideProps"),C=(0,n.l)(a,"config"),D=(0,n.l)(a,"reportWebVitals"),P=(0,n.l)(a,"unstable_getStaticProps"),T=(0,n.l)(a,"unstable_getStaticPaths"),E=(0,n.l)(a,"unstable_getStaticParams"),$=(0,n.l)(a,"unstable_getServerProps"),O=(0,n.l)(a,"unstable_getServerSideProps"),I=new r.PagesRouteModule({definition:{kind:i.x.PAGES,page:"/events/[id]/positions",pathname:"/events/[id]/positions",bundlePath:"",filename:""},components:{App:d.default,Document:o()},userland:a})},6814:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>i});var a=t(997),r=t(1649);function i({Component:e,pageProps:{session:s,...t}}){return a.jsx(r.SessionProvider,{session:s,children:a.jsx(e,{...t})})}t(6764)},5175:(e,s,t)=>{"use strict";t.d(s,{L:()=>c});var a=t(3227),r=t.n(a);let i=require("next-auth/providers/credentials");var n=t.n(i),l=t(8925);let o=require("bcryptjs");var d=t.n(o);let c={providers:[n()({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let s=await l.prisma.users.findUnique({where:{email:e.email}});return s&&s.passwordHash&&await d().compare(e.password,s.passwordHash)?{id:s.id,email:s.email,name:`${s.firstName} ${s.lastName}`,role:s.role}:null}})],callbacks:{jwt:async({token:e,user:s})=>(s&&(e.role=s.role),e),session:async({session:e,token:s})=>(s&&(e.user.id=s.sub,e.user.role=s.role),e)},pages:{signIn:"/auth/signin"},session:{strategy:"jwt",maxAge:2592e3},cookies:{sessionToken:{name:"__Secure-next-auth.session-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0}}},secret:"staging-nextauth-secret-2024"};r()(c)},8925:(e,s,t)=>{"use strict";t.r(s),t.d(s,{prisma:()=>r});let a=require("@prisma/client"),r=globalThis.prisma??new a.PrismaClient},6764:()=>{},3227:e=>{"use strict";e.exports=require("next-auth")},1649:e=>{"use strict";e.exports=require("next-auth/react")},2785:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{"use strict";e.exports=require("next/head")},6689:e=>{"use strict";e.exports=require("react")},6405:e=>{"use strict";e.exports=require("react-dom")},997:e=>{"use strict";e.exports=require("react/jsx-runtime")},2048:e=>{"use strict";e.exports=require("fs")},5315:e=>{"use strict";e.exports=require("path")},6162:e=>{"use strict";e.exports=require("stream")},1568:e=>{"use strict";e.exports=require("zlib")}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[2899,8342,1664],()=>t(109));module.exports=a})();