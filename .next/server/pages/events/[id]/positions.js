(()=>{var e={};e.id=2801,e.ids=[2801,2888,660],e.modules={6578:(e,s,t)=>{"use strict";t.r(s),t.d(s,{config:()=>q,default:()=>y,getServerSideProps:()=>S,getStaticPaths:()=>P,getStaticProps:()=>w,reportWebVitals:()=>k,routeModule:()=>F,unstable_getServerProps:()=>E,unstable_getServerSideProps:()=>A,unstable_getStaticParams:()=>D,unstable_getStaticPaths:()=>$,unstable_getStaticProps:()=>C});var r={};t.r(r),t.d(r,{default:()=>v,getServerSideProps:()=>N});var i=t(7093),a=t(5244),n=t(1323),l=t(2899),o=t.n(l),d=t(6814),c=t(997),m=t(6689),u=t(1163),x=t(1649),p=t(968),h=t.n(p),g=t(1664),f=t.n(g),b=t(3227),j=t(6847);function v({eventId:e}){(0,u.useRouter)();let{data:s,status:t}=(0,x.useSession)(),[r,i]=(0,m.useState)(null),[a,n]=(0,m.useState)([]),[l,o]=(0,m.useState)(!0),[d,p]=(0,m.useState)(!1),[g,b]=(0,m.useState)(null),[j,v]=(0,m.useState)({positionName:"",department:"",description:"",requirements:""}),N=async()=>{try{let s=await fetch(`/api/event-positions/${e}`);if(s.ok){let e=await s.json();n(e.data||[])}}catch(e){console.error("Error fetching positions:",e),alert("Failed to load positions")}finally{o(!1)}},y=async s=>{if(s.preventDefault(),!j.positionName.trim()||!j.department){alert("Position name and department are required");return}try{let s=g?`/api/event-positions/${e}/${g.id}`:`/api/event-positions/${e}`,t=await fetch(s,{method:g?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(j)});if(t.ok)alert(g?"Position updated successfully":"Position created successfully"),p(!1),b(null),v({positionName:"",department:"",description:"",requirements:""}),N();else{let e=await t.json();alert(e.error||"Failed to save position")}}catch(e){console.error("Error saving position:",e),alert("Failed to save position")}},w=e=>{b(e),v({positionName:e.positionName,department:e.department,description:e.description||"",requirements:e.requirements||""}),p(!0)},P=async s=>{if(confirm("Are you sure you want to delete this position? This action cannot be undone."))try{let t=await fetch(`/api/event-positions/${e}/${s}`,{method:"DELETE"});if(t.ok)alert("Position deleted successfully"),N();else{let e=await t.json();alert(e.error||"Failed to delete position")}}catch(e){console.error("Error deleting position:",e),alert("Failed to delete position")}},S=()=>{p(!1),b(null),v({positionName:"",department:"",description:"",requirements:""})};return"loading"===t||l?c.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,c.jsxs)("div",{className:"text-center",children:[c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),c.jsx("p",{className:"mt-4 text-gray-600",children:"Loading positions..."})]})}):s?(0,c.jsxs)(c.Fragment,{children:[c.jsx(h(),{children:(0,c.jsxs)("title",{children:[r?.name?`${r.name} - Positions`:"Event Positions"," | JW Attendant Scheduler"]})}),(0,c.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,c.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,c.jsxs)("div",{className:"mb-8",children:[(0,c.jsxs)("nav",{className:"flex items-center space-x-2 text-sm text-gray-500 mb-4",children:[c.jsx(f(),{href:"/events",className:"hover:text-gray-700",children:"Events"}),c.jsx("span",{children:"›"}),c.jsx(f(),{href:`/events/${e}`,className:"hover:text-gray-700",children:r?.name||"Event"}),c.jsx("span",{children:"›"}),c.jsx("span",{className:"text-gray-900",children:"Positions"})]}),(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsxs)("div",{children:[c.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Event Positions"}),(0,c.jsxs)("p",{className:"text-gray-600 mt-2",children:["Manage positions and roles for ",r?.name]})]}),(0,c.jsxs)("div",{className:"flex space-x-3",children:[c.jsx(f(),{href:`/events/${e}`,className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium transition-colors",children:"← Back to Event"}),c.jsx("button",{onClick:()=>p(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"+ Create Position"})]})]})]}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[c.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:(0,c.jsxs)("div",{className:"flex items-center",children:[c.jsx("div",{className:"flex-shrink-0",children:c.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:c.jsx("span",{className:"text-blue-600 font-semibold",children:"\uD83D\uDCCB"})})}),(0,c.jsxs)("div",{className:"ml-4",children:[c.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Positions"}),c.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:a.length})]})]})}),c.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:(0,c.jsxs)("div",{className:"flex items-center",children:[c.jsx("div",{className:"flex-shrink-0",children:c.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center",children:c.jsx("span",{className:"text-green-600 font-semibold",children:"✓"})})}),(0,c.jsxs)("div",{className:"ml-4",children:[c.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Active Positions"}),c.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:a.filter(e=>e.isActive).length})]})]})}),c.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:(0,c.jsxs)("div",{className:"flex items-center",children:[c.jsx("div",{className:"flex-shrink-0",children:c.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:c.jsx("span",{className:"text-purple-600 font-semibold",children:"\uD83C\uDFE2"})})}),(0,c.jsxs)("div",{className:"ml-4",children:[c.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Departments"}),c.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:new Set(a.map(e=>e.department)).size})]})]})}),c.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:(0,c.jsxs)("div",{className:"flex items-center",children:[c.jsx("div",{className:"flex-shrink-0",children:c.jsx("div",{className:"w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center",children:c.jsx("span",{className:"text-orange-600 font-semibold",children:"\uD83D\uDC65"})})}),(0,c.jsxs)("div",{className:"ml-4",children:[c.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Assignments"}),c.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:a.reduce((e,s)=>e+(s._count?.assignments||0),0)})]})]})})]}),c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:0===a.length?(0,c.jsxs)("div",{className:"col-span-full bg-white rounded-lg shadow p-12 text-center",children:[c.jsx("span",{className:"text-6xl mb-4 block",children:"\uD83D\uDCCB"}),c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No positions created"}),c.jsx("p",{className:"text-gray-500 mb-4",children:"Create your first position to get started"}),c.jsx("button",{onClick:()=>p(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"Create Position"})]}):a.map(e=>c.jsx("div",{className:"bg-white rounded-lg shadow hover:shadow-md transition-shadow",children:(0,c.jsxs)("div",{className:"p-6",children:[(0,c.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,c.jsxs)("div",{children:[c.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:e.positionName}),c.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:e.department})]}),c.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:e.isActive?"Active":"Inactive"})]}),e.description&&c.jsx("p",{className:"text-sm text-gray-600 mb-3",children:e.description}),e.requirements&&(0,c.jsxs)("div",{className:"mb-4",children:[c.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"Requirements:"}),c.jsx("p",{className:"text-sm text-gray-600",children:e.requirements})]}),(0,c.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-500 mb-4",children:[(0,c.jsxs)("span",{children:["Position #",e.positionNumber]}),(0,c.jsxs)("span",{children:[e._count?.assignments||0," assignments"]})]}),(0,c.jsxs)("div",{className:"flex space-x-2",children:[c.jsx("button",{onClick:()=>w(e),className:"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded text-sm font-medium transition-colors",children:"Edit"}),c.jsx("button",{onClick:()=>P(e.id),className:"flex-1 bg-red-100 hover:bg-red-200 text-red-700 px-3 py-2 rounded text-sm font-medium transition-colors",children:"Delete"})]})]})},e.id))})]}),d&&c.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:c.jsx("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:(0,c.jsxs)("form",{onSubmit:y,children:[(0,c.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900",children:g?"Edit Position":"Create New Position"}),(0,c.jsxs)("button",{type:"button",onClick:S,className:"text-gray-400 hover:text-gray-600",children:[c.jsx("span",{className:"sr-only",children:"Close"}),c.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsxs)("div",{children:[c.jsx("label",{htmlFor:"positionName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Position Name *"}),c.jsx("input",{type:"text",id:"positionName",value:j.positionName,onChange:e=>v({...j,positionName:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Sound Operator, Parking Attendant",required:!0})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{htmlFor:"department",className:"block text-sm font-medium text-gray-700 mb-1",children:"Department *"}),(0,c.jsxs)("select",{id:"department",value:j.department,onChange:e=>v({...j,department:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[c.jsx("option",{value:"",children:"Select a department"}),["Audio/Video","Attendant","Cleaning","First Aid","Information","Literature","Parking","Platform","Security","Stage","Volunteer Services"].map(e=>c.jsx("option",{value:e,children:e},e))]})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),c.jsx("textarea",{id:"description",value:j.description,onChange:e=>v({...j,description:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Brief description of the position..."})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{htmlFor:"requirements",className:"block text-sm font-medium text-gray-700 mb-1",children:"Requirements"}),c.jsx("textarea",{id:"requirements",value:j.requirements,onChange:e=>v({...j,requirements:e.target.value}),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Any special requirements or qualifications..."})]})]}),(0,c.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[c.jsx("button",{type:"button",onClick:S,className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium transition-colors",children:"Cancel"}),c.jsx("button",{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:g?"Update Position":"Create Position"})]})]})})})]})]}):null}let N=async e=>{if(!await (0,b.getServerSession)(e.req,e.res,j.L))return{redirect:{destination:"/auth/signin",permanent:!1}};let{id:s}=e.params;return{props:{eventId:s}}},y=(0,n.l)(r,"default"),w=(0,n.l)(r,"getStaticProps"),P=(0,n.l)(r,"getStaticPaths"),S=(0,n.l)(r,"getServerSideProps"),q=(0,n.l)(r,"config"),k=(0,n.l)(r,"reportWebVitals"),C=(0,n.l)(r,"unstable_getStaticProps"),$=(0,n.l)(r,"unstable_getStaticPaths"),D=(0,n.l)(r,"unstable_getStaticParams"),E=(0,n.l)(r,"unstable_getServerProps"),A=(0,n.l)(r,"unstable_getServerSideProps"),F=new i.PagesRouteModule({definition:{kind:a.x.PAGES,page:"/events/[id]/positions",pathname:"/events/[id]/positions",bundlePath:"",filename:""},components:{App:d.default,Document:o()},userland:r})},6814:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>a});var r=t(997),i=t(1649);function a({Component:e,pageProps:{session:s,...t}}){return r.jsx(i.SessionProvider,{session:s,children:r.jsx(e,{...t})})}t(6764)},6847:(e,s,t)=>{"use strict";t.d(s,{L:()=>x});var r=t(3227),i=t.n(r),a=t(7449),n=t.n(a),l=t(7652),o=t(8432),d=t.n(o),c=t(2048),m=t.n(c);let u=e=>{let s=new Date().toISOString(),t=`[${s}] ${e}
`;try{m().appendFileSync("/tmp/nextauth-debug.log",t)}catch(e){}},x={providers:[n()({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){try{if(u(`Starting authorization for: ${e?.email}`),!e?.email||!e?.password)return u("Missing credentials"),null;u("Looking up user in database...");let s=await l.prisma.users.findUnique({where:{email:e.email}});if(!s)return u(`User not found: ${e.email}`),null;if(!s.passwordHash)return u("User has no password hash"),null;u("Comparing password...");let t=await d().compare(e.password,s.passwordHash);if(u(`Password valid: ${t}`),!t)return u(`Invalid password for: ${e.email}`),null;return u(`Authentication successful for: ${s.email}`),{id:s.id,email:s.email,name:`${s.firstName} ${s.lastName}`,image:s.image||null,role:s.role}}catch(e){return u(`Error during authorization: ${e}`),null}}})],session:{strategy:"jwt"},callbacks:{jwt:async({token:e,user:s})=>(s&&(e.role=s.role,e.image=s.image),e),session:async({session:e,token:s})=>(s&&(e.user.id=s.sub,e.user.role=s.role),e)},pages:{signIn:"/auth/signin"}};i()(x)},7652:(e,s,t)=>{"use strict";t.r(s),t.d(s,{prisma:()=>i});var r=t(3524);let i=globalThis.prisma??new r.PrismaClient},6764:()=>{},3524:e=>{"use strict";e.exports=require("@prisma/client")},8432:e=>{"use strict";e.exports=require("bcryptjs")},3227:e=>{"use strict";e.exports=require("next-auth")},7449:e=>{"use strict";e.exports=require("next-auth/providers/credentials")},1649:e=>{"use strict";e.exports=require("next-auth/react")},2785:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{"use strict";e.exports=require("next/head")},6689:e=>{"use strict";e.exports=require("react")},6405:e=>{"use strict";e.exports=require("react-dom")},997:e=>{"use strict";e.exports=require("react/jsx-runtime")},2048:e=>{"use strict";e.exports=require("fs")},5315:e=>{"use strict";e.exports=require("path")},6162:e=>{"use strict";e.exports=require("stream")},1568:e=>{"use strict";e.exports=require("zlib")}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[2899,8342,1664],()=>t(6578));module.exports=r})();