(()=>{var e={};e.id=2801,e.ids=[2801,2888,660],e.modules={4483:(e,t,s)=>{"use strict";s.r(t),s.d(t,{config:()=>S,default:()=>$,getServerSideProps:()=>A,getStaticPaths:()=>w,getStaticProps:()=>D,reportWebVitals:()=>k,routeModule:()=>O,unstable_getServerProps:()=>I,unstable_getServerSideProps:()=>P,unstable_getStaticParams:()=>E,unstable_getStaticPaths:()=>C,unstable_getStaticProps:()=>T});var a={};s.r(a),s.d(a,{default:()=>N,getServerSideProps:()=>j});var i=s(7093),n=s(5244),l=s(1323),r=s(2899),o=s.n(r),d=s(6814),c=s(997),m=s(6689),h=s(1163),u=s(1649),g=s(968),f=s.n(g),p=s(1664),x=s.n(p);function b({eventId:e,onClose:t,onSuccess:s}){let[a,i]=(0,m.useState)(!1),[n,l]=(0,m.useState)(""),[r,o]=(0,m.useState)(""),d=async t=>{if(t.preventDefault(),!n.trim()){alert("Please enter position names");return}try{i(!0);let t=n.split("\n").map(e=>e.trim()).filter(e=>e.length>0);if(0===t.length){alert("Please enter at least one position name");return}console.log(`ðŸš€ Processing ${t.length} positions for event ${e}`);let a=0,l=0,o=0,d=0,c=[];try{let t=await fetch(`/api/events/${e}/positions?includeInactive=true&limit=1000`);if(t.ok){let e=await t.json();c=e.data?.positions||[],console.log(`ðŸ“Š Found ${c.length} existing positions (active + inactive)`)}}catch(e){console.warn("Could not fetch existing positions, proceeding with creation only")}let m=e=>{let t=e.match(/(?:Station|Position)\s+(\d+)/i);return t?parseInt(t[1],10):null};for(let s=0;s<t.length;s++){let i=t[s],n=m(i);try{let t=c.find(e=>e.name.toLowerCase().trim()===i.toLowerCase().trim()),m=n?c.find(e=>e.positionNumber===n):null;if(t)t.isActive?(console.log(`âœ… Position already exists and active: ${i}`),d++):(console.log(`ðŸ”„ Reactivating existing position: ${i}`),(await fetch(`/api/events/${e}/positions/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:i,area:r||t.area,isActive:!0})})).ok?o++:l++);else if(m&&!m.isActive)console.log(`â™»ï¸ Reusing inactive position number ${n} for: ${i}`),(await fetch(`/api/events/${e}/positions/${m.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:i,area:r||void 0,isActive:!0})})).ok?o++:l++;else if(n&&!m)console.log(`ðŸ†• Creating new position ${n}: ${i}`),(await fetch(`/api/events/${e}/positions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({positionNumber:n,name:i,area:r||void 0,sequence:n})})).ok?a++:(l++,console.error(`Failed to create position: ${i}`));else{let t=c.reduce((e,t)=>Math.max(e,t.positionNumber||0),0)+1+s;console.log(`ðŸ“ Creating position with next available number ${t}: ${i}`),(await fetch(`/api/events/${e}/positions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({positionNumber:t,name:i,area:r||void 0,sequence:t})})).ok?a++:(l++,console.error(`Failed to create position: ${i}`))}}catch(e){l++,console.error(`Error processing position ${i}:`,e)}}let h=a+o+d;if(h>0){let e=[];a>0&&e.push(`${a} created`),o>0&&e.push(`${o} reactivated`),d>0&&e.push(`${d} already active`),l>0&&e.push(`${l} failed`);let t={created:h,failed:l,message:`Processed ${h} positions: ${e.join(", ")}`};console.log(`âœ… Successfully processed ${h} positions`),s(t)}else alert("Failed to process positions")}catch(e){console.error("Bulk create error:",e),alert("Failed to create positions")}finally{i(!1)}},h=`Position 1
Position 2
Position 3
Parking Lot Attendant
Information Desk
Sound Booth
Stage Attendant`;return c.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:c.jsx("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:(0,c.jsxs)("form",{onSubmit:d,children:[(0,c.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"\uD83D\uDE80 Bulk Create Positions"}),c.jsx("button",{type:"button",onClick:t,className:"text-gray-400 hover:text-gray-600",children:"âœ•"})]}),(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsxs)("div",{children:[c.jsx("label",{htmlFor:"defaultArea",className:"block text-sm font-medium text-gray-700 mb-1",children:"Default Area (Optional)"}),c.jsx("input",{type:"text",id:"defaultArea",value:r,onChange:e=>o(e.target.value),placeholder:"e.g., Main Auditorium, Parking, Lobby",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),c.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This area will be applied to all positions (can be edited individually later)"})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{htmlFor:"positionsText",className:"block text-sm font-medium text-gray-700 mb-1",children:"Position Names (One per line)"}),c.jsx("textarea",{id:"positionsText",value:n,onChange:e=>l(e.target.value),placeholder:h,rows:10,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),c.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter one position name per line. Empty lines will be ignored."})]}),(0,c.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[c.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-2",children:"\uD83D\uDCA1 Tips:"}),(0,c.jsxs)("ul",{className:"text-xs text-blue-700 space-y-1",children:[c.jsx("li",{children:"â€¢ Position names will be created exactly as entered"}),c.jsx("li",{children:"â€¢ Positions will be automatically numbered in sequence"}),c.jsx("li",{children:"â€¢ All positions will be created as Active by default"}),c.jsx("li",{children:"â€¢ You can edit individual positions after creation"})]})]})]}),(0,c.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[c.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors",children:"Cancel"}),c.jsx("button",{type:"submit",disabled:a||!n.trim(),className:"px-4 py-2 text-sm font-medium text-white bg-green-600 hover:bg-green-700 disabled:bg-gray-400 rounded-md transition-colors",children:a?"Creating...":`Create ${n.split("\n").filter(e=>e.trim()).length} Positions`})]})]})})})}let y=require("next-auth/next");var v=s(5175);function N({eventId:e,event:t,positions:s,attendants:a,stats:i}){let n=(0,h.useRouter)(),[l,r]=(0,m.useState)(!1),[o,d]=(0,m.useState)(""),[g,p]=(0,m.useState)(!1),[y,v]=(0,m.useState)(!1),[N,j]=(0,m.useState)(!1),[$,D]=(0,m.useState)(!1),[w,A]=(0,m.useState)(!1),[S,k]=(0,m.useState)(!1),[T,C]=(0,m.useState)(!1),[E,I]=(0,m.useState)(!1),[P,O]=(0,m.useState)(null),[F,L]=(0,m.useState)(null),[R,U]=(0,m.useState)(null),[B,M]=(0,m.useState)(null),[q,G]=(0,m.useState)(!1),[z,_]=(0,m.useState)(""),[K,J]=(0,m.useState)(new Set),[H,V]=(0,m.useState)(!1),[W,X]=(0,m.useState)({startTime:"",endTime:"",isAllDay:!1}),[Y,Q]=(0,m.useState)({overseerId:"",keymanId:"",responsibilities:""}),[Z,ee]=(0,m.useState)({positionNumber:1,name:"",area:"",description:""}),et=async t=>{if(t.preventDefault(),!Z.name.trim()){alert("Position name is required");return}try{let t=R?`/api/events/${e}/positions/${R.id}`:`/api/events/${e}/positions`,s=await fetch(t,{method:R?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Z)});if(s.ok)alert(R?"Position updated successfully":"Position created successfully"),p(!1),U(null),ee({positionNumber:1,name:"",area:"",description:""}),eb();else{let e=await s.json();alert(e.error||"Failed to save position")}}catch(e){console.error("Error saving position:",e),alert("Failed to save position")}},es=e=>{U(e),ee({positionNumber:e.positionNumber,name:e.name,area:e.area||"",description:e.description||""}),p(!0)},ea=async t=>{if(confirm("Are you sure you want to deactivate this position? It can be reactivated later."))try{G(!0);let s=await fetch(`/api/events/${e}/positions/${t}`,{method:"DELETE"});if(s.ok)eb();else{let e=await s.json();alert(`Failed to deactivate position: ${e.error}`)}}catch(e){alert("Failed to deactivate position")}finally{G(!1)}},ei=()=>{p(!1),U(null),ee({positionNumber:1,name:"",area:"",description:""})},en=async t=>{if(t.preventDefault(),P){if(W.isAllDay&&P.shifts&&P.shifts.length>0&&P.shifts.some(e=>!e.isAllDay)){alert("âŒ Cannot add All Day shift\n\nThis position already has partial shifts. An All Day shift covers the entire 24-hour period and conflicts with existing partial shifts.\n\nPlease delete existing partial shifts first, then add the All Day shift.");return}try{let t=await fetch(`/api/events/${e}/positions/${P.id}/shifts`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({startTime:W.startTime,endTime:W.endTime,isAllDay:W.isAllDay,positionId:P.id})});if(t.ok)alert("âœ… Shift added successfully"),j(!1),X({startTime:"",endTime:"",isAllDay:!1}),n.reload();else{let e=await t.json();alert(`Failed to add shift: ${e.error||"Unknown error"}`)}}catch(e){console.error("Error adding shift:",e),alert("Failed to add shift")}}},el=async t=>{if(t.preventDefault(),P)try{let t=await fetch(`/api/events/${e}/positions/${P.id}/overseer`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({overseerId:Y.overseerId,keymanId:Y.keymanId||null,responsibilities:Y.responsibilities,positionId:P.id})});if(t.ok)alert("Overseer assigned successfully"),D(!1),Q({overseerId:"",keymanId:"",responsibilities:""}),n.reload();else{let e=await t.json();alert(`Failed to assign overseer: ${e.error||"Unknown error"}`)}}catch(e){console.error("Error assigning overseer:",e),alert("Failed to assign overseer")}},er=async()=>{try{G(!0);let t=document.getElementById("bulk-area")?.value,s=document.getElementById("bulk-status")?.value;if(!t&&""===s){alert("Please specify at least one field to update");return}let a=0;for(let i of K){let n={};t&&(n.area=t),""!==s&&(n.isActive="true"===s),(await fetch(`/api/events/${e}/positions/${i}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).ok?a++:console.error(`Failed to update position ${i}`)}alert(`âœ… Successfully updated ${a} of ${K.size} positions`),eb()}catch(e){console.error("Bulk position update error:",e),alert("Failed to update positions")}finally{G(!1)}},eo=async()=>{try{G(!0);let t=document.getElementById("bulk-template")?.value;if(!t){alert("Please select a template");return}if("allday"===t){let e=s.filter(e=>K.has(e.id)).filter(e=>e.shifts&&e.shifts.some(e=>!e.isAllDay));if(e.length>0){let t=e.map(e=>e.name).join(", ");alert(`âŒ Cannot apply All Day template to some positions

The following positions have partial shifts that conflict with All Day shifts:
${t}

Please delete existing partial shifts from these positions first, then apply the All Day template.`);return}}let a=await fetch(`/api/events/${e}/positions/apply-shift-template`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({positionIds:Array.from(K),templateType:t})});if(a.ok){let e=await a.json();alert(`âœ… Template Applied Successfully!

â€¢ Positions: ${e.data.positionsProcessed}
â€¢ Shifts Created: ${e.data.totalShiftsCreated}
â€¢ Template: ${e.data.templateType}`),eb()}else{let e=await a.json();alert(`Failed to apply template: ${e.error||"Unknown error"}`)}}catch(e){console.error("Template application error:",e),alert("Failed to apply template")}finally{G(!1)}},ed=async()=>{try{G(!0);let t=document.getElementById("bulk-shift-name")?.value,a=document.getElementById("bulk-shift-start")?.value,i=document.getElementById("bulk-shift-end")?.value,n=document.getElementById("bulk-shift-allday")?.checked;if(!n&&(!a||!i)){alert('Please specify start and end times, or check "All Day"');return}if(!t){alert("Please specify a shift name");return}if(n){let e=s.filter(e=>K.has(e.id)).filter(e=>e.shifts&&e.shifts.some(e=>!e.isAllDay));if(e.length>0){let t=e.map(e=>e.name).join(", ");alert(`âŒ Cannot add All Day shift to some positions

The following positions have partial shifts that conflict with All Day shifts:
${t}

Please delete existing partial shifts from these positions first, then add the All Day shift.`);return}}let l=0;for(let s of K)(await fetch(`/api/events/${e}/positions/${s}/shifts`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,startTime:n?null:a,endTime:n?null:i,isAllDay:n})})).ok?l++:console.error(`Failed to create shift for position ${s}`);alert(`âœ… Successfully created "${t}" shift for ${l} of ${K.size} positions`),eb()}catch(e){console.error("Custom shift creation error:",e),alert("Failed to create shifts")}finally{G(!1)}},ec=async()=>{try{G(!0);let t=document.getElementById("bulk-overseer")?.value,s=document.getElementById("bulk-keyman")?.value;if(!t&&!s){alert("Please select at least one oversight role to assign");return}let a=await fetch(`/api/events/${e}/positions/bulk-oversight`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({positionIds:Array.from(K),overseerId:t||void 0,keymanId:s||void 0})});if(a.ok){let e=await a.json();alert(`âœ… Oversight Assigned Successfully!

â€¢ Positions: ${e.data.summary.positionsProcessed}
â€¢ No shift dependency required`),eb()}else{let e=await a.json();alert(`Failed to assign oversight: ${e.error||"Unknown error"}`)}}catch(e){console.error("Bulk oversight assignment error:",e),alert("Failed to assign oversight")}finally{G(!1)}},em=async(t,s,a)=>{if(confirm(`Delete "${a}" shift? This will also remove any attendant assignments to this shift.`))try{let i=await fetch(`/api/events/${e}/positions/${t}/shifts/${s}`,{method:"DELETE"});if(i.ok)alert(`âœ… "${a}" shift deleted successfully`),eb();else{let e=await i.json();alert(`Failed to delete shift: ${e.error||"Unknown error"}`)}}catch(e){console.error("Delete shift error:",e),alert("Failed to delete shift")}},eh=async()=>{if(confirm(`Delete ${K.size} selected positions? This action cannot be undone.`))try{G(!0);let t=0,s=0;for(let a of K)try{(await fetch(`/api/events/${e}/positions/${a}`,{method:"DELETE"})).ok?t++:(s++,console.error(`Failed to delete position ${a}`))}catch(e){s++,console.error(`Error deleting position ${a}:`,e)}t>0?(alert(`Successfully deleted ${t} position(s)${s>0?`. ${s} failed.`:""}`),J(new Set),eb()):alert("Failed to delete positions")}catch(e){console.error("Bulk delete error:",e),alert("Failed to delete positions")}finally{G(!1)}},eu=async t=>{if(confirm("Are you sure you want to remove this assignment?"))try{(await fetch(`/api/events/${e}/assignments/${t}`,{method:"DELETE"})).ok?n.reload():alert("Failed to remove assignment")}catch(e){console.error("Error removing assignment:",e),alert("Failed to remove assignment")}},eg=async()=>{if(console.log("\uD83D\uDEA8\uD83D\uDEA8\uD83D\uDEA8 OVERSIGHT-AWARE v4.0 - TIMESTAMP: "+Date.now()+" \uD83D\uDEA8\uD83D\uDEA8\uD83D\uDEA8"),console.log("\uD83C\uDFAF OVERSIGHT-AWARE AUTO-ASSIGN v4.0 RUNNING!"),console.log("\uD83D\uDD25 CACHE BUSTED - NEW VERSION LOADED!"),confirm("Auto-assign available attendants to unfilled positions?"))try{if(G(!0),console.log("\uD83C\uDFAF Starting Hierarchy-Based Auto-Assign - OVERSIGHT-AWARE VERSION!"),console.log("\uD83D\uDD0D CRITICAL DEBUG: Attendants array in auto-assign:"),console.log(`   ðŸ“Š Total attendants: ${a?.length||0}`),console.log(`   ðŸ“Š Attendants array:`,a),console.log("\uD83D\uDD27 CRITICAL FIX: Ensuring auto-assign uses same data as manual assignment"),console.log(`   ðŸ“Š Event-specific attendants: ${a?.length||0}`),a&&a.length>0){console.log("\uD83D\uDD0D First 3 attendants oversight check:"),a.slice(0,3).forEach((e,t)=>{console.log(`   ${t+1}. ${e.firstName} ${e.lastName}:`),console.log(`      - overseerId: ${e.overseerId}`),console.log(`      - keymanId: ${e.keymanId}`),console.log(`      - overseer: ${e.overseer?`${e.overseer.firstName} ${e.overseer.lastName}`:"null"}`),console.log(`      - keyman: ${e.keyman?`${e.keyman.firstName} ${e.keyman.lastName}`:"null"}`)});let e=a.filter(e=>e.overseerId);console.log(`âŒ CRITICAL ISSUE: Only ${e.length} out of ${a.length} attendants have overseerId!`),0===e.length&&(console.log("\uD83D\uDEA8 PROBLEM IDENTIFIED: Attendants array does not have event-specific oversight data!"),console.log("\uD83D\uDCA1 SOLUTION: Auto-assign needs to use event-specific attendant data with oversight assignments"))}else console.log("âŒ CRITICAL ERROR: No attendants array available!");let t=new Set,i=new Set;s.forEach(e=>{e.assignments?.forEach(e=>{e.attendant?.id&&t.add(e.attendant.id),e.overseer?.id&&i.add(e.overseer.id),e.keyman?.id&&i.add(e.keyman.id)})});let l=a.filter(e=>e.isActive&&!t.has(e.id)&&!i.has(e.id));console.log(`ðŸ” AUTO-ASSIGN DEBUG: Checking attendant oversight data...`),console.log(`ðŸ‘¥ Available attendants: ${l.length}`),l.slice(0,5).forEach(e=>{console.log(`   ðŸ‘¤ ${e.firstName} ${e.lastName}:`),console.log(`      - overseerId: ${e.overseerId}`),console.log(`      - keymanId: ${e.keymanId}`),console.log(`      - overseer: ${e.overseer?`${e.overseer.firstName} ${e.overseer.lastName}`:"null"}`),console.log(`      - keyman: ${e.keyman?`${e.keyman.firstName} ${e.keyman.lastName}`:"null"}`)});let r=new Map;for(let[e,t]of(l.forEach(e=>{let t=s.some(t=>t.oversight?.some(t=>t.overseer?.id===e.id)),a=s.some(t=>t.oversight?.some(t=>t.keyman?.id===e.id));if(t||a){console.log(`ðŸš« EXCLUDING ${e.firstName} ${e.lastName} - is ${t?"Overseer":"Keyman"}`);return}let i=e.overseerId||"none",n=e.keymanId||"none",l=`${i}-${n}`;r.has(l)||r.set(l,[]),r.get(l).push(e);let o=e.overseer?`${e.overseer.firstName} ${e.overseer.lastName}`:"None",d=e.keyman?`${e.keyman.firstName} ${e.keyman.lastName}`:"None";console.log(`ðŸ‘¤ ${e.firstName} ${e.lastName} â†’ Leadership: ${l} (Overseer: ${o}, Keyman: ${d})`)}),console.log(`ðŸ‘¥ Available attendants for assignment: ${l.length}`),console.log(`ðŸ“Š Attendant leadership groups: ${r.size}`),r))console.log(`ðŸ“Š Leadership group "${e}": ${t.length} attendants`),"none-none"===e&&console.log(`   âš ï¸  WARNING: ${t.length} attendants have no oversight assigned!`);let o=new Map;s.filter(e=>e.isActive).forEach(e=>{let t=e.oversight&&e.oversight.length>0?e.oversight[0]:null,s=t?.overseer?.id||"none",a=t?.keyman?.id||"none",i=`${s}-${a}`;o.has(i)||o.set(i,[]),o.get(i).push(e),console.log(`ðŸ“ Position ${e.positionNumber}: Leadership key = ${i}`)});let d=0,c=0,m=0;for(let[t,s]of(console.log(`ðŸ“Š Leadership Groups: ${r.size} attendant groups, ${o.size} position groups`),o)){let a=r.get(t)||[];if(a.length>0){for(let i of(console.log(`ðŸŽ¯ Matching leadership group: ${t} (${a.length} attendants â†’ ${s.length} positions)`),s)){if(0===a.length)break;let s=i.oversight?.[0],n=s?.overseer||s?.keyman?i.shifts:i.shifts?.filter(e=>!e.isAllDay)||[];if(!n||0===n.length){console.log(`âš ï¸ Skipping ${i.name} - no shifts available`);continue}let l=[];for(let e of n){let t=i.assignments?.filter(t=>t.shift?.id===e.id).length||0;0===t&&l.push({position:i,shift:e})}for(let{position:s,shift:n}of(console.log(`ðŸ” POSITION DEBUG: ${i.name} has ${l.length} shifts needing assignment`),l)){if(0===a.length){console.log(`âš ï¸ No more attendants in ${t} group for ${s.name} - ${n.name}`);break}let i=a.shift();if(!i)continue;console.log(`ðŸ” OVERSIGHT DEBUG for ${s.name} - ${n.name}:`);let l=s.oversight?.[0];console.log(`   ðŸ“ Position Overseer: ${l?.overseer?.firstName} ${l?.overseer?.lastName}`),console.log(`   ðŸ“ Position Keyman: ${l?.keyman?.firstName} ${l?.keyman?.lastName}`),console.log(`   ðŸ‘¤ Attendant Overseer: ${i.overseer?.firstName} ${i.overseer?.lastName}`),console.log(`   ðŸ‘¤ Attendant Keyman: ${i.keyman?.firstName} ${i.keyman?.lastName}`),console.log(`   ðŸ”‘ Leadership Key: ${t}`),console.log(`   ðŸŽ¯ Using shift: ${n.name} (${n.startTime} - ${n.endTime})`);let r=await fetch(`/api/events/${e}/assignments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({positionId:s.id,attendantId:i.id,shiftId:n.id,role:"ATTENDANT"})});if(r.ok){d++,c++;let e=s.oversight?.[0],t=e?.overseer?`${e.overseer.firstName} ${e.overseer.lastName}`:"None",l=e?.keyman?`${e.keyman.firstName} ${e.keyman.lastName}`:"None",r=i.overseer?`${i.overseer.firstName} ${i.overseer.lastName}`:"None",o=i.keyman?`${i.keyman.firstName} ${i.keyman.lastName}`:"None";console.log(`âœ… Perfect match: ${i.firstName} ${i.lastName} â†’ ${s.name} - ${n.name}`),console.log(`   ðŸ‘¤ Attendant under: Overseer: ${r}, Keyman: ${o}`),console.log(`   ðŸ“ Position under: Overseer: ${t}, Keyman: ${l}`),a.push(i)}else console.log(`âŒ Assignment failed: ${i.firstName} ${i.lastName} â†’ ${s.name} - ${n.name} (${r.status})`),a.unshift(i)}}r.set(t,a)}}let h=[];for(let e of r.values()){let s=e.filter(e=>!t.has(e.id));h.push(...s)}let u=[];for(let e of o.values())u.push(...e.filter(e=>0===(e.assignments?.length||0)));for(let t of(console.log(`ðŸ”„ Fallback phase: ${h.length} attendants â†’ ${u.length} positions`),u)){if(0===h.length)break;let s=t.oversight?.[0],a=s?.overseer||s?.keyman?t.shifts:t.shifts?.filter(e=>!e.isAllDay)||[];if(!a||0===a.length){console.log(`âš ï¸ Skipping fallback for ${t.name} - no shifts available`);continue}let i=[];for(let e of a){let s=t.assignments?.filter(t=>t.shift?.id===e.id).length||0;0===s&&i.push({position:t,shift:e})}for(let{position:s,shift:a}of(console.log(`ðŸ” FALLBACK DEBUG: ${t.name} has ${i.length} shifts needing assignment`),i)){if(0===h.length){console.log(`âš ï¸ No more attendants available for ${s.name} - ${a.name}`);break}let t=h.shift();if(!t)continue;let i=await fetch(`/api/events/${e}/assignments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({positionId:s.id,attendantId:t.id,shiftId:a.id,role:"ATTENDANT"})});i.ok?(d++,m++,console.log(`âš¡ Fallback assignment: ${t.firstName} ${t.lastName} â†’ ${s.name} - ${a.name}`),h.push(t)):(console.log(`âŒ Fallback failed: ${t.firstName} ${t.lastName} â†’ ${s.name} - ${a.name} (${i.status})`),h.unshift(t))}}console.log("\uD83D\uDCC5 Phase 3: Filling ALL remaining shifts with balanced round-robin assignment...");let g=0,f=new Map,p=[];console.log(`ðŸ” DEBUGGING: Processing ${a.length} total attendants for Phase 3`),a.forEach(e=>{let t=s.some(t=>t.oversight?.some(t=>t.overseer?.id===e.id)),a=s.some(t=>t.oversight?.some(t=>t.keyman?.id===e.id));if(t||a){p.push(`${e.firstName} ${e.lastName} (${t?"Overseer":"Keyman"})`),console.log(`ðŸš« EXCLUDING: ${e.firstName} ${e.lastName} - is ${t?"Overseer":"Keyman"}`);return}let i=e.overseer?.id||"none",n=e.keyman?.id||"none",l=`${i}-${n}`;console.log(`âœ… INCLUDING: ${e.firstName} ${e.lastName} - oversight: ${l}`),f.has(l)||f.set(l,[]),f.get(l).push(e)}),console.log(`ðŸš« TOTAL EXCLUDED: ${p.length} attendants:`,p),console.log(`ðŸ“… Attendant pools by oversight:`),f.forEach((e,t)=>{console.log(`   ${t}: ${e.length} attendants`),(t.includes("Darrell")||e.some(e=>e.overseer?.firstName==="Darrell"))&&(console.log(`   ðŸ” DARRELL MCCOY ATTENDANTS:`),e.forEach((e,t)=>{console.log(`      ${t+1}. ${e.firstName} ${e.lastName} (overseer: ${e.overseer?.firstName||"none"})`)}))});let x=new Map;for(let[t,a]of(s.forEach(e=>{if(!e.shifts||0===e.shifts.length)return;let t=e.oversight?.[0],s=t?.overseer||t?.keyman?e.shifts:e.shifts.filter(e=>!e.isAllDay),a=t?.overseer?.id||"none",i=t?.keyman?.id||"none",n=`${a}-${i}`;s.forEach(t=>{let s=e.assignments?.filter(e=>e.shift?.id===t.id).length||0;0===s&&(x.has(n)||x.set(n,[]),x.get(n).push({position:e,shift:t,positionName:e.name,shiftName:t.name}))})}),console.log(`ðŸ“… Unfilled shifts by oversight:`),x.forEach((e,t)=>{console.log(`   ${t}: ${e.length} unfilled shifts`)}),x.entries())){let s=f.get(t)||[];if(0===s.length){console.log(`âš ï¸ No attendants available for oversight group: ${t}`);continue}console.log(`ðŸ”„ Round-robin assignment for ${t}: ${a.length} shifts, ${s.length} attendants`),console.log(`ðŸ”„ Starting enhanced round-robin for ${t}...`);let i=new Map;s.forEach(e=>i.set(e.id,[]));let n=[...a].sort((e,t)=>{let s=e.shift.startTime||"00:00",a=t.shift.startTime||"00:00";return s.localeCompare(a)}),l=0,r=2*n.length,o=0;for(let t of n){let a=!1,n=0;for(;!a&&n<s.length&&o<r;){let r=s[l%s.length],d=i.get(r.id)||[];d.some(e=>{let s=e.endTime||"23:59",a=t.shift.startTime||"00:00",i=e.startTime||"00:00",n=t.shift.endTime||"23:59";return s>=a&&i<=n||18e5>Math.abs(new Date(`1970-01-01T${s}`)-new Date(`1970-01-01T${a}`))})?console.log(`â° Conflict avoided: ${r.firstName} ${r.lastName} already has conflicting shift`):(await fetch(`/api/events/${e}/assignments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({positionId:t.position.id,attendantId:r.id,shiftId:t.shift.id,role:"ATTENDANT"})})).ok?(g++,d.push(t.shift),i.set(r.id,d),a=!0,console.log(`ðŸŽ¯ Enhanced round-robin: ${r.firstName} ${r.lastName} â†’ ${t.positionName} (${t.shiftName}) [${d.length} total]`)):console.log(`âŒ API failed for ${r.firstName} ${r.lastName} to ${t.positionName}`),l++,n++,o++}a||console.log(`âš ï¸ Could not assign anyone to ${t.positionName} (${t.shiftName}) - all attendants have conflicts`)}console.log(`ðŸ“Š Final assignment distribution for ${t}:`),i.forEach((e,t)=>{let a=s.find(e=>e.id===t);e.length>0&&console.log(`   ${a?.firstName} ${a?.lastName}: ${e.length} shifts`)})}let b=d+g,y=Array.from(o.keys()).filter(e=>"none-none"!==e).reduce((e,t)=>e+(o.get(t)?.length||0),0),v=o.get("none-none")?.length||0,N=[];for(let[e,t]of r){(r.get(e)||[]).length;let s=(o.get(e)||[]).reduce((e,t)=>{let s=t.shifts?.filter(e=>!e.isAllDay)||[];return e+s.length},0);s>0&&t.length>0&&(console.log(`ðŸ“Š UTILIZATION: ${e} - ${t.length} attendants remaining, ${s} shifts needed`),t.length>.5*s&&N.push(`âš ï¸ ${e}: ${t.length} unused attendants (${s} shifts needed)`))}let j=0;for(let e of o.values())for(let t of e)for(let e of t.shifts?.filter(e=>!e.isAllDay)||[]){let s=t.assignments?.filter(t=>t.shift?.id===e.id).length||0;0===s&&j++}j>0&&N.push(`ðŸš¨ ${j} shifts remain unfilled - insufficient attendants!`);let $=`ðŸŽ¯ Oversight-Aware Auto-Assign Complete!

âœ… Total Assignments: ${d}
ðŸŽ¯ Perfect Matches: ${c} (attendant â†” position oversight match)
âš¡ Fallback Assignments: ${m}
ðŸ‘¥ Positions with Oversight: ${y} (prioritized)
ðŸ“‹ Positions without Oversight: ${v}
ðŸ“… Shift Coverage: ${g}
ðŸŽ‰ Total Final Assignments: ${b}

`;N.length>0&&($+=`âš ï¸ WARNINGS:
${N.join("\n")}

`),$+="System assigns 1 attendant per shift using round-robin within oversight groups.",alert($),n.reload()}catch(e){console.error("Auto-assign error:",e),alert("Failed to auto-assign attendants")}finally{G(!1)}},ef=()=>{let e=new Set,t=new Set;return s.forEach(s=>{s.assignments?.forEach(s=>{s.attendant?.id&&e.add(s.attendant.id),s.overseer?.id&&t.add(s.overseer.id),s.keyman?.id&&t.add(s.keyman.id)})}),a.filter(s=>s.isActive&&!e.has(s.id)&&!t.has(s.id)).length},{data:ep}=(0,u.useSession)(),ex=ep?.user?.role==="ADMIN",eb=()=>{let e=new URL(window.location.href);H?e.searchParams.set("showInactive","true"):e.searchParams.delete("showInactive"),window.location.href=e.toString()};return l?c.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,c.jsxs)("div",{className:"text-center",children:[c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),c.jsx("p",{className:"mt-4 text-gray-600",children:"Loading positions..."})]})}):ep?(0,c.jsxs)(c.Fragment,{children:[c.jsx(f(),{children:(0,c.jsxs)("title",{children:[t?.name?`${t.name} - Positions`:"Event Positions"," | JW Attendant Scheduler"]})}),(0,c.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,c.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,c.jsxs)("div",{className:"mb-8",children:[(0,c.jsxs)("nav",{className:"flex items-center space-x-2 text-sm text-gray-500 mb-4",children:[c.jsx(x(),{href:"/events",className:"hover:text-gray-700",children:"Events"}),c.jsx("span",{children:"â€º"}),c.jsx(x(),{href:`/events/${e}`,className:"hover:text-gray-700",children:t?.name||"Event"}),c.jsx("span",{children:"â€º"}),c.jsx("span",{className:"text-gray-900",children:"Positions"})]}),(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsxs)("div",{children:[c.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Event Positions"}),(0,c.jsxs)("p",{className:"text-gray-600 mt-2",children:["Manage positions and roles for ",t?.name]})]}),(0,c.jsxs)("div",{className:"flex space-x-3",children:[c.jsx(x(),{href:`/events/${e}`,className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium transition-colors",children:"â† Back to Event"}),K.size>0&&(0,c.jsxs)("div",{className:"flex items-center space-x-2 bg-blue-50 border border-blue-200 rounded-lg px-3 py-2",children:[(0,c.jsxs)("span",{className:"text-sm text-blue-700 font-medium",children:[K.size," selected"]}),c.jsx("button",{onClick:()=>I(!0),disabled:0===K.size,className:"text-xs bg-green-100 hover:bg-green-200 text-green-700 px-2 py-1 rounded",title:"Apply shift template to selected positions",children:"\uD83D\uDCC5 Apply Template"}),c.jsx("button",{onClick:eh,disabled:0===K.size,className:"text-xs bg-red-100 hover:bg-red-200 text-red-700 px-2 py-1 rounded",children:"Delete"}),c.jsx("button",{onClick:()=>C(!0),className:"text-xs bg-blue-100 hover:bg-blue-200 text-blue-700 px-2 py-1 rounded",children:"Edit"}),c.jsx("button",{onClick:()=>J(new Set),className:"text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 px-2 py-1 rounded",children:"Clear"})]}),c.jsx("button",{onClick:eg,disabled:q||0===ef(),className:`relative px-6 py-3 rounded-lg font-bold text-white transition-all duration-300 transform hover:scale-105 shadow-lg ${q?"bg-blue-500 cursor-not-allowed":0===ef()?"bg-green-500 hover:bg-green-600":"bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 animate-pulse"}`,title:`Auto-assign ${ef()} available attendants with oversight awareness`,children:c.jsx("div",{className:"flex items-center space-x-2",children:q?(0,c.jsxs)(c.Fragment,{children:[c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),c.jsx("span",{children:"Assigning..."})]}):0===ef()?(0,c.jsxs)(c.Fragment,{children:[c.jsx("span",{children:"\uD83C\uDF89"}),c.jsx("span",{children:"ALL ASSIGNED!"})]}):(0,c.jsxs)(c.Fragment,{children:[c.jsx("span",{children:"\uD83D\uDEA8"}),c.jsx("span",{children:"SMART AUTO-ASSIGN v5.0"}),c.jsx("span",{className:"bg-white bg-opacity-20 px-2 py-1 rounded-full text-sm",children:ef()})]})})}),(0,c.jsxs)("button",{onClick:()=>{let t=!H;V(t),localStorage.setItem(`showInactive-event-${e}`,t.toString());let s=new URL(window.location.href);t?s.searchParams.set("showInactive","true"):s.searchParams.delete("showInactive"),window.history.replaceState({},"",s.toString())},className:`px-4 py-2 rounded-lg font-medium transition-colors ${H?"bg-purple-600 hover:bg-purple-700 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,title:H?"Hide inactive positions":"Show inactive positions",children:["\uD83D\uDC41ï¸ ",H?"Hide Inactive":"Show Inactive"]}),c.jsx("button",{onClick:()=>A(!0),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"\uD83D\uDE80 Bulk Create"}),c.jsx("button",{onClick:()=>p(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"+ Create Position"})]})]})]}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[c.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow",children:(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsxs)("div",{children:[c.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Positions"}),c.jsx("p",{className:"text-3xl font-bold text-gray-900",children:s.filter(e=>e.isActive).length})]}),c.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:c.jsx("span",{className:"text-2xl",children:"\uD83D\uDCCB"})})]})}),(()=>{let e=s.filter(e=>e.isActive).reduce((e,t)=>e+(t.shifts?.length||0),0),t=s.filter(e=>e.isActive).reduce((e,t)=>e+(t.shifts?.filter(e=>(t.assignments?.filter(t=>t.shift?.id===e.id&&"ATTENDANT"===t.role).length||0)>0).length||0),0),a=e>0?Math.round(t/e*100):0;return(0,c.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,c.jsxs)("div",{children:[c.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Shift Coverage"}),(0,c.jsxs)("p",{className:"text-3xl font-bold text-gray-900",children:[t,"/",e]})]}),c.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:c.jsx("span",{className:"text-2xl",children:"âœ…"})})]}),c.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 mb-2",children:c.jsx("div",{className:`h-3 rounded-full transition-all duration-500 ${100===a?"bg-green-500":a>=80?"bg-blue-500":a>=50?"bg-yellow-500":"bg-red-500"}`,style:{width:`${a}%`}})}),(0,c.jsxs)("p",{className:"text-sm text-gray-600",children:[a,"% Complete"]})]})})(),c.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow",children:(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsxs)("div",{children:[c.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Available Attendants"}),c.jsx("p",{className:"text-3xl font-bold text-gray-900",children:ef()})]}),c.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center",children:c.jsx("span",{className:"text-2xl",children:"\uD83D\uDC65"})})]})}),c.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow",children:(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsxs)("div",{children:[c.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Assignments"}),c.jsx("p",{className:"text-3xl font-bold text-gray-900",children:s.filter(e=>e.isActive).reduce((e,t)=>e+(t.assignments?.filter(e=>"ATTENDANT"===e.role).length||0),0)})]}),c.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center",children:c.jsx("span",{className:"text-2xl",children:"\uD83C\uDFAF"})})]})})]}),c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:0===s.filter(e=>e.isActive).length?(0,c.jsxs)("div",{className:"col-span-full bg-white rounded-lg shadow p-12 text-center",children:[c.jsx("span",{className:"text-6xl mb-4 block",children:"\uD83D\uDCCB"}),c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No positions created"}),c.jsx("p",{className:"text-gray-500 mb-4",children:"Create your first position to get started"}),(0,c.jsxs)("div",{className:"flex justify-center space-x-4",children:[c.jsx("button",{onClick:()=>A(!0),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"\uD83D\uDE80 Bulk Create"}),c.jsx("button",{onClick:()=>p(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"Create Position"})]})]}):s.filter(e=>!!H||e.isActive).map(t=>c.jsx("div",{className:`rounded-lg shadow hover:shadow-md transition-shadow ${t.isActive?"bg-white":"bg-gray-50 border-2 border-dashed border-gray-300"}`,children:(0,c.jsxs)("div",{className:"p-6",children:[(0,c.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,c.jsxs)("div",{className:"flex items-start space-x-3",children:[c.jsx("input",{type:"checkbox",checked:K.has(t.id),onChange:e=>{let s=new Set(K);e.target.checked?s.add(t.id):s.delete(t.id),J(s)},className:"mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,c.jsxs)("div",{children:[(0,c.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[c.jsx("h3",{className:`text-lg font-semibold mb-0 ${t.isActive?"text-gray-900":"text-gray-500"}`,children:t.name}),!t.isActive&&c.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:"Inactive"})]}),t.area&&c.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:t.area})]})]}),c.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t.isActive?"Active":"Inactive"})]}),t.description&&c.jsx("p",{className:"text-sm text-gray-600 mb-3",children:t.description}),(0,c.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-500 mb-4",children:[(0,c.jsxs)("span",{children:["Position #",t.positionNumber]}),(0,c.jsxs)("span",{children:[t.shifts?.length||0," shifts â€¢ ",t.assignments?.filter(e=>"ATTENDANT"===e.role).length||0," attendants"]})]}),t.shifts&&t.shifts.length>0?(0,c.jsxs)("div",{className:"mb-4",children:[c.jsx("p",{className:"text-xs font-medium text-gray-500 mb-2",children:"\uD83D\uDD50 Shift Assignments"}),c.jsx("div",{className:"space-y-2",children:t.shifts.map(e=>{t.name.includes("Station 2")&&console.log("\uD83D\uDD0D Station 2 Debug:",{positionName:t.name,shiftId:e.id,shiftName:e.name,totalAssignments:t.assignments?.length||0,assignments:t.assignments?.map(e=>({role:e.role,attendant:e.attendant?`${e.attendant.firstName} ${e.attendant.lastName}`:"null",shiftId:e.shift?.id||"null",hasShift:!!e.shift}))});let s=t.assignments?.filter(t=>t.shift?.id===e.id)||[];t.assignments?.filter(e=>"OVERSEER"===e.role||"KEYMAN"===e.role);let a=s.filter(e=>"ATTENDANT"===e.role),i=s.filter(e=>"OVERSEER"===e.role||"KEYMAN"===e.role);return(0,c.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-2",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,c.jsxs)("div",{className:"flex items-center space-x-2",children:[c.jsx("span",{className:"text-xs font-medium text-gray-700",children:e.name}),!e.isAllDay&&(0,c.jsxs)("span",{className:"text-xs text-gray-500",children:[e.startTime," - ",e.endTime]}),e.isAllDay&&c.jsx("span",{className:"text-xs text-blue-600 bg-blue-100 px-1 rounded",children:"All Day"})]}),(0,c.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,c.jsxs)("span",{className:"text-xs text-gray-400",children:[a.length," attendant",1!==a.length?"s":""]}),c.jsx("button",{onClick:()=>em(t.id,e.id,e.name),className:"text-xs text-red-600 hover:text-red-800 hover:bg-red-100 rounded px-1 py-0.5 transition-colors",title:`Delete ${e.name} shift`,children:"âœ•"})]})]}),i.length>0&&(0,c.jsxs)("div",{className:"mb-2",children:[c.jsx("p",{className:"text-xs font-medium text-gray-600 mb-1",children:"Oversight:"}),c.jsx("div",{className:"space-y-1",children:i.map(e=>{let t="OVERSEER"===e.role?"text-blue-700":"text-purple-700",s="OVERSEER"===e.role?"bg-blue-50 border-blue-100":"bg-purple-50 border-purple-100";return(0,c.jsxs)("div",{className:`flex items-center justify-between ${s} border rounded px-2 py-1`,children:[(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsxs)("span",{className:`text-xs font-medium ${t}`,children:[e.attendant?.firstName," ",e.attendant?.lastName]}),(0,c.jsxs)("span",{className:"ml-2 text-xs text-gray-500",children:["(",e.role,")"]})]}),c.jsx("button",{onClick:()=>eu(e.id),className:"text-xs text-red-600 hover:text-red-800 px-1",title:"Remove assignment",children:"âœ•"})]},e.id)})})]}),a.length>0?c.jsx("div",{className:"space-y-1",children:a.map(e=>(0,c.jsxs)("div",{className:"flex items-center justify-between bg-green-50 border-green-100 border rounded px-2 py-1",children:[(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsxs)("span",{className:"text-xs font-medium text-green-700",children:[e.attendant?.firstName," ",e.attendant?.lastName]}),(0,c.jsxs)("span",{className:"ml-2 text-xs text-gray-500",children:["(",e.role||"Attendant",")"]})]}),c.jsx("button",{onClick:()=>eu(e.id),className:"text-xs text-red-600 hover:text-red-800 px-1",title:"Remove assignment",children:"âœ•"})]},e.id))}):c.jsx("button",{onClick:()=>{O(t),L(e),k(!0)},className:"w-full text-xs text-blue-600 hover:text-blue-800 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded px-2 py-1 transition-colors",children:"+ Assign Attendant"})]},e.id)})}),t.shifts?.some(e=>e.isAllDay)?c.jsx("div",{className:"mt-2 p-2 bg-blue-50 border border-blue-200 rounded text-xs text-blue-700",children:"â„¹ï¸ Cannot add more shifts - this position has an All Day shift that covers the entire 24-hour period"}):c.jsx("button",{onClick:()=>{O(t),j(!0)},className:"w-full mt-2 text-xs text-green-600 hover:text-green-800 bg-green-50 hover:bg-green-100 border border-green-200 rounded px-2 py-1 transition-colors",children:"+ Add Shift"})]}):(0,c.jsxs)("div",{className:"mb-4",children:[c.jsx("p",{className:"text-xs font-medium text-gray-500 mb-2",children:"\uD83D\uDD50 No Shifts Created"}),c.jsx("button",{onClick:()=>{O(t),j(!0)},className:"w-full text-xs text-blue-600 hover:text-blue-800 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded px-2 py-1 transition-colors",children:"+ Create First Shift"})]}),(!t.shifts||0===t.shifts.length)&&t.assignments&&t.assignments.length>0&&(0,c.jsxs)("div",{className:"mb-4",children:[c.jsx("p",{className:"text-xs font-medium text-gray-500 mb-2",children:"\uD83D\uDC64 Legacy Assignments"}),(0,c.jsxs)("div",{className:"space-y-1",children:[t.assignments.filter(e=>!e.shift).map(e=>(0,c.jsxs)("div",{className:"flex items-center justify-between bg-yellow-50 border border-yellow-200 rounded px-2 py-1",children:[(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsxs)("span",{className:"text-xs font-medium text-yellow-700",children:[e.attendant?.firstName," ",e.attendant?.lastName]}),c.jsx("span",{className:"ml-2 text-xs text-yellow-600",children:"(Needs Shift Assignment)"})]}),c.jsx("button",{onClick:()=>eu(e.id),className:"text-xs text-red-600 hover:text-red-800 px-1",title:"Remove assignment",children:"âœ•"})]},e.id)),c.jsx("button",{onClick:()=>{O(t),k(!0)},className:"w-full text-xs bg-blue-50 hover:bg-blue-100 text-blue-700 border border-blue-200 rounded px-2 py-1 transition-colors",children:"+ Assign Attendant"})]})]}),(0,c.jsxs)("div",{className:"flex flex-wrap gap-2 mb-4",children:[c.jsx("button",{onClick:()=>{O(t),D(!0)},className:"text-xs bg-green-100 hover:bg-green-200 text-green-800 px-2 py-1 rounded transition-colors",children:"\uD83D\uDC65 Assign Oversight"}),c.jsx("button",{onClick:()=>es(t),className:"text-xs bg-gray-100 hover:bg-gray-200 text-gray-800 px-2 py-1 rounded transition-colors",children:"âœï¸ Edit"}),c.jsx("button",{onClick:()=>ea(t.id),className:"text-xs bg-red-100 hover:bg-red-200 text-red-700 px-2 py-1 rounded transition-colors",children:"\uD83D\uDDD1ï¸ Delete"})]}),(console.log(`ðŸ” Position ${t.positionNumber} oversight data:`,t.oversight),console.log(`ðŸ” Position ${t.positionNumber} has oversight:`,t.oversight&&t.oversight.length>0),null),t.oversight&&t.oversight.length>0&&(0,c.jsxs)("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-md",children:[c.jsx("h4",{className:"text-sm font-medium text-green-800 mb-2",children:"\uD83D\uDC65 Position Oversight"}),t.oversight.map(e=>(0,c.jsxs)("div",{className:"space-y-1",children:[e.overseer&&(0,c.jsxs)("div",{className:"text-xs text-green-700",children:[c.jsx("span",{className:"font-medium",children:"Overseer:"})," ",e.overseer.firstName," ",e.overseer.lastName]}),e.keyman&&(0,c.jsxs)("div",{className:"text-xs text-green-700",children:[c.jsx("span",{className:"font-medium",children:"Keyman:"})," ",e.keyman.firstName," ",e.keyman.lastName]})]},e.id))]}),!t.isActive&&(0,c.jsxs)("div",{className:"flex space-x-2 mt-4 pt-4 border-t border-gray-200",children:[c.jsx("button",{onClick:async()=>{try{(await fetch(`/api/events/${e}/positions/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({isActive:!0})})).ok?eb():alert("Failed to activate position")}catch(e){alert("Failed to activate position")}},className:"flex-1 bg-green-100 hover:bg-green-200 text-green-700 px-3 py-2 rounded text-sm font-medium transition-colors",children:"âœ… Activate"}),ex&&c.jsx("button",{onClick:async()=>{if(confirm(`âš ï¸ PERMANENT DELETION âš ï¸

This will permanently delete "${t.name}" from the database.
This action CANNOT be undone.

Are you absolutely sure?`))try{let s=await fetch(`/api/events/${e}/positions/${t.id}?hardDelete=true`,{method:"DELETE"}),a=await s.json();s.ok?(alert(`Position "${t.name}" permanently deleted.`),eb()):a.dependencies?alert(`Cannot delete - has dependencies:
â€¢ ${a.dependencies.assignments} assignments
â€¢ ${a.dependencies.shifts} shifts

Remove dependencies first.`):alert(`Failed: ${a.error}`)}catch(e){alert("Failed to permanently delete position")}},className:"flex-1 bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded text-sm font-medium transition-colors",title:"Permanently delete position (Admin only)",children:"\uD83D\uDDD1ï¸ Delete Forever"})]})]})},t.id))})]}),w&&c.jsx(b,{eventId:e,onClose:()=>A(!1),onSuccess:e=>{alert(`Successfully created ${e.created} positions`),A(!1),eb()}}),g&&c.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:c.jsx("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:(0,c.jsxs)("form",{onSubmit:et,children:[(0,c.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900",children:R?"Edit Position":"Create New Position"}),(0,c.jsxs)("button",{type:"button",onClick:ei,className:"text-gray-400 hover:text-gray-600",children:[c.jsx("span",{className:"sr-only",children:"Close"}),c.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsxs)("div",{children:[c.jsx("label",{htmlFor:"positionNumber",className:"block text-sm font-medium text-gray-700 mb-1",children:"Position Number *"}),c.jsx("input",{type:"number",id:"positionNumber",value:Z.positionNumber,onChange:e=>ee({...Z,positionNumber:parseInt(e.target.value)||1}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"1",max:"1000",required:!0})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Position Name *"}),c.jsx("input",{type:"text",id:"name",value:Z.name,onChange:e=>ee({...Z,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Sound Operator, Parking Attendant",required:!0})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{htmlFor:"area",className:"block text-sm font-medium text-gray-700 mb-1",children:"Area"}),c.jsx("input",{type:"text",id:"area",value:Z.area,onChange:e=>ee({...Z,area:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Main Hall, Parking Lot A"})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),c.jsx("textarea",{id:"description",value:Z.description,onChange:e=>ee({...Z,description:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Brief description of the position..."})]})]}),(0,c.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[c.jsx("button",{type:"button",onClick:ei,className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium transition-colors",children:"Cancel"}),c.jsx("button",{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:R?"Update Position":"Create Position"})]})]})})}),N&&P&&c.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:c.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,c.jsxs)("div",{className:"mt-3",children:[(0,c.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Add Shift to ",P.name]}),(0,c.jsxs)("form",{onSubmit:en,children:[(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quick Templates"}),(0,c.jsxs)("select",{onChange:e=>{let t=e.target.value;"morning"===t?X({...W,startTime:"07:50",endTime:"10:00",isAllDay:!1}):"midday"===t?X({...W,startTime:"10:00",endTime:"12:00",isAllDay:!1}):"afternoon"===t?X({...W,startTime:"12:00",endTime:"14:00",isAllDay:!1}):"evening"===t?X({...W,startTime:"14:00",endTime:"17:00",isAllDay:!1}):"allday"===t&&X({...W,startTime:"",endTime:"",isAllDay:!0})},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[c.jsx("option",{value:"",children:"Select a template or create custom..."}),c.jsx("option",{value:"morning",children:"Morning (7:50 - 10:00)"}),c.jsx("option",{value:"midday",children:"Midday (10:00 - 12:00)"}),c.jsx("option",{value:"afternoon",children:"Afternoon (12:00 - 14:00)"}),c.jsx("option",{value:"evening",children:"Evening (14:00 - 17:00)"}),c.jsx("option",{value:"allday",children:"All Day"})]})]}),(0,c.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Time"}),c.jsx("input",{type:"time",value:W.startTime,onChange:e=>X({...W,startTime:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:W.isAllDay})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Time"}),c.jsx("input",{type:"time",value:W.endTime,onChange:e=>X({...W,endTime:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:W.isAllDay})]})]}),c.jsx("div",{children:(0,c.jsxs)("label",{className:"flex items-center",children:[c.jsx("input",{type:"checkbox",checked:W.isAllDay,onChange:e=>X({...W,isAllDay:e.target.checked}),className:"mr-2"}),c.jsx("span",{className:"text-sm text-gray-700",children:"All Day Shift"})]})})]}),(0,c.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[c.jsx("button",{type:"button",onClick:()=>j(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),c.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md",children:"Add Shift"})]})]})]})})}),$&&P&&c.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:c.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,c.jsxs)("div",{className:"mt-3",children:[(0,c.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Assign Overseer to ",P.name]}),(0,c.jsxs)("form",{onSubmit:el,children:[(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Overseer"}),(0,c.jsxs)("select",{value:Y.overseerId,onChange:e=>Q({...Y,overseerId:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[c.jsx("option",{value:"",children:"Select an overseer..."}),a?.filter(e=>(Array.isArray(e.formsOfService)?e.formsOfService:"string"==typeof e.formsOfService?e.formsOfService.split(",").map(e=>e.trim()):[]).some(e=>"overseer"===e.toLowerCase())).map(e=>c.jsxs("option",{value:e.id,children:[e.firstName," ",e.lastName," (Elder)"]},e.id))]})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Keyman (Optional)"}),(0,c.jsxs)("select",{value:Y.keymanId,onChange:e=>Q({...Y,keymanId:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[c.jsx("option",{value:"",children:"Select a keyman..."}),a?.filter(e=>(Array.isArray(e.formsOfService)?e.formsOfService:"string"==typeof e.formsOfService?e.formsOfService.split(",").map(e=>e.trim()):[]).some(e=>"keyman"===e.toLowerCase())).map(e=>c.jsxs("option",{value:e.id,children:[e.firstName," ",e.lastName," (MS)"]},e.id))]})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Responsibilities"}),c.jsx("textarea",{rows:3,value:Y.responsibilities,onChange:e=>Q({...Y,responsibilities:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Special instructions or responsibilities..."})]})]}),(0,c.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[c.jsx("button",{type:"button",onClick:()=>D(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),c.jsx("button",{type:"submit",className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md",children:"Assign Overseer"})]})]})]})})}),S&&P&&c.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:c.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,c.jsxs)("div",{className:"mt-3",children:[(0,c.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Assign Attendant to ",P.name,F&&(0,c.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:["Shift: ",F.name," ",!F.isAllDay&&`(${F.startTime} - ${F.endTime})`]})]}),(0,c.jsxs)("form",{onSubmit:async t=>{t.preventDefault();let s=new FormData(t.currentTarget),a=s.get("attendantId"),i=s.get("shiftId");if(!a){alert("Please select an attendant");return}if(!i){alert("Please select a shift");return}try{let t=await fetch(`/api/events/${e}/assignments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({positionId:P.id,attendantId:a,shiftId:i,role:"ATTENDANT"})});if(t.ok)alert("Attendant assigned successfully"),k(!1),L(null),n.reload();else{let e=await t.json();409===t.status?"DUPLICATE_SHIFT_ASSIGNMENT"===e.conflictType?alert("âš ï¸ Conflict: This attendant is already assigned to this shift."):"TIME_OVERLAP"===e.conflictType?alert(`âš ï¸ Time Conflict: This attendant has conflicting assignments:

${e.conflicts?.map(e=>`â€¢ ${e.positionName} - ${e.shiftName}`).join("\n")}

Please choose a different attendant or shift.`):"SHIFT_FULL"===e.conflictType?alert("âš ï¸ Shift Full: This shift already has the maximum number of attendants assigned (1)."):"ROLE_OCCUPIED"===e.conflictType?alert(`âš ï¸ Role Occupied: ${e.message}`):alert(`âš ï¸ Assignment Conflict: ${e.message||"Unable to assign attendant to this shift."}`):alert(`Failed to assign attendant: ${e.error||"Unknown error"}`)}}catch(e){console.error("Error assigning attendant:",e),alert("Failed to assign attendant")}},children:[(0,c.jsxs)("div",{className:"mb-4",children:[(0,c.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Select Attendant",(()=>{let e=P.assignments?.find(e=>"OVERSEER"===e.role)?.attendant,t=P.assignments?.find(e=>"KEYMAN"===e.role)?.attendant;return e||t?c.jsx("span",{className:"text-xs text-orange-600 font-normal block mt-1",children:"Showing all attendants (hierarchy filtering temporarily disabled)"}):null})()]}),(0,c.jsxs)("select",{name:"attendantId",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[c.jsx("option",{value:"",children:"Select an attendant..."}),(()=>{let e=P.oversight&&P.oversight.length>0?P.oversight[0]:null,t=e?.overseer,s=e?.keyman,i=a?.filter(e=>e.isActive)||[];if(console.log(`ðŸ” DEBUGGING ATTENDANT DATA:`),console.log(`   ðŸ“Š Total attendants: ${a?.length||0}`),console.log(`   ðŸ“Š Active attendants: ${i.length}`),i.slice(0,5).forEach(e=>{console.log(`   ðŸ‘¤ ${e.firstName} ${e.lastName}:`),console.log(`      - overseerId: ${e.overseerId}`),console.log(`      - keymanId: ${e.keymanId}`),console.log(`      - overseer: ${e.overseer?`${e.overseer.firstName} ${e.overseer.lastName}`:"null"}`),console.log(`      - keyman: ${e.keyman?`${e.keyman.firstName} ${e.keyman.lastName}`:"null"}`)}),t||s){let e=i.length;i=i.filter(e=>{let a=t&&e.overseerId===t.id,i=s&&e.keymanId===s.id;return a||i}),console.log(`ðŸ” Position oversight filtering (EXACT MATCH):`),console.log(`   ðŸ“ Position: ${P.name}`),console.log(`   ðŸ‘¥ Position Overseer: ${t?`${t.firstName} ${t.lastName} (${t.id})`:"None"}`),console.log(`   ðŸ‘¥ Position Keyman: ${s?`${s.firstName} ${s.lastName} (${s.id})`:"None"}`),console.log(`   ðŸ“Š Before filter: ${e} attendants`),console.log(`   ðŸ“Š After exact match filter: ${i.length} attendants`),i.length>0?i.forEach(e=>{let t=e.overseer?`${e.overseer.firstName} ${e.overseer.lastName}`:"None",s=e.keyman?`${e.keyman.firstName} ${e.keyman.lastName}`:"None";console.log(`   âœ… ${e.firstName} ${e.lastName}:`),console.log(`      - Attendant Overseer: ${t} (${e.overseerId||"null"})`),console.log(`      - Attendant Keyman: ${s} (${e.keymanId||"null"})`)}):(console.log(`   âŒ NO ATTENDANTS MATCH THIS POSITION'S OVERSIGHT!`),console.log(`   ðŸ’¡ No attendants are assigned to ${t?t.firstName+" "+t.lastName:"this overseer"} in the attendants page`))}else console.log(`ðŸ” Position "${P.name}" has no oversight - showing all active attendants`);return i.map(e=>(0,c.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName,e.congregation&&` (${e.congregation})`]},e.id))})()]})]}),(0,c.jsxs)("div",{className:"mb-4",children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Shift"}),(0,c.jsxs)("select",{name:"shiftId",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,defaultValue:F?.id||"",children:[c.jsx("option",{value:"",children:"Select a shift..."}),P.shifts?.map(e=>c.jsxs("option",{value:e.id,children:[e.name," ",!e.isAllDay&&`(${e.startTime} - ${e.endTime})`]},e.id))]})]}),(0,c.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[c.jsx("button",{type:"button",onClick:()=>{k(!1),L(null)},className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),c.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md",children:"Assign Attendant"})]})]})]})})}),T&&K.size>0&&c.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:c.jsx("div",{className:"relative top-10 mx-auto p-6 border w-11/12 md:w-4/5 lg:w-3/4 shadow-lg rounded-md bg-white max-h-screen overflow-y-auto",children:(0,c.jsxs)("div",{className:"mt-3",children:[(0,c.jsxs)("h3",{className:"text-xl font-semibold text-gray-900 mb-6",children:["Bulk Operations - ",K.size," Positions Selected"]}),(0,c.jsxs)("div",{className:"space-y-8",children:[(0,c.jsxs)("div",{className:"border border-blue-200 rounded-lg p-6 bg-blue-50",children:[(0,c.jsxs)("h4",{className:"text-lg font-medium text-blue-900 mb-4 flex items-center",children:[c.jsx("span",{className:"bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm mr-3",children:"1"}),"Bulk Position Updates"]}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Update Area"}),c.jsx("input",{id:"bulk-area",type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Leave blank to keep current"})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Update Status"}),(0,c.jsxs)("select",{id:"bulk-status",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[c.jsx("option",{value:"",children:"Keep current status"}),c.jsx("option",{value:"true",children:"Active"}),c.jsx("option",{value:"false",children:"Inactive"})]})]})]}),c.jsx("div",{className:"mt-4 flex justify-end",children:c.jsx("button",{onClick:er,disabled:q,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-md font-medium",children:q?"Updating...":`Update ${K.size} Positions`})})]}),(0,c.jsxs)("div",{className:"border border-orange-200 rounded-lg p-6 bg-orange-50",children:[(0,c.jsxs)("h4",{className:"text-lg font-medium text-orange-900 mb-4 flex items-center",children:[c.jsx("span",{className:"bg-orange-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm mr-3",children:"2"}),"Bulk Shift Operations"]}),(0,c.jsxs)("div",{className:"mb-6 p-4 border border-orange-300 rounded-md bg-white",children:[c.jsx("h5",{className:"font-medium text-gray-900 mb-3",children:"Apply Shift Template"}),(0,c.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,c.jsxs)("select",{id:"bulk-template",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[c.jsx("option",{value:"",children:"Choose a template..."}),c.jsx("option",{value:"standard",children:"Standard Day (7:50-10, 10-12, 12-2, 2-5)"}),c.jsx("option",{value:"extended",children:"Extended Day (6:30-8:30, 8:30-10:30, 10:30-12:45, 12:45-3, 3-Close)"}),c.jsx("option",{value:"allday",children:"All Day Shift"})]}),c.jsx("button",{onClick:eo,disabled:q,className:"px-4 py-2 bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 text-white rounded-md font-medium",children:"Apply Template"})]})]}),(0,c.jsxs)("div",{className:"p-4 border border-orange-300 rounded-md bg-white",children:[c.jsx("h5",{className:"font-medium text-gray-900 mb-3",children:"Create Custom Shift"}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Shift Name"}),c.jsx("input",{id:"bulk-shift-name",type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"e.g., Morning"})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Time"}),c.jsx("input",{id:"bulk-shift-start",type:"time",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Time"}),c.jsx("input",{id:"bulk-shift-end",type:"time",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),c.jsx("div",{className:"flex items-end",children:(0,c.jsxs)("div",{className:"flex items-center h-10",children:[c.jsx("input",{id:"bulk-shift-allday",type:"checkbox",className:"h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded"}),c.jsx("label",{htmlFor:"bulk-shift-allday",className:"ml-2 text-sm text-gray-900",children:"All Day"})]})})]}),c.jsx("div",{className:"mt-4 flex justify-end",children:c.jsx("button",{onClick:ed,disabled:q,className:"px-4 py-2 bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 text-white rounded-md font-medium",children:q?"Creating...":`Create Shift for ${K.size} Positions`})})]})]}),(0,c.jsxs)("div",{className:"border border-green-200 rounded-lg p-6 bg-green-50",children:[(0,c.jsxs)("h4",{className:"text-lg font-medium text-green-900 mb-4 flex items-center",children:[c.jsx("span",{className:"bg-green-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm mr-3",children:"3"}),"Bulk Oversight Assignment"]}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assign Overseer"}),(0,c.jsxs)("select",{id:"bulk-overseer",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",children:[c.jsx("option",{value:"",children:"No change"}),a?.filter(e=>e.isActive&&Array.isArray(e.formsOfService)&&e.formsOfService.some(e=>"overseer"===e.toLowerCase())).map(e=>c.jsxs("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assign Keyman"}),(0,c.jsxs)("select",{id:"bulk-keyman",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",children:[c.jsx("option",{value:"",children:"No change"}),a?.filter(e=>e.isActive&&Array.isArray(e.formsOfService)&&e.formsOfService.some(e=>"keyman"===e.toLowerCase())).map(e=>c.jsxs("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]})]})]}),c.jsx("div",{className:"mt-4 p-3 bg-green-100 border border-green-300 rounded-md",children:(0,c.jsxs)("p",{className:"text-sm text-green-800",children:["âœ… ",c.jsx("strong",{children:"No shift dependency required"})," - Oversight can be assigned independently of shifts"]})}),c.jsx("div",{className:"mt-4 flex justify-end",children:c.jsx("button",{onClick:ec,disabled:q,className:"px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white rounded-md font-medium",children:q?"Assigning...":`Assign Oversight to ${K.size} Positions`})})]})]}),c.jsx("div",{className:"flex justify-end space-x-3 mt-8 pt-6 border-t",children:c.jsx("button",{type:"button",onClick:()=>C(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Close"})})]})})}),E&&K.size>0&&c.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:c.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,c.jsxs)("div",{className:"mt-3",children:[(0,c.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Apply Shift Template to ",K.size," Position(s)"]}),(0,c.jsxs)("form",{onSubmit:async t=>{t.preventDefault();let s=new FormData(t.currentTarget).get("templateType");if(!s){alert("Please select a template");return}try{G(!0);let t=await fetch(`/api/events/${e}/positions/apply-shift-template`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({positionIds:Array.from(K),templateType:s})});if(t.ok){let e=await t.json();alert(`âœ… Template Applied Successfully!

â€¢ Positions: ${e.data.positionsProcessed}
â€¢ Shifts Created: ${e.data.totalShiftsCreated}
â€¢ Template: ${e.data.templateType}`),I(!1),J(new Set),n.reload()}else{let e=await t.json();alert(`Failed to apply template: ${e.error||"Unknown error"}`)}}catch(e){console.error("Error applying template:",e),alert("Failed to apply template")}finally{G(!1)}},children:[(0,c.jsxs)("div",{className:"mb-4",children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Shift Template"}),(0,c.jsxs)("select",{name:"templateType",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[c.jsx("option",{value:"",children:"Choose a template..."}),c.jsx("option",{value:"standard",children:"Standard Day (7:50-10, 10-12, 12-2, 2-5)"}),c.jsx("option",{value:"extended",children:"Extended Day (6:30-8:30, 8:30-10:30, 10:30-12:45, 12:45-3, 3-Close)"})]})]}),c.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:(0,c.jsxs)("p",{className:"text-xs text-blue-800",children:[c.jsx("strong",{children:"Note:"})," This will create shifts for all selected positions. Existing shifts will not be affected."]})}),(0,c.jsxs)("div",{className:"flex justify-end space-x-3",children:[c.jsx("button",{type:"button",onClick:()=>{I(!1)},className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),c.jsx("button",{type:"submit",disabled:q,className:"px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white rounded-md",children:q?"Applying...":"Apply Template"})]})]})]})})})]})]}):null}async function j(e){console.log("\uD83D\uDD0D APEX GUARDIAN: getServerSideProps called at",new Date().toISOString());try{if(console.log("\uD83D\uDD0D Step 1: Getting session..."),!await (0,y.getServerSession)(e.req,e.res,v.L))return{redirect:{destination:"/auth/signin"}};console.log("\uD83D\uDD0D Step 2: Getting event ID from params...");let{id:t}=e.params;console.log("\uD83D\uDD0D Step 3: Event ID:",t),console.log("\uD83D\uDD0D Step 4: Importing Prisma...");let{prisma:a}=await Promise.resolve().then(s.bind(s,8925));console.log("\uD83D\uDD0D Step 5: Prisma imported successfully"),console.log("\uD83D\uDD0D Step 6: Fetching event data...");let i=await a.events.findUnique({where:{id:t},include:{positions:{include:{assignments:{include:{attendant:{select:{id:!0,firstName:!0,lastName:!0}},overseer:{select:{id:!0,firstName:!0,lastName:!0}},keyman:{select:{id:!0,firstName:!0,lastName:!0}},shift:{select:{id:!0,name:!0,startTime:!0,endTime:!0,isAllDay:!0}}}},shifts:!0},orderBy:[{positionNumber:"asc"}]}}});console.log("\uD83D\uDD0D Step 7: Event data fetched successfully, positions count:",i?.positions?.length||0),console.log("\uD83D\uDD0D Step 8: Fetching oversight data separately...");let n=await a.position_oversight_assignments.findMany({where:{eventId:t},include:{overseer:{select:{id:!0,firstName:!0,lastName:!0}},keyman:{select:{id:!0,firstName:!0,lastName:!0}}}});console.log("\uD83D\uDD0D Step 9: Oversight data fetched, count:",n.length);let l=i.positions.map(e=>{let t=n.filter(t=>t.positionId===e.id);return{...e,oversight:t}});console.log("\uD83D\uDD0D Step 10: Positions with oversight attached"),console.log("\uD83D\uDD0D Step 11: Fetching attendants data with event-specific oversight...");let r=await a.attendants.findMany({where:{isActive:!0},select:{id:!0,firstName:!0,lastName:!0,formsOfService:!0,congregation:!0,isActive:!0},orderBy:[{firstName:"asc"},{lastName:"asc"}]}),o=await a.event_attendant_associations.findMany({where:{eventId:t},include:{overseer:{select:{id:!0,firstName:!0,lastName:!0}},keyman:{select:{id:!0,firstName:!0,lastName:!0}}}}),d=new Map;o.forEach(e=>{e.attendantId&&d.set(e.attendantId,e)});let c=r.map(e=>{let t=d.get(e.id);return{...e,overseerId:t?.overseerId||null,keymanId:t?.keymanId||null,overseer:t?.overseer||null,keyman:t?.keyman||null}});console.log("\uD83D\uDD0D Step 11b: Event-specific attendant oversight loaded"),console.log(`   ðŸ“Š Total attendants: ${c.length}`),console.log(`   ðŸ“Š Event associations: ${o.length}`);let m=c.filter(e=>e.overseerId);if(console.log(`   ðŸ“Š Attendants with overseers: ${m.length}`),!i)return{notFound:!0};let h={id:i.id,name:i.name,eventType:i.eventType,startDate:i.startDate?.toISOString()||null,endDate:i.endDate?.toISOString()||null,status:i.status};i.positions.map(e=>({id:e.id,positionNumber:e.positionNumber,name:e.name,description:e.description,area:e.area||null,sequence:e.sequence||e.positionNumber,isActive:e.isActive,assignments:e.assignments.map(e=>({id:e.id,role:e.role||"ATTENDANT",attendant:e.attendant?{id:e.attendant.id,firstName:e.attendant.firstName,lastName:e.attendant.lastName}:null,overseer:e.overseer?{id:e.overseer.id,firstName:e.overseer.firstName,lastName:e.overseer.lastName}:null,keyman:e.keyman?{id:e.keyman.id,firstName:e.keyman.firstName,lastName:e.keyman.lastName}:null,shift:e.shift?{id:e.shift.id,name:e.shift.name,startTime:e.shift.startTime,endTime:e.shift.endTime,isAllDay:e.shift.isAllDay}:null})).filter(e=>null!==e.attendant)})),console.log("\uD83D\uDD0D Step 12: Final positions with oversight count:",l.length);let u=l.filter(e=>e.oversight&&e.oversight.length>0);return console.log("\uD83D\uDD0D Step 13: Positions that have oversight data:",u.length),u.forEach(e=>{console.log(`ðŸ” Position ${e.positionNumber} oversight:`,e.oversight)}),{props:{eventId:t,event:h,positions:l,attendants:c,stats:{total:l.length,active:l.filter(e=>e.isActive).length,assigned:l.filter(e=>e.assignments.length>0).length}}}}catch(e){return console.error("Error fetching event data:",e),{notFound:!0}}}let $=(0,l.l)(a,"default"),D=(0,l.l)(a,"getStaticProps"),w=(0,l.l)(a,"getStaticPaths"),A=(0,l.l)(a,"getServerSideProps"),S=(0,l.l)(a,"config"),k=(0,l.l)(a,"reportWebVitals"),T=(0,l.l)(a,"unstable_getStaticProps"),C=(0,l.l)(a,"unstable_getStaticPaths"),E=(0,l.l)(a,"unstable_getStaticParams"),I=(0,l.l)(a,"unstable_getServerProps"),P=(0,l.l)(a,"unstable_getServerSideProps"),O=new i.PagesRouteModule({definition:{kind:n.x.PAGES,page:"/events/[id]/positions",pathname:"/events/[id]/positions",bundlePath:"",filename:""},components:{App:d.default,Document:o()},userland:a})},6814:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n});var a=s(997),i=s(1649);function n({Component:e,pageProps:{session:t,...s}}){return a.jsx(i.SessionProvider,{session:t,children:a.jsx(e,{...s})})}s(6764)},5175:(e,t,s)=>{"use strict";s.d(t,{L:()=>c});var a=s(3227),i=s.n(a);let n=require("next-auth/providers/credentials");var l=s.n(n),r=s(8925);let o=require("bcryptjs");var d=s.n(o);let c={providers:[l()({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await r.prisma.users.findUnique({where:{email:e.email}});return t&&t.passwordHash&&await d().compare(e.password,t.passwordHash)?{id:t.id,email:t.email,name:`${t.firstName} ${t.lastName}`,role:t.role}:null}})],callbacks:{jwt:async({token:e,user:t})=>(t&&(e.role=t.role),e),session:async({session:e,token:t})=>(t&&(e.user.id=t.sub,e.user.role=t.role),e)},pages:{signIn:"/auth/signin"},session:{strategy:"jwt",maxAge:2592e3},cookies:{sessionToken:{name:"__Secure-next-auth.session-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0}}},secret:"staging-nextauth-secret-2024"};i()(c)},8925:(e,t,s)=>{"use strict";s.r(t),s.d(t,{prisma:()=>i});let a=require("@prisma/client"),i=globalThis.prisma??new a.PrismaClient},6764:()=>{},3227:e=>{"use strict";e.exports=require("next-auth")},1649:e=>{"use strict";e.exports=require("next-auth/react")},2785:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{"use strict";e.exports=require("next/head")},6689:e=>{"use strict";e.exports=require("react")},6405:e=>{"use strict";e.exports=require("react-dom")},997:e=>{"use strict";e.exports=require("react/jsx-runtime")},2048:e=>{"use strict";e.exports=require("fs")},5315:e=>{"use strict";e.exports=require("path")},6162:e=>{"use strict";e.exports=require("stream")},1568:e=>{"use strict";e.exports=require("zlib")}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[2899,8342,1664],()=>s(4483));module.exports=a})();