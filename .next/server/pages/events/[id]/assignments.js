(()=>{var e={};e.id=2980,e.ids=[2980,2888,660],e.modules={4101:(e,s,t)=>{"use strict";t.r(s),t.d(s,{config:()=>C,default:()=>y,getServerSideProps:()=>E,getStaticPaths:()=>S,getStaticProps:()=>w,reportWebVitals:()=>I,routeModule:()=>_,unstable_getServerProps:()=>D,unstable_getServerSideProps:()=>q,unstable_getStaticParams:()=>A,unstable_getStaticPaths:()=>P,unstable_getStaticProps:()=>k});var a={};t.r(a),t.d(a,{default:()=>v,getServerSideProps:()=>b});var i=t(7093),r=t(5244),n=t(1323),l=t(2899),d=t.n(l),o=t(6814),c=t(997),m=t(6689),u=t(1163),x=t(1649),h=t(968),p=t.n(h),g=t(1664),f=t.n(g),j=t(3227),N=t(5175);function v({eventId:e,event:s,assignments:t,attendants:a,positions:i,stats:r}){let n=(0,u.useRouter)(),{data:l}=(0,x.useSession)(),[d,o]=(0,m.useState)(!1),[h,g]=(0,m.useState)(!1),[j,N]=(0,m.useState)(null),[v,b]=(0,m.useState)({userId:"",positionId:"",shiftStart:"",shiftEnd:"",notes:""}),y=async s=>{if(s.preventDefault(),!v.userId||!v.positionId||!v.shiftStart||!v.shiftEnd){alert("Please fill in all required fields");return}let t=new Date(v.shiftStart);if(new Date(v.shiftEnd)<=t){alert("End time must be after start time");return}try{let s=j?`/api/event-assignments/${e}/${j.id}`:`/api/event-assignments/${e}`,t=await fetch(s,{method:j?"PUT":"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({userId:v.userId,positionId:v.positionId,shiftStart:new Date(v.shiftStart).toISOString(),shiftEnd:new Date(v.shiftEnd).toISOString(),notes:v.notes||"",eventId:e})});if(t.ok)alert(j?"Assignment updated successfully":"Assignment created successfully"),C(),n.reload();else{let e=await t.json();console.error("Assignment creation error:",e),alert(`Failed to save assignment: ${e.error||"Unknown error"}`)}}catch(e){console.error("Error saving assignment:",e),alert("Failed to save assignment")}},w=e=>{N(e),b({userId:e.userId,positionId:e.positionId,shiftStart:e.shiftStart.slice(0,16),shiftEnd:e.shiftEnd.slice(0,16),notes:e.notes||""}),g(!0)},S=async s=>{if(confirm("Are you sure you want to delete this assignment?"))try{let t=await fetch(`/api/event-assignments/${e}/${s}`,{method:"DELETE"});if(t.ok)alert("Assignment deleted successfully"),n.reload();else{let e=await t.json();alert(e.error||"Failed to delete assignment")}}catch(e){console.error("Error deleting assignment:",e),alert("Failed to delete assignment")}},E=async(s,t)=>{try{let a=await fetch(`/api/event-assignments/${e}/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:t})});if(a.ok)alert("Assignment status updated"),n.reload();else{let e=await a.json();alert(e.error||"Failed to update status")}}catch(e){console.error("Error updating status:",e),alert("Failed to update status")}},C=()=>{g(!1),N(null),b({userId:"",positionId:"",shiftStart:"",shiftEnd:"",notes:""})},I=e=>new Date(e).toLocaleString(),k=e=>{switch(e){case"ASSIGNED":return"bg-blue-100 text-blue-800";case"CONFIRMED":return"bg-green-100 text-green-800";case"COMPLETED":default:return"bg-gray-100 text-gray-800";case"CANCELLED":return"bg-red-100 text-red-800"}};return d?c.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,c.jsxs)("div",{className:"text-center",children:[c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),c.jsx("p",{className:"mt-4 text-gray-600",children:"Loading assignments..."})]})}):l?(0,c.jsxs)(c.Fragment,{children:[c.jsx(p(),{children:(0,c.jsxs)("title",{children:[s?.name?`${s.name} - Assignments`:"Event Assignments"," | JW Attendant Scheduler"]})}),(0,c.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,c.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,c.jsxs)("div",{className:"mb-8",children:[(0,c.jsxs)("nav",{className:"flex items-center space-x-2 text-sm text-gray-500 mb-4",children:[c.jsx(f(),{href:"/events",className:"hover:text-gray-700",children:"Events"}),c.jsx("span",{children:"›"}),c.jsx(f(),{href:`/events/${e}`,className:"hover:text-gray-700",children:s?.name||"Event"}),c.jsx("span",{children:"›"}),c.jsx("span",{className:"text-gray-900",children:"Assignments"})]}),(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsxs)("div",{children:[c.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Event Assignments"}),(0,c.jsxs)("p",{className:"text-gray-600 mt-2",children:["Manage assignments for ",s?.name]})]}),(0,c.jsxs)("div",{className:"flex space-x-3",children:[c.jsx(f(),{href:`/events/${e}`,className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium transition-colors",children:"← Back to Event"}),c.jsx("button",{onClick:()=>g(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"+ Create Assignment"})]})]})]}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[c.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:(0,c.jsxs)("div",{className:"flex items-center",children:[c.jsx("div",{className:"flex-shrink-0",children:c.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:c.jsx("span",{className:"text-blue-600 font-semibold",children:"\uD83D\uDCCB"})})}),(0,c.jsxs)("div",{className:"ml-4",children:[c.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Assignments"}),c.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:t.length})]})]})}),c.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:(0,c.jsxs)("div",{className:"flex items-center",children:[c.jsx("div",{className:"flex-shrink-0",children:c.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center",children:c.jsx("span",{className:"text-green-600 font-semibold",children:"✓"})})}),(0,c.jsxs)("div",{className:"ml-4",children:[c.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Confirmed"}),c.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:t.filter(e=>"CONFIRMED"===e.status).length})]})]})}),c.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:(0,c.jsxs)("div",{className:"flex items-center",children:[c.jsx("div",{className:"flex-shrink-0",children:c.jsx("div",{className:"w-8 h-8 bg-yellow-100 rounded-lg flex items-center justify-center",children:c.jsx("span",{className:"text-yellow-600 font-semibold",children:"⏳"})})}),(0,c.jsxs)("div",{className:"ml-4",children:[c.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Pending"}),c.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:t.filter(e=>"ASSIGNED"===e.status).length})]})]})}),c.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:(0,c.jsxs)("div",{className:"flex items-center",children:[c.jsx("div",{className:"flex-shrink-0",children:c.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:c.jsx("span",{className:"text-purple-600 font-semibold",children:"✅"})})}),(0,c.jsxs)("div",{className:"ml-4",children:[c.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Completed"}),c.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:t.filter(e=>"COMPLETED"===e.status).length})]})]})})]}),(0,c.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[c.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:c.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Assignments List"})}),c.jsx("div",{className:"overflow-x-auto",children:(0,c.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[c.jsx("thead",{className:"bg-gray-50",children:(0,c.jsxs)("tr",{children:[c.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Attendant"}),c.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Position"}),c.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Shift Time"}),c.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),c.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),c.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:0===t.length?c.jsx("tr",{children:c.jsx("td",{colSpan:5,className:"px-6 py-12 text-center text-gray-500",children:(0,c.jsxs)("div",{className:"flex flex-col items-center",children:[c.jsx("span",{className:"text-4xl mb-2",children:"\uD83D\uDCCB"}),c.jsx("p",{className:"text-lg font-medium",children:"No assignments created"}),c.jsx("p",{className:"text-sm",children:'Click "Create Assignment" to get started'})]})})}):t.map(e=>(0,c.jsxs)("tr",{className:"hover:bg-gray-50",children:[c.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,c.jsxs)("div",{className:"flex items-center",children:[c.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:c.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center",children:(0,c.jsxs)("span",{className:"text-blue-600 font-medium",children:[e.users.firstName[0],e.users.lastName[0]]})})}),(0,c.jsxs)("div",{className:"ml-4",children:[(0,c.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:[e.users.firstName," ",e.users.lastName]}),c.jsx("div",{className:"text-sm text-gray-500",children:e.users.email})]})]})}),(0,c.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[c.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.event_positions.positionName}),(0,c.jsxs)("div",{className:"text-sm text-gray-500",children:[e.event_positions.department," • #",e.event_positions.positionNumber]})]}),(0,c.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[c.jsx("div",{children:I(e.shiftStart)}),(0,c.jsxs)("div",{children:["to ",I(e.shiftEnd)]})]}),c.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,c.jsxs)("select",{value:e.status,onChange:s=>E(e.id,s.target.value),className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full border-0 ${k(e.status)}`,children:[c.jsx("option",{value:"ASSIGNED",children:"Assigned"}),c.jsx("option",{value:"CONFIRMED",children:"Confirmed"}),c.jsx("option",{value:"COMPLETED",children:"Completed"}),c.jsx("option",{value:"CANCELLED",children:"Cancelled"})]})}),(0,c.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2",children:[c.jsx("button",{onClick:()=>w(e),className:"text-blue-600 hover:text-blue-900 transition-colors",children:"Edit"}),c.jsx("button",{onClick:()=>S(e.id),className:"text-red-600 hover:text-red-900 transition-colors",children:"Delete"})]})]},e.id))})]})})]})]}),h&&c.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:c.jsx("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:(0,c.jsxs)("form",{onSubmit:y,children:[(0,c.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900",children:j?"Edit Assignment":"Create New Assignment"}),(0,c.jsxs)("button",{type:"button",onClick:C,className:"text-gray-400 hover:text-gray-600",children:[c.jsx("span",{className:"sr-only",children:"Close"}),c.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsxs)("div",{children:[c.jsx("label",{htmlFor:"userId",className:"block text-sm font-medium text-gray-700 mb-1",children:"Attendant *"}),(0,c.jsxs)("select",{id:"userId",value:v.userId,onChange:e=>b({...v,userId:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[c.jsx("option",{value:"",children:"Select an attendant"}),a&&a.length>0?a.map(e=>(0,c.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id)):c.jsx("option",{value:"",disabled:!0,children:"No attendants available"})]})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{htmlFor:"positionId",className:"block text-sm font-medium text-gray-700 mb-1",children:"Position *"}),(0,c.jsxs)("select",{id:"positionId",value:v.positionId,onChange:e=>b({...v,positionId:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[c.jsx("option",{value:"",children:"Select a position"}),i&&i.length>0?i.map(e=>(0,c.jsxs)("option",{value:e.id,children:[e.positionName," (",e.department||"No Area",")"]},e.id)):c.jsx("option",{value:"",disabled:!0,children:"No positions available"})]})]}),(0,c.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,c.jsxs)("div",{children:[c.jsx("label",{htmlFor:"shiftStart",className:"block text-sm font-medium text-gray-700 mb-1",children:"Shift Start *"}),c.jsx("input",{type:"datetime-local",id:"shiftStart",value:v.shiftStart,onChange:e=>b({...v,shiftStart:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{htmlFor:"shiftEnd",className:"block text-sm font-medium text-gray-700 mb-1",children:"Shift End *"}),c.jsx("input",{type:"datetime-local",id:"shiftEnd",value:v.shiftEnd,onChange:e=>b({...v,shiftEnd:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),c.jsx("textarea",{id:"notes",value:v.notes,onChange:e=>b({...v,notes:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Any additional notes or instructions..."})]})]}),(0,c.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[c.jsx("button",{type:"button",onClick:C,className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium transition-colors",children:"Cancel"}),c.jsx("button",{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:j?"Update Assignment":"Create Assignment"})]})]})})})]})]}):null}let b=async e=>{if(!await (0,j.getServerSession)(e.req,e.res,N.L))return{redirect:{destination:"/auth/signin",permanent:!1}};let{id:s}=e.params;try{let{prisma:e}=await Promise.resolve().then(t.bind(t,8925)),a=await e.events.findUnique({where:{id:s},include:{assignments:{include:{users:{select:{id:!0,firstName:!0,lastName:!0,email:!0}}},orderBy:[{shiftStart:"asc"}]},event_attendant_associations:{include:{attendants:{select:{id:!0,firstName:!0,lastName:!0,email:!0}}}},positions:{select:{id:!0,name:!0,area:!0,positionNumber:!0},orderBy:[{positionNumber:"asc"}]}}});if(!a)return{notFound:!0};let i={id:a.id,name:a.name,eventType:a.eventType,startDate:a.startDate?.toISOString()||null,endDate:a.endDate?.toISOString()||null,status:a.status},r=a.assignments.map(e=>{let s=a.positions.find(s=>s.id===e.positionId);return{id:e.id,userId:e.userId,positionId:e.positionId,shiftStart:e.shiftStart?.toISOString()||null,shiftEnd:e.shiftEnd?.toISOString()||null,status:e.status,notes:e.notes,users:e.users?{id:e.users.id,firstName:e.users.firstName,lastName:e.users.lastName,email:e.users.email}:null,event_positions:s?{id:s.id,positionName:s.name,department:s.area||"",positionNumber:s.positionNumber}:null}}).filter(e=>e.users&&e.event_positions),n=a.event_attendant_associations.filter(e=>e.attendants).map(e=>({id:e.attendants.id,firstName:e.attendants.firstName,lastName:e.attendants.lastName,email:e.attendants.email})),l=a.positions.map(e=>({id:e.id,positionName:e.name,department:e.area||"",positionNumber:e.positionNumber}));return{props:{eventId:s,event:i,assignments:r,attendants:n,positions:l,stats:{total:r.length,assigned:r.filter(e=>"ASSIGNED"===e.status).length,confirmed:r.filter(e=>"CONFIRMED"===e.status).length,completed:r.filter(e=>"COMPLETED"===e.status).length}}}}catch(e){return console.error("Error fetching assignments data:",e),{notFound:!0}}},y=(0,n.l)(a,"default"),w=(0,n.l)(a,"getStaticProps"),S=(0,n.l)(a,"getStaticPaths"),E=(0,n.l)(a,"getServerSideProps"),C=(0,n.l)(a,"config"),I=(0,n.l)(a,"reportWebVitals"),k=(0,n.l)(a,"unstable_getStaticProps"),P=(0,n.l)(a,"unstable_getStaticPaths"),A=(0,n.l)(a,"unstable_getStaticParams"),D=(0,n.l)(a,"unstable_getServerProps"),q=(0,n.l)(a,"unstable_getServerSideProps"),_=new i.PagesRouteModule({definition:{kind:r.x.PAGES,page:"/events/[id]/assignments",pathname:"/events/[id]/assignments",bundlePath:"",filename:""},components:{App:o.default,Document:d()},userland:a})},6814:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});var a=t(997),i=t(1649);function r({Component:e,pageProps:{session:s,...t}}){return a.jsx(i.SessionProvider,{session:s,children:a.jsx(e,{...t})})}t(6764)},5175:(e,s,t)=>{"use strict";t.d(s,{L:()=>c});var a=t(3227),i=t.n(a);let r=require("next-auth/providers/credentials");var n=t.n(r),l=t(8925);let d=require("bcryptjs");var o=t.n(d);let c={providers:[n()({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let s=await l.prisma.users.findUnique({where:{email:e.email}});return s&&s.passwordHash&&await o().compare(e.password,s.passwordHash)?{id:s.id,email:s.email,name:`${s.firstName} ${s.lastName}`,role:s.role}:null}})],callbacks:{jwt:async({token:e,user:s})=>(s&&(e.role=s.role),e),session:async({session:e,token:s})=>(s&&(e.user.id=s.sub,e.user.role=s.role),e)},pages:{signIn:"/auth/signin"},session:{strategy:"jwt",maxAge:2592e3},cookies:{sessionToken:{name:"__Secure-next-auth.session-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0}}},secret:"staging-nextauth-secret-2024"};i()(c)},8925:(e,s,t)=>{"use strict";t.r(s),t.d(s,{prisma:()=>i});let a=require("@prisma/client"),i=globalThis.prisma??new a.PrismaClient},6764:()=>{},3227:e=>{"use strict";e.exports=require("next-auth")},1649:e=>{"use strict";e.exports=require("next-auth/react")},2785:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{"use strict";e.exports=require("next/head")},6689:e=>{"use strict";e.exports=require("react")},6405:e=>{"use strict";e.exports=require("react-dom")},997:e=>{"use strict";e.exports=require("react/jsx-runtime")},2048:e=>{"use strict";e.exports=require("fs")},5315:e=>{"use strict";e.exports=require("path")},6162:e=>{"use strict";e.exports=require("stream")},1568:e=>{"use strict";e.exports=require("zlib")}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[2899,8342,1664],()=>t(4101));module.exports=a})();