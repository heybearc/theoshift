(()=>{var e={};e.id=854,e.ids=[854,888,660],e.modules={476:(e,t,s)=>{"use strict";s.r(t),s.d(t,{config:()=>S,default:()=>j,getServerSideProps:()=>w,getStaticPaths:()=>N,getStaticProps:()=>v,reportWebVitals:()=>A,routeModule:()=>R,unstable_getServerProps:()=>C,unstable_getServerSideProps:()=>P,unstable_getStaticParams:()=>k,unstable_getStaticPaths:()=>E,unstable_getStaticProps:()=>D});var a={};s.r(a),s.d(a,{default:()=>y,getServerSideProps:()=>f});var r=s(7093),l=s(5244),n=s(1323),i=s(2899),d=s.n(i),c=s(6814),o=s(997),x=s(3227),m=s(5175),u=s(9061),h=s(6689),g=s(1664),p=s.n(g),b=s(1163);function y(){let{id:e}=(0,b.useRouter)().query,[t,s]=(0,h.useState)([]),[a,r]=(0,h.useState)([]),[l,n]=(0,h.useState)(!0),[i,d]=(0,h.useState)(""),[c,x]=(0,h.useState)(""),[m,g]=(0,h.useState)(""),[y,f]=(0,h.useState)(""),[j,v]=(0,h.useState)(""),[N,w]=(0,h.useState)(!1),[S,A]=(0,h.useState)(!1),[D,E]=(0,h.useState)([]),[k,C]=(0,h.useState)({page:1,limit:20,total:0,pages:0,hasNext:!1,hasPrev:!1}),P=async(t=1)=>{if(e)try{n(!0);let a=new URLSearchParams({page:t.toString(),limit:k.limit.toString(),search:y,role:j}),l=await fetch(`/api/admin/events/${e}/attendants?${a}`),i=await l.json();i.success?(s(i.data.associations),r(i.data.availableUsers),C(i.data.pagination),i.data.associations.length>0&&g(i.data.associations[0].events.name)):d("Failed to fetch attendants")}catch(e){d("Error fetching attendants"),console.error("Error:",e)}finally{n(!1)}},R=async(t,s,a)=>{try{let r=await fetch(`/api/admin/events/${e}/attendants`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t,role:s,notes:a})}),l=await r.json();l.success?(x("Attendant added successfully!"),w(!1),P(k.page),setTimeout(()=>x(""),3e3)):d(l.error||"Failed to add attendant")}catch(e){d("Error adding attendant"),console.error("Error:",e)}},T=async()=>{if(0===D.length){d("Please select at least one user");return}try{let t=await fetch(`/api/admin/events/${e}/attendants`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({attendants:D.map(e=>({userId:e}))})}),s=await t.json();s.success?(x(`Successfully added ${s.data.created} attendants!`),A(!1),E([]),P(k.page),setTimeout(()=>x(""),3e3)):d(s.error||"Failed to add attendants")}catch(e){d("Error adding attendants"),console.error("Error:",e)}},q=async t=>{if(confirm("Are you sure you want to remove this attendant from the event?"))try{let s=await fetch(`/api/admin/events/${e}/attendants/${t}`,{method:"DELETE"}),a=await s.json();a.success?(x("Attendant removed successfully!"),P(k.page),setTimeout(()=>x(""),3e3)):d(a.error||"Failed to remove attendant")}catch(e){d("Error removing attendant"),console.error("Error:",e)}},O=e=>({ADMIN:"bg-red-100 text-red-800",OVERSEER:"bg-purple-100 text-purple-800",ASSISTANT_OVERSEER:"bg-blue-100 text-blue-800",KEYMAN:"bg-green-100 text-green-800",ATTENDANT:"bg-gray-100 text-gray-800"})[e]||"bg-gray-100 text-gray-800";return o.jsx(u.Z,{children:(0,o.jsxs)("div",{className:"max-w-7xl mx-auto",children:[o.jsx("div",{className:"mb-6",children:(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsxs)("div",{children:[o.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Event Attendants"}),(0,o.jsxs)("p",{className:"mt-2 text-sm text-gray-600",children:["Manage attendants for: ",o.jsx("span",{className:"font-medium",children:m})]})]}),(0,o.jsxs)("div",{className:"flex space-x-3",children:[o.jsx(p(),{href:`/admin/events/${e}`,className:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded transition-colors",children:"← Back to Event"}),o.jsx("button",{onClick:()=>A(!0),className:"bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded transition-colors",children:"\uD83D\uDCE5 Bulk Add"}),o.jsx("button",{onClick:()=>w(!0),className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition-colors",children:"➕ Add Attendant"})]})]})}),i&&(0,o.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:[o.jsx("p",{className:"text-red-700",children:i}),o.jsx("button",{onClick:()=>d(""),className:"mt-2 text-red-600 hover:text-red-800",children:"✕ Dismiss"})]}),c&&o.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6",children:o.jsx("p",{className:"text-green-700",children:c})}),o.jsx("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,o.jsxs)("div",{children:[o.jsx("label",{htmlFor:"search",className:"block text-sm font-medium text-gray-700 mb-1",children:"Search Attendants"}),o.jsx("input",{type:"text",id:"search",value:y,onChange:e=>f(e.target.value),placeholder:"Search by name or email...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,o.jsxs)("div",{children:[o.jsx("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 mb-1",children:"Filter by Role"}),(0,o.jsxs)("select",{id:"role",value:j,onChange:e=>v(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[o.jsx("option",{value:"",children:"All Roles"}),o.jsx("option",{value:"OVERSEER",children:"Overseer"}),o.jsx("option",{value:"ASSISTANT_OVERSEER",children:"Assistant Overseer"}),o.jsx("option",{value:"KEYMAN",children:"Keyman"}),o.jsx("option",{value:"ATTENDANT",children:"Attendant"})]})]}),o.jsx("div",{className:"flex items-end",children:o.jsx("button",{onClick:()=>P(1),className:"w-full bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"\uD83D\uDD04 Refresh"})})]})}),o.jsx("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:l?(0,o.jsxs)("div",{className:"p-8 text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),o.jsx("p",{className:"mt-2 text-gray-600",children:"Loading attendants..."})]}):0===t.length?(0,o.jsxs)("div",{className:"p-8 text-center",children:[o.jsx("p",{className:"text-gray-500",children:"No attendants associated with this event"}),o.jsx("button",{onClick:()=>w(!0),className:"mt-4 inline-block bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition-colors",children:"Add First Attendant"})]}):(0,o.jsxs)(o.Fragment,{children:[o.jsx("div",{className:"overflow-x-auto",children:(0,o.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[o.jsx("thead",{className:"bg-gray-50",children:(0,o.jsxs)("tr",{children:[o.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Attendant"}),o.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"System Role"}),o.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Event Role"}),o.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Notes"}),o.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Added"}),o.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),o.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(t=>(0,o.jsxs)("tr",{className:"hover:bg-gray-50",children:[o.jsx("td",{className:"px-6 py-4",children:(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:[t.users.firstName," ",t.users.lastName]}),o.jsx("div",{className:"text-sm text-gray-500",children:t.users.email})]})}),o.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:o.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${O(t.users.role)}`,children:t.users.role})}),o.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.role||"Not specified"}),o.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:o.jsx("div",{className:"max-w-xs truncate",children:t.notes||"No notes"})}),o.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(t.createdAt).toLocaleDateString()}),(0,o.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2",children:[o.jsx(p(),{href:`/admin/events/${e}/attendants/${t.userId}`,className:"text-blue-600 hover:text-blue-900 transition-colors",children:"\uD83D\uDCCB Manage"}),o.jsx("button",{onClick:()=>q(t.userId),className:"text-red-600 hover:text-red-900 transition-colors",children:"\uD83D\uDDD1️ Remove"})]})]},t.id))})]})}),k.pages>1&&o.jsx("div",{className:"bg-white px-4 py-3 border-t border-gray-200 sm:px-6",children:(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsxs)("div",{className:"text-sm text-gray-700",children:["Showing page ",k.page," of ",k.pages," (",k.total," total attendants)"]}),(0,o.jsxs)("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:()=>P(k.page-1),disabled:!k.hasPrev,className:"px-3 py-1 text-sm bg-gray-200 text-gray-700 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-300",children:"Previous"}),o.jsx("span",{className:"px-3 py-1 text-sm bg-blue-600 text-white rounded",children:k.page}),o.jsx("button",{onClick:()=>P(k.page+1),disabled:!k.hasNext,className:"px-3 py-1 text-sm bg-gray-200 text-gray-700 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-300",children:"Next"})]})]})})]})}),N&&o.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:o.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,o.jsxs)("div",{className:"mt-3",children:[o.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Add Attendant"}),(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsxs)("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select User"}),(0,o.jsxs)("select",{id:"userSelect",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[o.jsx("option",{value:"",children:"Choose a user..."}),a.map(e=>(0,o.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName," (",e.email,")"]},e.id))]})]}),(0,o.jsxs)("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Event Role (Optional)"}),o.jsx("input",{type:"text",id:"eventRole",placeholder:"e.g., Security Team Leader",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,o.jsxs)("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes (Optional)"}),o.jsx("textarea",{id:"notes",rows:2,placeholder:"Additional notes...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,o.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[o.jsx("button",{onClick:()=>w(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),o.jsx("button",{onClick:()=>{let e=document.getElementById("userSelect"),t=document.getElementById("eventRole"),s=document.getElementById("notes");e.value?R(e.value,t.value,s.value):d("Please select a user")},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Add Attendant"})]})]})})}),S&&o.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:o.jsx("div",{className:"relative top-10 mx-auto p-5 border w-2/3 max-w-4xl shadow-lg rounded-md bg-white",children:(0,o.jsxs)("div",{className:"mt-3",children:[o.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Bulk Add Attendants"}),o.jsx("div",{className:"max-h-96 overflow-y-auto",children:o.jsx("div",{className:"space-y-2",children:a.map(e=>(0,o.jsxs)("label",{className:"flex items-center space-x-3 p-2 hover:bg-gray-50 rounded",children:[o.jsx("input",{type:"checkbox",checked:D.includes(e.id),onChange:t=>{t.target.checked?E([...D,e.id]):E(D.filter(t=>t!==e.id))},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,o.jsxs)("div",{className:"flex-1",children:[(0,o.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:[e.firstName," ",e.lastName]}),o.jsx("div",{className:"text-sm text-gray-500",children:e.email})]}),o.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${O(e.role)}`,children:e.role})]},e.id))})}),(0,o.jsxs)("div",{className:"flex justify-between items-center mt-6",children:[(0,o.jsxs)("p",{className:"text-sm text-gray-600",children:[D.length," users selected"]}),(0,o.jsxs)("div",{className:"flex space-x-3",children:[o.jsx("button",{onClick:()=>{A(!1),E([])},className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,o.jsxs)("button",{onClick:T,disabled:0===D.length,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:["Add ",D.length," Attendants"]})]})]})]})})})]})})}let f=async e=>{let t=await (0,x.getServerSession)(e.req,e.res,m.L);return t?{props:{session:t}}:{redirect:{destination:"/auth/signin",permanent:!1}}},j=(0,n.l)(a,"default"),v=(0,n.l)(a,"getStaticProps"),N=(0,n.l)(a,"getStaticPaths"),w=(0,n.l)(a,"getServerSideProps"),S=(0,n.l)(a,"config"),A=(0,n.l)(a,"reportWebVitals"),D=(0,n.l)(a,"unstable_getStaticProps"),E=(0,n.l)(a,"unstable_getStaticPaths"),k=(0,n.l)(a,"unstable_getStaticParams"),C=(0,n.l)(a,"unstable_getServerProps"),P=(0,n.l)(a,"unstable_getServerSideProps"),R=new r.PagesRouteModule({definition:{kind:l.x.PAGES,page:"/event-attendants/[eventId]",pathname:"/event-attendants/[eventId]",bundlePath:"",filename:""},components:{App:c.default,Document:d()},userland:a})},9061:(e,t,s)=>{"use strict";s.d(t,{Z:()=>d});var a=s(997),r=s(1163),l=s(1649),n=s(1664),i=s.n(n);function d({children:e,title:t,breadcrumbs:s=[]}){let n=(0,r.useRouter)(),{data:d}=(0,l.useSession)(),c=async()=>{await (0,l.signOut)({callbackUrl:"/auth/signin"})};return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[a.jsx("nav",{className:"bg-white shadow-sm border-b border-gray-200",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between h-16",children:[a.jsx("div",{className:"flex items-center",children:(0,a.jsxs)(i(),{href:"/admin",className:"flex items-center",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("div",{className:"h-8 w-8 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg flex items-center justify-center",children:a.jsx("span",{className:"text-white font-bold text-sm",children:"JW"})})}),a.jsx("div",{className:"ml-3",children:a.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"Admin Portal"})})]})}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("span",{className:"text-sm text-gray-700",children:["Welcome, ",d?.user?.name]}),a.jsx("button",{onClick:c,className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded-md text-sm font-medium transition-colors",children:"Sign Out"})]})]})})}),(0,a.jsxs)("div",{className:"flex",children:[a.jsx("nav",{className:"w-64 bg-white shadow-sm min-h-screen border-r border-gray-200",children:a.jsx("div",{className:"p-4",children:a.jsx("ul",{className:"space-y-2",children:[{label:"Dashboard",href:"/admin",icon:"\uD83C\uDFE0"},{label:"User Management",href:"/admin/users",icon:"\uD83D\uDC65"},{label:"Health Monitor",href:"/admin/health",icon:"\uD83D\uDC9A"},{label:"API Status",href:"/admin/api-status",icon:"\uD83D\uDCCA"},{label:"Audit Logs",href:"/admin/audit-logs",icon:"\uD83D\uDCCB"},{label:"System Operations",href:"/admin/system-ops",icon:"⚡"},{label:"Email Configuration",href:"/admin/email-config",icon:"\uD83D\uDCE7"}].map(e=>{let t=n.pathname===e.href||"/admin"!==e.href&&n.pathname.startsWith(e.href);return a.jsx("li",{children:(0,a.jsxs)(i(),{href:e.href,className:`flex items-center px-3 py-2 rounded-md text-sm font-medium transition-colors ${t?"bg-blue-50 text-blue-700 border-r-2 border-blue-600":"text-gray-700 hover:bg-gray-50 hover:text-gray-900"}`,children:[a.jsx("span",{className:"mr-3",children:e.icon}),e.label]})},e.href)})})})}),(0,a.jsxs)("main",{className:"flex-1",children:[s.length>0&&a.jsx("div",{className:"bg-white border-b border-gray-200 px-6 py-3",children:a.jsx("nav",{className:"flex","aria-label":"Breadcrumb",children:(0,a.jsxs)("ol",{className:"flex items-center space-x-2",children:[a.jsx("li",{children:a.jsx(i(),{href:"/admin",className:"text-gray-500 hover:text-gray-700",children:"Dashboard"})}),s.map((e,t)=>(0,a.jsxs)("li",{className:"flex items-center",children:[a.jsx("svg",{className:"flex-shrink-0 h-4 w-4 text-gray-400 mx-2",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})}),e.href?a.jsx(i(),{href:e.href,className:"text-gray-500 hover:text-gray-700",children:e.label}):a.jsx("span",{className:"text-gray-900 font-medium",children:e.label})]},t))]})})}),(0,a.jsxs)("div",{className:"p-6",children:[t&&a.jsx("div",{className:"mb-6",children:a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:t})}),e]})]})]})]})}},6814:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l});var a=s(997),r=s(1649);function l({Component:e,pageProps:{session:t,...s}}){return a.jsx(r.SessionProvider,{session:t,children:a.jsx(e,{...s})})}s(6764)},5175:(e,t,s)=>{"use strict";s.d(t,{L:()=>o});var a=s(3227),r=s.n(a);let l=require("next-auth/providers/credentials");var n=s.n(l),i=s(8925);let d=require("bcryptjs");var c=s.n(d);let o={providers:[n()({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await i.prisma.users.findUnique({where:{email:e.email}});return t&&t.passwordHash&&await c().compare(e.password,t.passwordHash)?{id:t.id,email:t.email,name:`${t.firstName} ${t.lastName}`,role:t.role}:null}})],session:{strategy:"jwt"},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.role=t.role),e),session:async({session:e,token:t})=>(t&&(e.user.id=t.sub,e.user.role=t.role),e)},pages:{signIn:"/auth/signin"}};r()(o)},8925:(e,t,s)=>{"use strict";s.r(t),s.d(t,{prisma:()=>r});let a=require("@prisma/client"),r=globalThis.prisma??new a.PrismaClient},6764:()=>{},3227:e=>{"use strict";e.exports=require("next-auth")},1649:e=>{"use strict";e.exports=require("next-auth/react")},2785:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{"use strict";e.exports=require("react")},6405:e=>{"use strict";e.exports=require("react-dom")},997:e=>{"use strict";e.exports=require("react/jsx-runtime")},2048:e=>{"use strict";e.exports=require("fs")},5315:e=>{"use strict";e.exports=require("path")},6162:e=>{"use strict";e.exports=require("stream")},1568:e=>{"use strict";e.exports=require("zlib")}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[899,342,664],()=>s(476));module.exports=a})();