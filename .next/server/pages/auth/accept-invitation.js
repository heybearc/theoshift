(()=>{var e={};e.id=885,e.ids=[885,2888,660],e.modules={266:(e,t,s)=>{"use strict";s.r(t),s.d(t,{config:()=>w,default:()=>f,getServerSideProps:()=>b,getStaticPaths:()=>j,getStaticProps:()=>y,reportWebVitals:()=>N,routeModule:()=>A,unstable_getServerProps:()=>k,unstable_getServerSideProps:()=>C,unstable_getStaticParams:()=>q,unstable_getStaticPaths:()=>S,unstable_getStaticProps:()=>P});var r={};s.r(r),s.d(r,{default:()=>g,getServerSideProps:()=>v});var i=s(7093),a=s(5244),n=s(1323),o=s(2899),l=s.n(o),c=s(6814),d=s(997),u=s(6689),x=s(1163),m=s(1664),p=s.n(m),h=s(7652);function g({invitation:e,error:t}){let s=(0,x.useRouter)(),[r,i]=(0,u.useState)(!1),[a,n]=(0,u.useState)({password:"",confirmPassword:""}),[o,l]=(0,u.useState)("");if(t||!e)return d.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:d.jsx("div",{className:"max-w-md w-full space-y-8",children:(0,d.jsxs)("div",{className:"text-center",children:[d.jsx("div",{className:"mx-auto h-12 w-12 text-red-500 text-4xl",children:"❌"}),d.jsx("h2",{className:"mt-6 text-3xl font-extrabold text-gray-900",children:"Invalid Invitation"}),d.jsx("p",{className:"mt-2 text-sm text-gray-600",children:t||"This invitation link is invalid or has expired."}),d.jsx("div",{className:"mt-6",children:d.jsx(p(),{href:"/auth/signin",className:"text-indigo-600 hover:text-indigo-500",children:"Return to Sign In"})})]})})});let c=async e=>{if(e.preventDefault(),l(""),a.password!==a.confirmPassword){l("Passwords do not match");return}if(a.password.length<8){l("Password must be at least 8 characters long");return}i(!0);try{let e=await fetch("/api/auth/accept-invitation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:s.query.token,password:a.password})}),t=await e.json();t.success?s.push("/auth/signin?message=Account created successfully. Please sign in."):l(t.error||"Failed to accept invitation")}catch(e){l("An error occurred. Please try again.")}finally{i(!1)}};return new Date(e.expiresAt)<new Date?d.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:d.jsx("div",{className:"max-w-md w-full space-y-8",children:(0,d.jsxs)("div",{className:"text-center",children:[d.jsx("div",{className:"mx-auto h-12 w-12 text-yellow-500 text-4xl",children:"⏰"}),d.jsx("h2",{className:"mt-6 text-3xl font-extrabold text-gray-900",children:"Invitation Expired"}),(0,d.jsxs)("p",{className:"mt-2 text-sm text-gray-600",children:["This invitation expired on ",new Date(e.expiresAt).toLocaleDateString(),". Please contact your administrator for a new invitation."]}),d.jsx("div",{className:"mt-6",children:d.jsx(p(),{href:"/auth/signin",className:"text-indigo-600 hover:text-indigo-500",children:"Return to Sign In"})})]})})}):d.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:(0,d.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,d.jsxs)("div",{children:[d.jsx("div",{className:"mx-auto h-12 w-12 text-green-500 text-4xl text-center",children:"\uD83C\uDF89"}),d.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Welcome to JW Attendant Scheduler"}),d.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Complete your account setup"})]}),(0,d.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,d.jsxs)("div",{className:"mb-6",children:[d.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Invitation Details"}),(0,d.jsxs)("div",{className:"space-y-2 text-sm text-gray-600",children:[(0,d.jsxs)("p",{children:[d.jsx("strong",{children:"Name:"})," ",e.firstName," ",e.lastName]}),(0,d.jsxs)("p",{children:[d.jsx("strong",{children:"Email:"})," ",e.email]}),(0,d.jsxs)("p",{children:[d.jsx("strong",{children:"Role:"})," ",e.role]}),(0,d.jsxs)("p",{children:[d.jsx("strong",{children:"Invited by:"})," ",e.invitedByUser.firstName," ",e.invitedByUser.lastName]}),e.message&&d.jsx("div",{className:"mt-3 p-3 bg-blue-50 border-l-4 border-blue-400",children:(0,d.jsxs)("p",{className:"text-blue-700 italic",children:['"',e.message,'"']})})]})]}),(0,d.jsxs)("form",{onSubmit:c,className:"space-y-6",children:[(0,d.jsxs)("div",{children:[d.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Create Password"}),d.jsx("input",{id:"password",name:"password",type:"password",required:!0,className:"mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm",placeholder:"Enter your password",value:a.password,onChange:e=>n({...a,password:e.target.value})})]}),(0,d.jsxs)("div",{children:[d.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700",children:"Confirm Password"}),d.jsx("input",{id:"confirmPassword",name:"confirmPassword",type:"password",required:!0,className:"mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm",placeholder:"Confirm your password",value:a.confirmPassword,onChange:e=>n({...a,confirmPassword:e.target.value})})]}),o&&d.jsx("div",{className:"text-red-600 text-sm",children:o}),d.jsx("div",{children:d.jsx("button",{type:"submit",disabled:r,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:r?"Creating Account...":"Accept Invitation & Create Account"})})]}),(0,d.jsxs)("div",{className:"mt-4 text-xs text-gray-500 text-center",children:["Expires: ",new Date(e.expiresAt).toLocaleDateString()]})]})]})})}let v=async e=>{let{token:t}=e.query;if(!t||"string"!=typeof t)return{props:{invitation:null,error:"Invalid invitation token"}};try{let e=await h.prisma.users.findFirst({where:{inviteToken:t},select:{id:!0,email:!0,firstName:!0,lastName:!0,inviteToken:!0,inviteExpiry:!0}});if(!e)return{props:{invitation:null,error:"Invitation not found or already used"}};return{props:{invitation:{id:e.id,email:e.email,firstName:e.firstName,lastName:e.lastName,inviteToken:e.inviteToken,inviteExpiry:e.inviteExpiry?.toISOString()||null}}}}catch(e){return console.error("Error fetching invitation:",e),{props:{invitation:null,error:"Failed to load invitation"}}}},f=(0,n.l)(r,"default"),y=(0,n.l)(r,"getStaticProps"),j=(0,n.l)(r,"getStaticPaths"),b=(0,n.l)(r,"getServerSideProps"),w=(0,n.l)(r,"config"),N=(0,n.l)(r,"reportWebVitals"),P=(0,n.l)(r,"unstable_getStaticProps"),S=(0,n.l)(r,"unstable_getStaticPaths"),q=(0,n.l)(r,"unstable_getStaticParams"),k=(0,n.l)(r,"unstable_getServerProps"),C=(0,n.l)(r,"unstable_getServerSideProps"),A=new i.PagesRouteModule({definition:{kind:a.x.PAGES,page:"/auth/accept-invitation",pathname:"/auth/accept-invitation",bundlePath:"",filename:""},components:{App:c.default,Document:l()},userland:r})},6814:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});var r=s(997),i=s(1649);function a({Component:e,pageProps:{session:t,...s}}){return r.jsx(i.SessionProvider,{session:t,children:r.jsx(e,{...s})})}s(6764)},7652:(e,t,s)=>{"use strict";s.r(t),s.d(t,{prisma:()=>i});var r=s(3524);let i=globalThis.prisma??new r.PrismaClient},6764:()=>{},3524:e=>{"use strict";e.exports=require("@prisma/client")},1649:e=>{"use strict";e.exports=require("next-auth/react")},2785:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{"use strict";e.exports=require("react")},6405:e=>{"use strict";e.exports=require("react-dom")},997:e=>{"use strict";e.exports=require("react/jsx-runtime")},2048:e=>{"use strict";e.exports=require("fs")},5315:e=>{"use strict";e.exports=require("path")},6162:e=>{"use strict";e.exports=require("stream")},1568:e=>{"use strict";e.exports=require("zlib")}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[2899,8342,1664],()=>s(266));module.exports=r})();