(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[97],{5002:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/attendants",function(){return a(9415)}])},9415:function(e,t,a){"use strict";a.r(t),a.d(t,{__N_SSP:function(){return w},default:function(){return b}});var n=a(5893),s=a(7294),r=a(1163),o=a(3299),i=a(9008),l=a.n(i),c=a(1664),d=a.n(c);class u{async getAttendants(e){var t;let a=new URLSearchParams;e.page&&a.append("page",e.page.toString()),e.limit&&a.append("limit",e.limit.toString()),e.search&&a.append("search",e.search),e.congregation&&a.append("congregation",e.congregation),(null===(t=e.formsOfService)||void 0===t?void 0:t.length)&&a.append("formsOfService",e.formsOfService.join(",")),void 0!==e.isActive&&a.append("isActive",e.isActive.toString()),void 0!==e.hasUser&&a.append("hasUser",e.hasUser.toString()),e.includeStats&&a.append("includeStats","true");let n=await fetch("".concat(this.baseUrl,"?").concat(a));if(!n.ok)throw Error("Failed to fetch attendants: ".concat(n.statusText));return n.json()}async getAttendant(e){let t=await fetch("".concat(this.baseUrl,"/").concat(e));if(!t.ok)throw Error("Failed to fetch attendant: ".concat(t.statusText));return t.json()}async createAttendant(e){let t=await fetch(this.baseUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json()).error||"Failed to create attendant");return t.json()}async updateAttendant(e,t){let a=await fetch("".concat(this.baseUrl,"/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw Error((await a.json()).error||"Failed to update attendant");return a.json()}async deleteAttendant(e){let t=await fetch("".concat(this.baseUrl,"/").concat(e),{method:"DELETE"});if(!t.ok)throw Error((await t.json()).error||"Failed to delete attendant");return t.json()}async bulkImport(e){let t=await fetch(this.baseUrl,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json();throw console.error("Bulk import error:",e),Error(e.error||"Failed to import attendants (".concat(t.status,": ").concat(t.statusText,")"))}return t.json()}async getEventAttendants(e,t){var a;let n=new URLSearchParams({eventId:e});(null==t?void 0:t.page)&&n.append("page",t.page.toString()),(null==t?void 0:t.limit)&&n.append("limit",t.limit.toString()),(null==t?void 0:t.search)&&n.append("search",t.search),(null==t?void 0:t.congregation)&&n.append("congregation",t.congregation),(null==t?void 0:null===(a=t.formsOfService)||void 0===a?void 0:a.length)&&n.append("formsOfService",t.formsOfService.join(",")),(null==t?void 0:t.isActive)!==void 0&&n.append("isActive",t.isActive.toString()),(null==t?void 0:t.hasUser)!==void 0&&n.append("hasUser",t.hasUser.toString()),(null==t?void 0:t.includeStats)&&n.append("includeStats","true");let s=await fetch("".concat(this.baseUrl,"?").concat(n));if(!s.ok)throw Error("Failed to fetch event attendants: ".concat(s.statusText));return s.json()}async addAttendantToEvent(e,t){let a=await fetch("/api/event-attendants/".concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({attendantIds:[t]})});if(!a.ok)throw Error((await a.json()).error||"Failed to add attendant to event");return a.json()}async removeAttendantFromEvent(e,t){let a=await fetch("/api/event-attendants/".concat(e,"/").concat(t),{method:"DELETE"});if(!a.ok)throw Error((await a.json()).error||"Failed to remove attendant from event");return a.json()}constructor(){this.baseUrl="/api/attendants"}}let h=new u;var p=a(5340),g=a(5924),m=a(6923),x=a(664),f=a(7497),v=a(4685);function j(e){let{eventId:t,eventName:a}=e;(0,r.useRouter)();let{data:i}=(0,o.useSession)(),[c,u]=(0,s.useState)(!1),[j,y]=(0,s.useState)(!1),[w,b]=(0,s.useState)(null),[S,N]=(0,s.useState)([]),[k,E]=(0,s.useState)([]),{attendants:A,loading:C,error:T,pagination:F,stats:P,filters:U,setFilters:z,setPage:O,setPageSize:Z,refresh:_,createAttendant:B,updateAttendant:D,deleteAttendant:I}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{eventId:t,initialFilters:a={},pageSize:n=10,includeStats:r=!1}=e,[o,i]=(0,s.useState)([]),[l,c]=(0,s.useState)(!0),[d,u]=(0,s.useState)(null),[p,g]=(0,s.useState)(),[m,x]=(0,s.useState)(a),[f,v]=(0,s.useState)({page:1,limit:n,total:0,pages:0}),j=(0,s.useCallback)(async()=>{try{var e,a;console.log("fetchAttendants called with:"),console.log("- eventId:",t),console.log("- pagination:",f),console.log("- filters:",m),c(!0),u(null);let n=t?await h.getEventAttendants(t,{...m,page:f.page,limit:f.limit,includeStats:r}):await h.getAttendants({...m,page:f.page,limit:f.limit,includeStats:r});console.log("API response:",n),console.log("Attendants returned:",(null===(a=n.data)||void 0===a?void 0:null===(e=a.attendants)||void 0===e?void 0:e.length)||0),n.success?(i(n.data.attendants),v(n.data.pagination),n.data.stats&&g(n.data.stats)):u(n.error||"Failed to fetch attendants")}catch(e){u(e instanceof Error?e.message:"An error occurred")}finally{c(!1)}},[t,m,f.page,f.limit,r]),y=(0,s.useCallback)(e=>{console.log("Setting page to:",e),v(t=>{let a={...t,page:e};return console.log("New pagination state:",a),a})},[]),w=(0,s.useCallback)(e=>{console.log("Setting page size to:",e),v(t=>{let a={...t,limit:-1===e?999999:e,page:1};return console.log("New pagination state:",a),a})},[]),b=(0,s.useCallback)(async()=>{await j()},[j]),S=(0,s.useCallback)(async e=>{try{u(null);let t=await h.createAttendant(e);if(t.success)await b();else throw Error(t.error||"Failed to create attendant")}catch(t){let e=t instanceof Error?t.message:"Failed to create attendant";throw u(e),Error(e)}},[b]),N=(0,s.useCallback)(async(e,t)=>{try{u(null);let a=await h.updateAttendant(e,t);if(a.success)await b();else throw Error(a.error||"Failed to update attendant")}catch(t){let e=t instanceof Error?t.message:"Failed to update attendant";throw u(e),Error(e)}},[b]),k=(0,s.useCallback)(async e=>{try{if(u(null),(await h.deleteAttendant(e)).success)await b();else throw Error("Failed to delete attendant")}catch(t){let e=t instanceof Error?t.message:"Failed to delete attendant";throw u(e),Error(e)}},[b]);return(0,s.useEffect)(()=>{j()},[j]),{attendants:o,loading:l,error:d,pagination:f,stats:p,filters:m,setFilters:x,setPage:y,setPageSize:w,refresh:b,createAttendant:S,updateAttendant:N,deleteAttendant:k}}({eventId:t,pageSize:25,includeStats:!0});(0,s.useEffect)(()=>{E(Array.from(new Set(A.map(e=>e.congregation).filter(Boolean))).sort())},[A]);let M=async e=>{w?await D(w.id,e):await B(e),b(null)},L=async e=>{try{let t=await h.bulkImport(e);return await _(),t.data}catch(e){throw console.error("Bulk import error:",e),e}},J=async(e,t)=>{try{let a=e.map(e=>h.updateAttendant(e,{isActive:t}));await Promise.all(a),await _(),N([])}catch(e){throw console.error("Bulk status change error:",e),e}},W=async e=>{confirm("Are you sure you want to delete this attendant? This action cannot be undone.")&&(await I(e),N(t=>t.filter(t=>t!==e)))},R=async()=>{if(0!==S.length&&confirm("Are you sure you want to delete ".concat(S.length," attendant(s)? This action cannot be undone.")))try{await Promise.all(S.map(e=>I(e))),N([])}catch(e){console.error("Error deleting attendants:",e)}},X=t?"".concat(a||"Event"," - Attendants"):"Attendant Management";return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l(),{children:(0,n.jsxs)("title",{children:[X," | JW Attendant Scheduler"]})}),(0,n.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,n.jsxs)("div",{className:"mb-8",children:[t&&(0,n.jsxs)("nav",{className:"flex items-center space-x-2 text-sm text-gray-500 mb-4",children:[(0,n.jsx)(d(),{href:"/events",className:"hover:text-gray-700",children:"Events"}),(0,n.jsx)("span",{children:"›"}),(0,n.jsx)(d(),{href:"/events/".concat(t),className:"hover:text-gray-700",children:a||"Event"}),(0,n.jsx)("span",{children:"›"}),(0,n.jsx)("span",{className:"text-gray-900",children:"Attendants"})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:t?"Event Attendants":"Attendant Management"}),(0,n.jsx)("p",{className:"text-gray-600 mt-2",children:t?"Manage attendants for ".concat(a):"Manage all attendants across the organization"})]}),(0,n.jsxs)("div",{className:"flex space-x-3",children:[t&&(0,n.jsx)(d(),{href:"/events/".concat(t),className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium transition-colors",children:"← Back to Event"}),(0,n.jsx)(v.Z,{onClick:()=>y(!0),variant:"secondary",children:"\uD83D\uDCE5 Bulk Import"}),(0,n.jsx)(v.Z,{onClick:()=>{b(null),u(!0)},variant:"primary",children:"+ Add Attendant"})]})]})]}),T&&(0,n.jsx)("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-md p-4",children:(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("svg",{className:"w-5 h-5 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,n.jsxs)("div",{className:"ml-3",children:[(0,n.jsx)("h4",{className:"text-sm font-medium text-red-800",children:"Error"}),(0,n.jsx)("p",{className:"text-sm text-red-700 mt-1",children:T})]})]})}),P&&!C&&(0,n.jsx)("div",{className:"mb-6",children:(0,n.jsx)(f.Z,{stats:P})}),(0,n.jsx)("div",{className:"mb-6",children:(0,n.jsx)(p.Z,{filters:U,onFiltersChange:z,congregations:k,loading:C})}),S.length>0&&(0,n.jsx)("div",{className:"mb-6 bg-blue-50 border border-blue-200 rounded-md p-4",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,n.jsxs)("span",{className:"ml-2 text-sm font-medium text-blue-800",children:[S.length," attendant(s) selected"]})]}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,n.jsx)(v.Z,{onClick:()=>N([]),variant:"secondary",size:"sm",children:"Clear Selection"}),(0,n.jsx)(v.Z,{onClick:()=>J(S,!0),variant:"primary",size:"sm",children:"Activate Selected"}),(0,n.jsx)(v.Z,{onClick:()=>J(S,!1),variant:"secondary",size:"sm",children:"Deactivate Selected"}),(0,n.jsx)(v.Z,{onClick:R,variant:"danger",size:"sm",children:"Delete Selected"})]})]})}),(0,n.jsx)("div",{className:"mb-6",children:(0,n.jsx)(g.Z,{attendants:A,loading:C,onEdit:e=>{b(e),u(!0)},onDelete:W,onSelect:N,selectedIds:S,onBulkStatusChange:J})}),(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 py-4 bg-white rounded-lg shadow px-4",children:[(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[(0,n.jsxs)("div",{className:"text-sm text-gray-700",children:["Showing ",(F.page-1)*F.limit+1," to"," ",Math.min(F.page*F.limit,F.total)," of"," ",F.total," results"]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("label",{htmlFor:"pageSize",className:"text-sm text-gray-700",children:"Show:"}),(0,n.jsxs)("select",{id:"pageSize",value:999999===F.limit?-1:F.limit,onChange:e=>{console.log("Select changed, setPageSize function:",typeof Z),console.log("New value:",e.target.value),e.preventDefault(),Z(Number(e.target.value))},disabled:C,className:"border border-gray-300 rounded-md px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,n.jsx)("option",{value:10,children:"10"}),(0,n.jsx)("option",{value:25,children:"25"}),(0,n.jsx)("option",{value:50,children:"50"}),(0,n.jsx)("option",{value:100,children:"100"}),(0,n.jsx)("option",{value:-1,children:"All"})]}),(0,n.jsx)("span",{className:"text-sm text-gray-700",children:"per page"})]}),(0,n.jsx)(v.Z,{onClick:()=>{console.log("DEBUG: Test button clicked!"),console.log("setPageSize type:",typeof Z),console.log("Current pagination:",F),Z(50)},variant:"primary",size:"sm",type:"button",children:"Test Button (Set to 50)"})]}),F.pages>1&&(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(v.Z,{onClick:()=>{console.log("Previous button clicked, setPage function:",typeof O),console.log("Current pagination:",F),O(F.page-1)},disabled:F.page<=1||C,variant:"secondary",size:"sm",type:"button",children:"Previous"}),(0,n.jsxs)("span",{className:"px-3 py-1 text-sm text-gray-700",children:["Page ",F.page," of ",F.pages]}),(0,n.jsx)(v.Z,{onClick:()=>{console.log("Next button clicked, setPage function:",typeof O),console.log("Current pagination:",F),O(F.page+1)},disabled:F.page>=F.pages||C,variant:"secondary",size:"sm",type:"button",children:"Next"})]})]})]}),(0,n.jsx)(m.Z,{isOpen:c,onClose:()=>{u(!1),b(null)},onSave:M,attendant:w}),(0,n.jsx)(x.Z,{isOpen:j,onClose:()=>y(!1),onImport:L,eventId:t})]})}var y=a(5083),w=!0;function b(){return(0,n.jsx)(y.Z,{title:"Attendant Management | JW Attendant Scheduler",breadcrumbs:[{label:"Home",href:"/events"},{label:"Attendants"}],children:(0,n.jsx)(j,{})})}}},function(e){e.O(0,[424,860,888,774,179],function(){return e(e.s=5002)}),_N_E=e.O()}]);