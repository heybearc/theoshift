(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[199],{9781:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/events/[id]/attendants",function(){return a(4535)}])},5083:function(e,t,a){"use strict";a.d(t,{Z:function(){return o}});var s=a(5893),r=a(3299),l=a(1664),n=a.n(l),i=a(1163);function o(e){var t;let{children:a,title:l="JW Attendant Scheduler",breadcrumbs:o=[],selectedEvent:c}=e,{data:d}=(0,r.useSession)(),m=(0,i.useRouter)(),x=[{label:"Events",href:"/events",icon:"\uD83D\uDCC5",roles:["ADMIN","OVERSEER","ATTENDANT"]},{label:"Event Selection",href:"/events/select",icon:"\uD83C\uDFAF",roles:["ADMIN","OVERSEER","ATTENDANT"]}];(null==d?void 0:null===(t=d.user)||void 0===t?void 0:t.role)==="ADMIN"&&x.push({label:"Admin Portal",href:"/admin",icon:"\uD83D\uDEE1️",roles:["ADMIN"]});let u=x.filter(e=>{var t;return e.roles.includes((null==d?void 0:null===(t=d.user)||void 0===t?void 0:t.role)||"")});return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)("nav",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex justify-between h-16",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)(n(),{href:"/events/select",className:"flex items-center",children:[(0,s.jsx)("span",{className:"text-2xl font-bold text-blue-600",children:"\uD83D\uDCCB"}),(0,s.jsx)("span",{className:"ml-2 text-xl font-semibold text-gray-900",children:"JW Attendant Scheduler"})]}),(0,s.jsx)("div",{className:"hidden md:ml-8 md:flex md:space-x-4",children:u.map(e=>(0,s.jsxs)(n(),{href:e.href,className:"px-3 py-2 rounded-md text-sm font-medium transition-colors ".concat(m.pathname.startsWith(e.href)?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"),children:[(0,s.jsx)("span",{className:"mr-2",children:e.icon}),e.label]},e.href))})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[c&&(0,s.jsxs)("div",{className:"hidden md:flex items-center bg-blue-50 px-3 py-1 rounded-lg",children:[(0,s.jsxs)("span",{className:"text-sm text-blue-600 font-medium",children:["\uD83D\uDCC5 ",c.name]}),c.status&&(0,s.jsx)("span",{className:"ml-2 px-2 py-0.5 text-xs rounded-full ".concat("current"===c.status?"bg-green-100 text-green-800":"upcoming"===c.status?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"),children:c.status})]}),(null==d?void 0:d.user)&&(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("span",{className:"text-sm text-gray-700",children:d.user.name}),(0,s.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat("ADMIN"===d.user.role?"bg-red-100 text-red-800":"OVERSEER"===d.user.role?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"),children:d.user.role}),(0,s.jsx)("button",{onClick:()=>{(0,r.signOut)({callbackUrl:"/auth/signin"})},className:"text-sm text-gray-600 hover:text-gray-900 transition-colors",children:"Sign Out"})]})]})]})})}),o.length>0&&(0,s.jsx)("div",{className:"bg-white border-b border-gray-200",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3",children:(0,s.jsx)("nav",{className:"flex","aria-label":"Breadcrumb",children:(0,s.jsx)("ol",{className:"flex items-center space-x-2",children:o.map((e,t)=>(0,s.jsxs)("li",{className:"flex items-center",children:[t>0&&(0,s.jsx)("svg",{className:"w-4 h-4 text-gray-400 mx-2",fill:"currentColor",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})}),e.href?(0,s.jsx)(n(),{href:e.href,className:"text-sm text-blue-600 hover:text-blue-800",children:e.label}):(0,s.jsx)("span",{className:"text-sm text-gray-500",children:e.label})]},t))})})})}),(0,s.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[l&&(0,s.jsx)("div",{className:"mb-8",children:(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:l})}),a]})]})}},4535:function(e,t,a){"use strict";a.r(t),a.d(t,{__N_SSP:function(){return i},default:function(){return o}});var s=a(5893),r=a(5083),l=a(7294),n=a(1163),i=!0;function o(e){let{eventId:t,event:a,attendants:i,stats:o}=e,c=(0,n.useRouter)(),[d,m]=(0,l.useState)(!1),[x,u]=(0,l.useState)(!1),[h,g]=(0,l.useState)(null),[f,p]=(0,l.useState)(null),[b,v]=(0,l.useState)(new Set),[y,N]=(0,l.useState)({isActive:"",formsOfService:"",congregation:"",overseerId:null,keymanId:null}),[j,w]=(0,l.useState)("lastName"),[k,A]=(0,l.useState)("asc"),S=l.useMemo(()=>[...i].sort((e,t)=>{let a=e[j],s=t[j];return("overseer"===j?(a=e.overseer?"".concat(e.overseer.firstName," ").concat(e.overseer.lastName):"",s=t.overseer?"".concat(t.overseer.firstName," ").concat(t.overseer.lastName):""):"keyman"===j?(a=e.keyman?"".concat(e.keyman.firstName," ").concat(e.keyman.lastName):"",s=t.keyman?"".concat(t.keyman.firstName," ").concat(t.keyman.lastName):""):"formsOfService"===j&&(a=Array.isArray(e.formsOfService)?e.formsOfService.join(", "):"",s=Array.isArray(t.formsOfService)?t.formsOfService.join(", "):""),a=String(a||"").toLowerCase(),s=String(s||"").toLowerCase(),"asc"===k)?a.localeCompare(s):s.localeCompare(a)}),[i,j,k]),C=e=>{j===e?A("asc"===k?"desc":"asc"):(w(e),A("asc"))},[O,E]=(0,l.useState)(!1),[D,I]=(0,l.useState)({search:"",congregation:"",isActive:"all"}),[P,L]=(0,l.useState)(1),[R,T]=(0,l.useState)(!1),[M,F]=(0,l.useState)(null);(0,l.useEffect)(()=>{{let e=new URLSearchParams(window.location.search),t=e.get("search")||"",a=e.get("congregation")||"",s=e.get("isActive")||"all",r=parseInt(e.get("page")||"1");(t||a||"all"!==s||1!==r)&&(I({search:t,congregation:a,isActive:s}),L(r))}},[]);let U=S.filter(e=>{let t=""===D.search||e.firstName.toLowerCase().includes(D.search.toLowerCase())||e.lastName.toLowerCase().includes(D.search.toLowerCase())||e.email.toLowerCase().includes(D.search.toLowerCase()),a=""===D.congregation||e.congregation&&e.congregation.toLowerCase().includes(D.congregation.toLowerCase()),s="all"===D.isActive||"true"===D.isActive&&e.isActive||"false"===D.isActive&&!e.isActive;return t&&a&&s}),B=Math.ceil(U.length/20),_=(P-1)*20,V=U.slice(_,_+20),[z,J]=(0,l.useState)({firstName:"",lastName:"",email:"",phone:"",congregation:"",formsOfService:"",notes:"",isActive:!0}),K=()=>{J({firstName:"",lastName:"",email:"",phone:"",congregation:"",formsOfService:"",notes:"",isActive:!0}),g(null),m(!0)},W=e=>{J({firstName:e.firstName,lastName:e.lastName,email:e.email,phone:e.phone||"",congregation:e.congregation||"",formsOfService:Array.isArray(e.formsOfService)?e.formsOfService.join(", "):e.formsOfService||"",notes:"",isActive:e.isActive}),g(e),m(!0)},q=async e=>{e.preventDefault(),T(!0);try{let e=h?"/api/events/".concat(t,"/attendants/").concat(h.associationId):"/api/events/".concat(t,"/attendants"),a=await fetch(e,{method:h?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(z)});if(a.ok)m(!1),c.reload();else{let e=await a.json();alert(e.error||"Failed to save attendant")}}catch(e){console.error("Error saving attendant:",e),alert("Failed to save attendant")}finally{T(!1)}},X=async e=>{if(confirm("Are you sure you want to remove ".concat(e.firstName," ").concat(e.lastName,"?"))){T(!0);try{console.log("\uD83D\uDDD1️ Removing attendant: ".concat(e.firstName," ").concat(e.lastName," (ID: ").concat(e.id,")"));let a=await fetch("/api/events/".concat(t,"/attendants/").concat(e.id),{method:"DELETE"});if(a.ok)c.reload();else{let e=await a.json();alert(e.error||"Failed to remove attendant")}}catch(e){console.error("Error removing attendant:",e),alert("Failed to remove attendant")}finally{T(!1)}}},Z=async()=>{if(f){T(!0);try{let e=(await f.text()).split("\n").filter(e=>e.trim());if(e.length<2){alert("CSV file must have at least a header row and one data row");return}let a=e[0].split(",").map(e=>e.trim().replace(/"/g,"")),s=[];for(let t=1;t<e.length;t++){let r=e[t].split(",").map(e=>e.trim().replace(/"/g,"")),l={};a.forEach((e,t)=>{let a=r[t]||"";switch(e.toLowerCase()){case"firstname":l.firstName=a;break;case"lastname":l.lastName=a;break;case"email":l.email=a;break;case"phone":l.phone=a;break;case"congregation":l.congregation=a;break;case"formsofservice":l.formsOfService=a;break;case"notes":l.notes=a;break;case"isactive":l.isActive="true"===a.toLowerCase()}}),l.firstName&&l.lastName&&l.email&&s.push(l)}if(0===s.length){alert("No valid attendant records found in CSV");return}let r=await fetch("/api/events/".concat(t,"/attendants"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({attendants:s})}),l=await r.json();l.success?(F(l.data),u(!1),c.reload(),alert("Successfully imported ".concat(s.length," attendants"))):alert("Import failed: ".concat(l.error))}catch(e){console.error("Import error:",e),alert("Failed to parse CSV file. Please check the format.")}finally{T(!1)}}},G=e=>{let t=new Set(b);t.has(e)?t.delete(e):t.add(e),v(t)},H=async()=>{if(0!==b.size){T(!0);try{let e=[],a=[];for(let s of b){let r=i.find(e=>e.associationId===s);if(!r){console.error("❌ Could not find attendant for association ID: ".concat(s));continue}let l={};""!==y.isActive&&(l.isActive="true"===y.isActive,console.log("\uD83D\uDD27 Bulk status update for ".concat(r.firstName," ").concat(r.lastName,": ").concat(y.isActive," → ").concat(l.isActive))),""!==y.congregation&&(l.congregation=y.congregation,console.log("\uD83D\uDD27 Bulk congregation update for ".concat(r.firstName," ").concat(r.lastName,": ").concat(l.congregation))),""!==y.formsOfService&&(l.formsOfService=y.formsOfService,console.log("\uD83D\uDD27 Bulk forms of service update for ".concat(r.firstName," ").concat(r.lastName,": ").concat(l.formsOfService))),Object.keys(l).length>0&&(console.log("\uD83D\uDCE1 Making bulk update API call for attendant ID: ".concat(r.id)),e.push(fetch("/api/events/".concat(t,"/attendants/").concat(r.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}).then(e=>e.ok?(console.log("✅ Basic data updated for ".concat(r.firstName," ").concat(r.lastName)),e):(console.error("Basic update failed for ".concat(r.firstName," ").concat(r.lastName,":"),e.status),e.json().then(e=>{throw console.error("Error details:",e),Error("Basic update failed: ".concat(e.error))})))));let n={};null!==y.overseerId&&(n.overseerId="REMOVE"===y.overseerId?null:y.overseerId),null!==y.keymanId&&(n.keymanId="REMOVE"===y.keymanId?null:y.keymanId),Object.keys(n).length>0&&(console.log("\uD83D\uDD27 Bulk oversight update for attendant ".concat(r.firstName," ").concat(r.lastName,":"),n),a.push(fetch("/api/events/".concat(t,"/attendants/").concat(r.id,"/oversight"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(e=>e.ok?(console.log("✅ Oversight updated for ".concat(r.firstName," ").concat(r.lastName)),e):(console.error("Oversight update failed for ".concat(r.firstName," ").concat(r.lastName,":"),e.status),e.json().then(e=>{throw console.error("Error details:",e),Error("Oversight update failed: ".concat(e.error))})))))}let s=await Promise.allSettled([...e,...a]),r=s.filter(e=>"rejected"===e.status),l=s.filter(e=>"fulfilled"===e.status);r.length>0?(console.error("Some updates failed:",r),alert("Bulk edit completed with ".concat(l.length," successful and ").concat(r.length," failed updates. Check console for details."))):console.log("✅ All ".concat(l.length," updates completed successfully")),E(!1),v(new Set),N({isActive:"",formsOfService:"",congregation:"",overseerId:null,keymanId:null}),c.reload()}catch(e){console.error("Bulk edit error:",e),alert("Failed to update attendants")}finally{T(!1)}}};return(0,s.jsx)(r.Z,{title:"".concat(a.name," - Attendants | JW Attendant Scheduler"),breadcrumbs:[{label:"Events",href:"/events"},{label:a.name,href:"/events/".concat(t)},{label:"Attendants"}],selectedEvent:{id:t,name:a.name,status:a.status},children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Event Attendants"}),(0,s.jsxs)("p",{className:"text-gray-600",children:["Manage attendants for ",a.name]})]}),(0,s.jsxs)("div",{className:"flex space-x-3",children:[(0,s.jsx)("button",{onClick:()=>c.push("/events/".concat(t)),className:"bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded transition-colors",children:"← Back to Event"}),(0,s.jsx)("button",{onClick:K,disabled:R,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white font-bold py-2 px-4 rounded transition-colors",children:"➕ Add Attendant"}),(0,s.jsx)("button",{onClick:()=>{u(!0),p(null),F(null)},disabled:R,className:"bg-green-600 hover:bg-green-700 disabled:bg-green-400 text-white font-bold py-2 px-4 rounded transition-colors",children:"\uD83D\uDCE5 Import Attendants"}),b.size>0&&(0,s.jsxs)("button",{onClick:()=>{if(0===b.size){alert("Please select attendants to edit");return}E(!0)},disabled:R,className:"bg-purple-600 hover:bg-purple-700 disabled:bg-purple-400 text-white font-bold py-2 px-4 rounded transition-colors",children:["✏️ Bulk Edit (",b.size,")"]})]})]})}),(0,s.jsx)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search"}),(0,s.jsx)("input",{type:"text",placeholder:"Search by name or email...",value:D.search,onChange:e=>I({...D,search:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Congregation"}),(0,s.jsx)("input",{type:"text",placeholder:"Filter by congregation...",value:D.congregation,onChange:e=>I({...D,congregation:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,s.jsxs)("select",{value:D.isActive,onChange:e=>I({...D,isActive:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,s.jsx)("option",{value:"all",children:"All"}),(0,s.jsx)("option",{value:"true",children:"Active"}),(0,s.jsx)("option",{value:"false",children:"Inactive"})]})]}),(0,s.jsx)("div",{className:"flex items-end",children:(0,s.jsx)("button",{onClick:()=>I({search:"",congregation:"",isActive:"all"}),className:"w-full bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md transition-colors",children:"Clear Filters"})})]})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[(0,s.jsx)("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:(0,s.jsx)("div",{className:"p-5",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-white font-bold",children:o.total})})}),(0,s.jsx)("div",{className:"ml-5 w-0 flex-1",children:(0,s.jsxs)("dl",{children:[(0,s.jsx)("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Total Attendants"}),(0,s.jsx)("dd",{className:"text-lg font-medium text-gray-900",children:o.total})]})})]})})}),(0,s.jsx)("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:(0,s.jsx)("div",{className:"p-5",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)("div",{className:"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-white font-bold",children:o.active})})}),(0,s.jsx)("div",{className:"ml-5 w-0 flex-1",children:(0,s.jsxs)("dl",{children:[(0,s.jsx)("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Active"}),(0,s.jsx)("dd",{className:"text-lg font-medium text-gray-900",children:o.active})]})})]})})}),(0,s.jsx)("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:(0,s.jsx)("div",{className:"p-5",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)("div",{className:"w-8 h-8 bg-red-500 rounded-full flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-white font-bold",children:o.inactive})})}),(0,s.jsx)("div",{className:"ml-5 w-0 flex-1",children:(0,s.jsxs)("dl",{children:[(0,s.jsx)("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Inactive"}),(0,s.jsx)("dd",{className:"text-lg font-medium text-gray-900",children:o.inactive})]})})]})})})]}),(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[(0,s.jsxs)("div",{className:"px-4 py-5 sm:p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Attendants List"}),0===i.length?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("p",{className:"text-gray-500",children:"No attendants found for this event"}),(0,s.jsx)("button",{onClick:K,disabled:R,className:"mt-4 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white font-bold py-2 px-4 rounded transition-colors",children:"Add First Attendant"})]}):(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,s.jsx)("input",{type:"checkbox",checked:b.size===i.length&&i.length>0,onChange:()=>{b.size===i.length?v(new Set):v(new Set(i.map(e=>e.associationId)))},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"})}),(0,s.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,s.jsxs)("button",{onClick:()=>C("lastName"),className:"flex items-center space-x-1 hover:text-gray-700",children:[(0,s.jsx)("span",{children:"Name"}),"lastName"===j&&(0,s.jsx)("span",{children:"asc"===k?"↑":"↓"})]})}),(0,s.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden sm:table-cell",children:(0,s.jsxs)("button",{onClick:()=>C("email"),className:"flex items-center space-x-1 hover:text-gray-700",children:[(0,s.jsx)("span",{children:"Email"}),"email"===j&&(0,s.jsx)("span",{children:"asc"===k?"↑":"↓"})]})}),(0,s.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden md:table-cell",children:(0,s.jsxs)("button",{onClick:()=>C("congregation"),className:"flex items-center space-x-1 hover:text-gray-700",children:[(0,s.jsx)("span",{children:"Congregation"}),"congregation"===j&&(0,s.jsx)("span",{children:"asc"===k?"↑":"↓"})]})}),(0,s.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden lg:table-cell",children:"Forms of Service"}),(0,s.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden md:table-cell",children:"Overseer"}),(0,s.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden md:table-cell",children:"Keyman"}),(0,s.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,s.jsxs)("button",{onClick:()=>C("isActive"),className:"flex items-center space-x-1 hover:text-gray-700",children:[(0,s.jsx)("span",{children:"Status"}),"isActive"===j&&(0,s.jsx)("span",{children:"asc"===k?"↑":"↓"})]})}),(0,s.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:V.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"px-2 py-3 whitespace-nowrap",children:(0,s.jsx)("input",{type:"checkbox",checked:b.has(e.associationId),onChange:()=>G(e.associationId),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"})}),(0,s.jsxs)("td",{className:"px-3 py-3 whitespace-nowrap",children:[(0,s.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:[e.firstName," ",e.lastName]}),(0,s.jsx)("div",{className:"text-xs text-gray-500 sm:hidden",children:e.email})]}),(0,s.jsx)("td",{className:"px-3 py-3 whitespace-nowrap hidden sm:table-cell",children:(0,s.jsx)("div",{className:"text-sm text-gray-900",children:e.email})}),(0,s.jsx)("td",{className:"px-3 py-3 whitespace-nowrap hidden md:table-cell",children:(0,s.jsx)("div",{className:"text-sm text-gray-900",children:e.congregation||"N/A"})}),(0,s.jsx)("td",{className:"px-3 py-3 whitespace-nowrap hidden lg:table-cell",children:(0,s.jsx)("div",{className:"flex flex-wrap gap-1",children:(Array.isArray(e.formsOfService)?e.formsOfService:(e.formsOfService||"").toString().split(", ").filter(e=>e.trim())).map((e,t)=>(0,s.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat("Overseer"===e?"bg-purple-100 text-purple-800":"Keyman"===e?"bg-blue-100 text-blue-800":"Elder"===e?"bg-yellow-100 text-yellow-800":"Ministerial Servant"===e?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e},t))})}),(0,s.jsx)("td",{className:"px-3 py-3 whitespace-nowrap hidden md:table-cell",children:(0,s.jsxs)("select",{value:e.overseerId||"",onChange:async a=>{let s=a.target.value||null;try{if((await fetch("/api/events/".concat(t,"/attendants/").concat(e.id,"/oversight"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({overseerId:s})})).ok)try{let e=new URL(window.location.href);D.search&&e.searchParams.set("search",D.search),D.congregation&&e.searchParams.set("congregation",D.congregation),"all"!==D.isActive&&e.searchParams.set("isActive",D.isActive),e.searchParams.set("page",P.toString()),window.location.href=e.toString()}catch(e){console.error("Error preserving filter state:",e),window.location.reload()}else alert("Failed to update overseer")}catch(e){console.error("Error updating overseer:",e),alert("Failed to update overseer")}},className:"text-xs border border-gray-300 rounded px-1 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500 w-full",children:[(0,s.jsx)("option",{value:"",children:"No Overseer"}),i.filter(e=>e.isActive&&Array.isArray(e.formsOfService)&&e.formsOfService.some(e=>e.toLowerCase().includes("overseer"))).map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]})}),(0,s.jsx)("td",{className:"px-3 py-3 whitespace-nowrap hidden md:table-cell",children:(0,s.jsxs)("select",{value:e.keymanId||"",onChange:async a=>{let s=a.target.value||null;try{if((await fetch("/api/events/".concat(t,"/attendants/").concat(e.id,"/oversight"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({keymanId:s})})).ok)try{let e=new URL(window.location.href);D.search&&e.searchParams.set("search",D.search),D.congregation&&e.searchParams.set("congregation",D.congregation),"all"!==D.isActive&&e.searchParams.set("isActive",D.isActive),e.searchParams.set("page",P.toString()),window.location.href=e.toString()}catch(e){console.error("Error preserving filter state:",e),window.location.reload()}else alert("Failed to update keyman")}catch(e){console.error("Error updating keyman:",e),alert("Failed to update keyman")}},className:"text-xs border border-gray-300 rounded px-1 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500 w-full",children:[(0,s.jsx)("option",{value:"",children:"No Keyman"}),i.filter(e=>e.isActive&&Array.isArray(e.formsOfService)&&e.formsOfService.some(e=>e.toLowerCase().includes("keyman"))).map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]})}),(0,s.jsx)("td",{className:"px-3 py-3 whitespace-nowrap",children:(0,s.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat(e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.isActive?"Active":"Inactive"})}),(0,s.jsx)("td",{className:"px-3 py-3 whitespace-nowrap text-xs font-medium",children:(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-1",children:[(0,s.jsx)("button",{onClick:()=>W(e),disabled:R,className:"text-blue-600 hover:text-blue-900 disabled:text-blue-400 text-xs",children:"Edit"}),(0,s.jsx)("button",{onClick:()=>X(e),disabled:R,className:"text-red-600 hover:text-red-900 disabled:text-red-400 text-xs",children:"Remove"})]})})]},e.id))})]})})]}),B>1&&(0,s.jsxs)("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6",children:[(0,s.jsxs)("div",{className:"flex-1 flex justify-between sm:hidden",children:[(0,s.jsx)("button",{onClick:()=>L(Math.max(1,P-1)),disabled:1===P,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:bg-gray-100 disabled:text-gray-400",children:"Previous"}),(0,s.jsx)("button",{onClick:()=>L(Math.min(B,P+1)),disabled:P===B,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:bg-gray-100 disabled:text-gray-400",children:"Next"})]}),(0,s.jsxs)("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[(0,s.jsx)("div",{children:(0,s.jsxs)("p",{className:"text-sm text-gray-700",children:["Showing ",(0,s.jsx)("span",{className:"font-medium",children:_+1})," to"," ",(0,s.jsx)("span",{className:"font-medium",children:Math.min(_+20,U.length)})," of"," ",(0,s.jsx)("span",{className:"font-medium",children:U.length})," results"]})}),(0,s.jsx)("div",{children:(0,s.jsxs)("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",children:[(0,s.jsx)("button",{onClick:()=>L(Math.max(1,P-1)),disabled:1===P,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:bg-gray-100 disabled:text-gray-400",children:"Previous"}),Array.from({length:B},(e,t)=>t+1).map(e=>(0,s.jsx)("button",{onClick:()=>L(e),className:"relative inline-flex items-center px-4 py-2 border text-sm font-medium ".concat(e===P?"z-10 bg-blue-50 border-blue-500 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"),children:e},e)),(0,s.jsx)("button",{onClick:()=>L(Math.min(B,P+1)),disabled:P===B,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:bg-gray-100 disabled:text-gray-400",children:"Next"})]})})]})]})]}),d&&(0,s.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,s.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,s.jsxs)("div",{className:"mt-3",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:h?"Edit Attendant":"Add New Attendant"}),(0,s.jsxs)("form",{onSubmit:q,children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"First Name *"}),(0,s.jsx)("input",{type:"text",required:!0,value:z.firstName,onChange:e=>J({...z,firstName:e.target.value}),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Last Name *"}),(0,s.jsx)("input",{type:"text",required:!0,value:z.lastName,onChange:e=>J({...z,lastName:e.target.value}),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Email *"}),(0,s.jsx)("input",{type:"email",required:!0,value:z.email,onChange:e=>J({...z,email:e.target.value}),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Phone"}),(0,s.jsx)("input",{type:"tel",value:z.phone,onChange:e=>J({...z,phone:e.target.value}),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Congregation"}),(0,s.jsx)("input",{type:"text",value:z.congregation,onChange:e=>J({...z,congregation:e.target.value}),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter congregation name"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Forms of Service *"}),(0,s.jsx)("div",{className:"mt-2 space-y-2",children:["Elder","Ministerial Servant","Regular Pioneer","Overseer","Keyman","Other Dept."].map(e=>(0,s.jsxs)("label",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",checked:z.formsOfService.split(", ").filter(e=>e.trim()).includes(e),onChange:t=>{let a=z.formsOfService.split(", ").filter(e=>e.trim());t.target.checked?J({...z,formsOfService:[...a,e].join(", ")}):J({...z,formsOfService:a.filter(t=>t!==e).join(", ")})},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,s.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:e})]},e))}),(0,s.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Select all applicable forms of service. Overseers manage Keymen and Attendants. Keymen manage groups of Attendants."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Notes"}),(0,s.jsx)("textarea",{value:z.notes,onChange:e=>J({...z,notes:e.target.value}),rows:3,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Additional notes or comments"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",checked:!1!==z.isActive,onChange:e=>J({...z,isActive:e.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,s.jsx)("span",{className:"ml-2 text-sm font-medium text-gray-700",children:"Active Attendant"})]}),(0,s.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Inactive attendants will not be available for new assignments"})]})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,s.jsx)("button",{type:"button",onClick:()=>m(!1),disabled:R,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 disabled:bg-gray-100",children:"Cancel"}),(0,s.jsxs)("button",{type:"submit",disabled:R,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white rounded-md",children:[R?"Saving...":h?"Update":"Add"," Attendant"]})]})]})]})})}),x&&(0,s.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,s.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,s.jsxs)("div",{className:"mt-3",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Import Attendants"}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"Upload a CSV file with attendant information."}),(0,s.jsx)("button",{onClick:()=>{let e=new Blob(['firstName,lastName,email,phone,congregation,formsOfService,notes,isActive\nJohn,Doe,john.doe@example.com,555-1234,Central Congregation,"Elder, Overseer",,true\nJane,Smith,jane.smith@example.com,555-5678,North Congregation,"Ministerial Servant, Keyman",,true\nBob,Johnson,bob.johnson@example.com,,South Congregation,"Regular Pioneer",,true'],{type:"text/csv"}),t=window.URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="attendants-import-template.csv",document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(t)},className:"text-blue-600 hover:text-blue-800 text-sm underline",children:"\uD83D\uDCE5 Download CSV Template"})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select CSV File"}),(0,s.jsx)("input",{type:"file",accept:".csv",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];a&&"text/csv"===a.type?p(a):alert("Please select a valid CSV file")},className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})]}),f&&(0,s.jsx)("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded",children:(0,s.jsxs)("p",{className:"text-sm text-green-800",children:["✅ File selected: ",f.name]})}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,s.jsx)("button",{type:"button",onClick:()=>u(!1),disabled:R,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 disabled:bg-gray-100",children:"Cancel"}),(0,s.jsx)("button",{onClick:Z,disabled:R||!f,className:"px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-green-400 text-white rounded-md",children:R?"Importing...":"Import Attendants"})]})]})})}),O&&(0,s.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,s.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,s.jsxs)("div",{className:"mt-3",children:[(0,s.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Bulk Edit ",b.size," Attendants"]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,s.jsxs)("select",{value:y.isActive,onChange:e=>N({...y,isActive:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,s.jsx)("option",{value:"",children:"No Change"}),(0,s.jsx)("option",{value:"true",children:"Active"}),(0,s.jsx)("option",{value:"false",children:"Inactive"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Congregation"}),(0,s.jsx)("input",{type:"text",value:y.congregation,onChange:e=>N({...y,congregation:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Leave empty for no change"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Forms of Service (comma-separated)"}),(0,s.jsx)("input",{type:"text",value:y.formsOfService,onChange:e=>N({...y,formsOfService:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Elder, Overseer (leave empty for no change)"})]}),(0,s.jsxs)("div",{className:"border-t pt-4",children:[(0,s.jsx)("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Leadership Assignment"}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assign Overseer"}),(0,s.jsxs)("select",{value:y.overseerId||"",onChange:e=>N({...y,overseerId:e.target.value||null}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",children:[(0,s.jsx)("option",{value:"",children:"No change"}),(0,s.jsx)("option",{value:"REMOVE",children:"Remove overseer"}),i.filter(e=>e.isActive&&Array.isArray(e.formsOfService)&&e.formsOfService.some(e=>e.toLowerCase().includes("overseer"))).map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assign Keyman"}),(0,s.jsxs)("select",{value:y.keymanId||"",onChange:e=>N({...y,keymanId:e.target.value||null}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",children:[(0,s.jsx)("option",{value:"",children:"No change"}),(0,s.jsx)("option",{value:"REMOVE",children:"Remove keyman"}),i.filter(e=>e.isActive&&Array.isArray(e.formsOfService)&&e.formsOfService.some(e=>e.toLowerCase().includes("keyman"))).map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]})]})]})]})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,s.jsx)("button",{type:"button",onClick:()=>E(!1),disabled:R,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 disabled:bg-gray-100",children:"Cancel"}),(0,s.jsx)("button",{onClick:H,disabled:R,className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-purple-400 text-white rounded-md",children:R?"Updating...":"Update Attendants"})]})]})})})]})})}}},function(e){e.O(0,[424,888,774,179],function(){return e(e.s=9781)}),_N_E=e.O()}]);