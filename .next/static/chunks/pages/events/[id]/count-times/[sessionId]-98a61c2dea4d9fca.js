(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[495],{5473:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/events/[id]/count-times/[sessionId]",function(){return s(8130)}])},5083:function(e,t,s){"use strict";s.d(t,{Z:function(){return c}});var n=s(5893),l=s(3299),a=s(1664),i=s.n(a),r=s(1163);function c(e){var t;let{children:s,title:a="JW Attendant Scheduler",breadcrumbs:c=[],selectedEvent:o}=e,{data:d}=(0,l.useSession)(),x=(0,r.useRouter)(),u=[{label:"Events",href:"/events",icon:"\uD83D\uDCC5",roles:["ADMIN","OVERSEER","ATTENDANT"]},{label:"Event Selection",href:"/events/select",icon:"\uD83C\uDFAF",roles:["ADMIN","OVERSEER","ATTENDANT"]}];(null==d?void 0:null===(t=d.user)||void 0===t?void 0:t.role)==="ADMIN"&&u.push({label:"Admin Portal",href:"/admin",icon:"\uD83D\uDEE1️",roles:["ADMIN"]});let m=u.filter(e=>{var t;return e.roles.includes((null==d?void 0:null===(t=d.user)||void 0===t?void 0:t.role)||"")});return(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,n.jsx)("nav",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,n.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,n.jsxs)("div",{className:"flex justify-between h-16",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsxs)(i(),{href:"/events/select",className:"flex items-center",children:[(0,n.jsx)("span",{className:"text-2xl font-bold text-blue-600",children:"\uD83D\uDCCB"}),(0,n.jsx)("span",{className:"ml-2 text-xl font-semibold text-gray-900",children:"JW Attendant Scheduler"})]}),(0,n.jsx)("div",{className:"hidden md:ml-8 md:flex md:space-x-4",children:m.map(e=>(0,n.jsxs)(i(),{href:e.href,className:"px-3 py-2 rounded-md text-sm font-medium transition-colors ".concat(x.pathname.startsWith(e.href)?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"),children:[(0,n.jsx)("span",{className:"mr-2",children:e.icon}),e.label]},e.href))})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[o&&(0,n.jsxs)("div",{className:"hidden md:flex items-center bg-blue-50 px-3 py-1 rounded-lg",children:[(0,n.jsxs)("span",{className:"text-sm text-blue-600 font-medium",children:["\uD83D\uDCC5 ",o.name]}),o.status&&(0,n.jsx)("span",{className:"ml-2 px-2 py-0.5 text-xs rounded-full ".concat("current"===o.status?"bg-green-100 text-green-800":"upcoming"===o.status?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"),children:o.status})]}),(null==d?void 0:d.user)&&(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)("span",{className:"text-sm text-gray-700",children:d.user.name}),(0,n.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat("ADMIN"===d.user.role?"bg-red-100 text-red-800":"OVERSEER"===d.user.role?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"),children:d.user.role}),(0,n.jsx)("button",{onClick:()=>{(0,l.signOut)({callbackUrl:"/auth/signin"})},className:"text-sm text-gray-600 hover:text-gray-900 transition-colors",children:"Sign Out"})]})]})]})})}),c.length>0&&(0,n.jsx)("div",{className:"bg-white border-b border-gray-200",children:(0,n.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3",children:(0,n.jsx)("nav",{className:"flex","aria-label":"Breadcrumb",children:(0,n.jsx)("ol",{className:"flex items-center space-x-2",children:c.map((e,t)=>(0,n.jsxs)("li",{className:"flex items-center",children:[t>0&&(0,n.jsx)("svg",{className:"w-4 h-4 text-gray-400 mx-2",fill:"currentColor",viewBox:"0 0 20 20",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})}),e.href?(0,n.jsx)(i(),{href:e.href,className:"text-sm text-blue-600 hover:text-blue-800",children:e.label}):(0,n.jsx)("span",{className:"text-sm text-gray-500",children:e.label})]},t))})})})}),(0,n.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[a&&(0,n.jsx)("div",{className:"mb-8",children:(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:a})}),s]})]})}},8130:function(e,t,s){"use strict";s.r(t),s.d(t,{__N_SSP:function(){return o},default:function(){return d}});var n=s(5893),l=s(5083),a=s(7294),i=s(1163),r=s(1664),c=s.n(r),o=!0;function d(){let{id:e,sessionId:t}=(0,i.useRouter)().query,[s,r]=(0,a.useState)(null),[o,d]=(0,a.useState)(null),[x,u]=(0,a.useState)(!0),[m,h]=(0,a.useState)("");(0,a.useEffect)(()=>{e&&t&&p()},[e,t]);let p=async()=>{try{u(!0);let[s,n]=await Promise.all([fetch("/api/events/".concat(e)),fetch("/api/events/".concat(e,"/count-sessions/").concat(t))]),[l,a]=await Promise.all([s.json(),n.json()]);l.success&&r(l.data),a.success&&d(a.data),l.success&&a.success||h("Failed to load data")}catch(e){h("Error loading data"),console.error("Error:",e)}finally{u(!1)}};if(x)return(0,n.jsx)(l.Z,{title:"Count Session Details",breadcrumbs:[{label:"Events",href:"/events"},{label:(null==s?void 0:s.name)||"Loading...",href:"/events/".concat(e)},{label:"Count Times",href:"/events/".concat(e,"/count-times")},{label:"Details"}],children:(0,n.jsxs)("div",{className:"flex items-center justify-center h-64",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,n.jsx)("p",{className:"ml-3 text-gray-600",children:"Loading..."})]})});if(m||!s||!o)return(0,n.jsx)(l.Z,{title:"Error",children:(0,n.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-8 text-center",children:[(0,n.jsx)("p",{className:"text-red-700",children:m||"Failed to load count session"}),(0,n.jsx)(c(),{href:"/events/".concat(e,"/count-times"),className:"mt-4 inline-block bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition-colors",children:"← Back to Count Times"})]})});let b=(()=>{if(!o)return{total:0,counted:0,pending:0};let e=o.position_counts.filter(e=>null!==e.attendeeCount).length,t=o.position_counts.length;return{total:t,counted:e,pending:t-e}})(),N=o?o.position_counts.reduce((e,t)=>e+(t.attendeeCount||0),0):0,j=(()=>{if(!o)return{};let e={};return o.position_counts.forEach(t=>{let s=t.event_positions.department||"Unassigned";e[s]||(e[s]=[]),e[s].push(t)}),e})();return(0,n.jsx)(l.Z,{title:"Count Session Details",breadcrumbs:[{label:"Events",href:"/events"},{label:s.name,href:"/events/".concat(e)},{label:"Count Times",href:"/events/".concat(e,"/count-times")},{label:o.sessionName}],selectedEvent:{id:s.id,name:s.name},children:(0,n.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,n.jsx)("div",{className:"mb-6",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:o.sessionName}),(0,n.jsxs)("p",{className:"text-gray-600",children:["Count Time: ",new Date(o.countTime).toLocaleString()]}),o.notes&&(0,n.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:o.notes})]}),(0,n.jsxs)("div",{className:"flex space-x-3",children:[(0,n.jsx)(c(),{href:"/events/".concat(e,"/count-times"),className:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded transition-colors",children:"← Back to Count Times"}),(0,n.jsx)(c(),{href:"/events/".concat(e,"/count-times/").concat(t,"/enter-count"),className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition-colors",children:"\uD83D\uDCDD Enter Counts"})]})]})}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[(0,n.jsx)("div",{className:"bg-white shadow rounded-lg p-6",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"Total Attendees"}),(0,n.jsx)("p",{className:"text-3xl font-bold text-blue-600",children:N})]}),(0,n.jsx)("div",{className:"text-4xl",children:"\uD83D\uDC65"})]})}),(0,n.jsx)("div",{className:"bg-white shadow rounded-lg p-6",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"Positions Counted"}),(0,n.jsx)("p",{className:"text-3xl font-bold text-green-600",children:b.counted})]}),(0,n.jsx)("div",{className:"text-4xl",children:"✅"})]})}),(0,n.jsx)("div",{className:"bg-white shadow rounded-lg p-6",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"Pending Counts"}),(0,n.jsx)("p",{className:"text-3xl font-bold text-yellow-600",children:b.pending})]}),(0,n.jsx)("div",{className:"text-4xl",children:"⏳"})]})}),(0,n.jsx)("div",{className:"bg-white shadow rounded-lg p-6",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"Completion"}),(0,n.jsxs)("p",{className:"text-3xl font-bold text-purple-600",children:[b.total>0?Math.round(b.counted/b.total*100):0,"%"]})]}),(0,n.jsx)("div",{className:"text-4xl",children:"\uD83D\uDCCA"})]})})]}),(0,n.jsx)("div",{className:"space-y-6",children:Object.entries(j).map(e=>{let[t,s]=e,l=s.reduce((e,t)=>e+(t.attendeeCount||0),0),a=s.filter(e=>null!==e.attendeeCount).length;return(0,n.jsxs)("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[(0,n.jsx)("div",{className:"px-6 py-4 bg-gray-50 border-b border-gray-200",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:t}),(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsxs)("span",{className:"text-sm text-gray-600",children:[a,"/",s.length," positions counted"]}),(0,n.jsxs)("span",{className:"text-lg font-bold text-blue-600",children:[l," attendees"]})]})]})}),(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,n.jsx)("thead",{className:"bg-gray-50",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Position"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Count"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Notes"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Counted At"})]})}),(0,n.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:s.sort((e,t)=>e.event_positions.positionNumber-t.event_positions.positionNumber).map(e=>(0,n.jsxs)("tr",{className:null===e.attendeeCount?"bg-yellow-50":"",children:[(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.event_positions.positionName}),(0,n.jsxs)("div",{className:"text-sm text-gray-500",children:["Position #",e.event_positions.positionNumber]})]})}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:null!==e.attendeeCount?(0,n.jsx)("span",{className:"text-2xl font-bold text-blue-600",children:e.attendeeCount}):(0,n.jsx)("span",{className:"text-sm text-yellow-600 font-medium",children:"Not counted"})}),(0,n.jsx)("td",{className:"px-6 py-4",children:(0,n.jsx)("div",{className:"text-sm text-gray-900 max-w-xs truncate",children:e.notes||"-"})}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:null!==e.attendeeCount?new Date(e.countedAt).toLocaleString():"-"})]},e.id))})]})})]},t)})}),(0,n.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,n.jsx)("button",{onClick:()=>window.print(),className:"bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded transition-colors",children:"\uD83D\uDDA8️ Print Report"}),(0,n.jsx)("button",{onClick:()=>{!function(e,t){let s=new Blob([e],{type:"text/csv"}),n=window.URL.createObjectURL(s),l=document.createElement("a");l.href=n,l.download=t,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(n)}(o?[["Position Number","Position Name","Department","Attendee Count","Notes","Counted At"],...o.position_counts.sort((e,t)=>e.event_positions.positionNumber-t.event_positions.positionNumber).map(e=>{var t;return[e.event_positions.positionNumber,e.event_positions.positionName,e.event_positions.department,null!==(t=e.attendeeCount)&&void 0!==t?t:"Not counted",e.notes||"",null!==e.attendeeCount?new Date(e.countedAt).toLocaleString():""]})].map(e=>e.map(e=>'"'.concat(e,'"')).join(",")).join("\n"):"","count-session-".concat(o.sessionName,".csv"))},className:"bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded transition-colors",children:"\uD83D\uDCE5 Export CSV"})]})]})})}}},function(e){e.O(0,[424,888,774,179],function(){return e(e.s=5473)}),_N_E=e.O()}]);