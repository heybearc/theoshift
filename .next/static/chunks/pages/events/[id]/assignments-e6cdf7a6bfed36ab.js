(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[980],{440:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/events/[id]/assignments",function(){return t(6677)}])},6677:function(e,s,t){"use strict";t.r(s),t.d(s,{__N_SSP:function(){return m},default:function(){return x}});var n=t(5893),a=t(7294),i=t(1163),l=t(3299),r=t(9008),d=t.n(r),c=t(1664),o=t.n(c),m=!0;function x(e){let{eventId:s,event:t,assignments:r,attendants:c,positions:m,stats:x}=e,h=(0,i.useRouter)(),{data:u}=(0,l.useSession)(),[g,p]=(0,a.useState)(!1),[f,j]=(0,a.useState)(!1),[N,v]=(0,a.useState)(null),[b,y]=(0,a.useState)({userId:"",positionId:"",shiftStart:"",shiftEnd:"",notes:""}),w=async e=>{if(e.preventDefault(),!b.userId||!b.positionId||!b.shiftStart||!b.shiftEnd){alert("Please fill in all required fields");return}let t=new Date(b.shiftStart);if(new Date(b.shiftEnd)<=t){alert("End time must be after start time");return}try{let e=N?"/api/event-assignments/".concat(s,"/").concat(N.id):"/api/event-assignments/".concat(s),t=await fetch(e,{method:N?"PUT":"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({userId:b.userId,positionId:b.positionId,shiftStart:new Date(b.shiftStart).toISOString(),shiftEnd:new Date(b.shiftEnd).toISOString(),notes:b.notes||"",eventId:s})});if(t.ok)alert(N?"Assignment updated successfully":"Assignment created successfully"),k(),h.reload();else{let e=await t.json();console.error("Assignment creation error:",e),alert("Failed to save assignment: ".concat(e.error||"Unknown error"))}}catch(e){console.error("Error saving assignment:",e),alert("Failed to save assignment")}},E=e=>{v(e),y({userId:e.userId,positionId:e.positionId,shiftStart:e.shiftStart.slice(0,16),shiftEnd:e.shiftEnd.slice(0,16),notes:e.notes||""}),j(!0)},S=async e=>{if(confirm("Are you sure you want to delete this assignment?"))try{let t=await fetch("/api/event-assignments/".concat(s,"/").concat(e),{method:"DELETE"});if(t.ok)alert("Assignment deleted successfully"),h.reload();else{let e=await t.json();alert(e.error||"Failed to delete assignment")}}catch(e){console.error("Error deleting assignment:",e),alert("Failed to delete assignment")}},C=async(e,t)=>{try{let n=await fetch("/api/event-assignments/".concat(s,"/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:t})});if(n.ok)alert("Assignment status updated"),h.reload();else{let e=await n.json();alert(e.error||"Failed to update status")}}catch(e){console.error("Error updating status:",e),alert("Failed to update status")}},k=()=>{j(!1),v(null),y({userId:"",positionId:"",shiftStart:"",shiftEnd:"",notes:""})},A=e=>new Date(e).toLocaleString(),I=e=>{switch(e){case"ASSIGNED":return"bg-blue-100 text-blue-800";case"CONFIRMED":return"bg-green-100 text-green-800";case"COMPLETED":default:return"bg-gray-100 text-gray-800";case"CANCELLED":return"bg-red-100 text-red-800"}};return g?(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,n.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading assignments..."})]})}):u?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(d(),{children:(0,n.jsxs)("title",{children:[(null==t?void 0:t.name)?"".concat(t.name," - Assignments"):"Event Assignments"," | JW Attendant Scheduler"]})}),(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,n.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsxs)("nav",{className:"flex items-center space-x-2 text-sm text-gray-500 mb-4",children:[(0,n.jsx)(o(),{href:"/events",className:"hover:text-gray-700",children:"Events"}),(0,n.jsx)("span",{children:"›"}),(0,n.jsx)(o(),{href:"/events/".concat(s),className:"hover:text-gray-700",children:(null==t?void 0:t.name)||"Event"}),(0,n.jsx)("span",{children:"›"}),(0,n.jsx)("span",{className:"text-gray-900",children:"Assignments"})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Event Assignments"}),(0,n.jsxs)("p",{className:"text-gray-600 mt-2",children:["Manage assignments for ",null==t?void 0:t.name]})]}),(0,n.jsxs)("div",{className:"flex space-x-3",children:[(0,n.jsx)(o(),{href:"/events/".concat(s),className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium transition-colors",children:"← Back to Event"}),(0,n.jsx)("button",{onClick:()=>j(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"+ Create Assignment"})]})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,n.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,n.jsx)("span",{className:"text-blue-600 font-semibold",children:"\uD83D\uDCCB"})})}),(0,n.jsxs)("div",{className:"ml-4",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Assignments"}),(0,n.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:r.length})]})]})}),(0,n.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)("div",{className:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center",children:(0,n.jsx)("span",{className:"text-green-600 font-semibold",children:"✓"})})}),(0,n.jsxs)("div",{className:"ml-4",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Confirmed"}),(0,n.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:r.filter(e=>"CONFIRMED"===e.status).length})]})]})}),(0,n.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)("div",{className:"w-8 h-8 bg-yellow-100 rounded-lg flex items-center justify-center",children:(0,n.jsx)("span",{className:"text-yellow-600 font-semibold",children:"⏳"})})}),(0,n.jsxs)("div",{className:"ml-4",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Pending"}),(0,n.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:r.filter(e=>"ASSIGNED"===e.status).length})]})]})}),(0,n.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:(0,n.jsx)("span",{className:"text-purple-600 font-semibold",children:"✅"})})}),(0,n.jsxs)("div",{className:"ml-4",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Completed"}),(0,n.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:r.filter(e=>"COMPLETED"===e.status).length})]})]})})]}),(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,n.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Assignments List"})}),(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,n.jsx)("thead",{className:"bg-gray-50",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Attendant"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Position"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Shift Time"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,n.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:0===r.length?(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:5,className:"px-6 py-12 text-center text-gray-500",children:(0,n.jsxs)("div",{className:"flex flex-col items-center",children:[(0,n.jsx)("span",{className:"text-4xl mb-2",children:"\uD83D\uDCCB"}),(0,n.jsx)("p",{className:"text-lg font-medium",children:"No assignments created"}),(0,n.jsx)("p",{className:"text-sm",children:'Click "Create Assignment" to get started'})]})})}):r.map(e=>(0,n.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"flex-shrink-0 h-10 w-10",children:(0,n.jsx)("div",{className:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center",children:(0,n.jsxs)("span",{className:"text-blue-600 font-medium",children:[e.users.firstName[0],e.users.lastName[0]]})})}),(0,n.jsxs)("div",{className:"ml-4",children:[(0,n.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:[e.users.firstName," ",e.users.lastName]}),(0,n.jsx)("div",{className:"text-sm text-gray-500",children:e.users.email})]})]})}),(0,n.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,n.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.event_positions.positionName}),(0,n.jsxs)("div",{className:"text-sm text-gray-500",children:[e.event_positions.department," • #",e.event_positions.positionNumber]})]}),(0,n.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[(0,n.jsx)("div",{children:A(e.shiftStart)}),(0,n.jsxs)("div",{children:["to ",A(e.shiftEnd)]})]}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,n.jsxs)("select",{value:e.status,onChange:s=>C(e.id,s.target.value),className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full border-0 ".concat(I(e.status)),children:[(0,n.jsx)("option",{value:"ASSIGNED",children:"Assigned"}),(0,n.jsx)("option",{value:"CONFIRMED",children:"Confirmed"}),(0,n.jsx)("option",{value:"COMPLETED",children:"Completed"}),(0,n.jsx)("option",{value:"CANCELLED",children:"Cancelled"})]})}),(0,n.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2",children:[(0,n.jsx)("button",{onClick:()=>E(e),className:"text-blue-600 hover:text-blue-900 transition-colors",children:"Edit"}),(0,n.jsx)("button",{onClick:()=>S(e.id),className:"text-red-600 hover:text-red-900 transition-colors",children:"Delete"})]})]},e.id))})]})})]})]}),f&&(0,n.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,n.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:(0,n.jsxs)("form",{onSubmit:w,children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:N?"Edit Assignment":"Create New Assignment"}),(0,n.jsxs)("button",{type:"button",onClick:k,className:"text-gray-400 hover:text-gray-600",children:[(0,n.jsx)("span",{className:"sr-only",children:"Close"}),(0,n.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"userId",className:"block text-sm font-medium text-gray-700 mb-1",children:"Attendant *"}),(0,n.jsxs)("select",{id:"userId",value:b.userId,onChange:e=>y({...b,userId:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,n.jsx)("option",{value:"",children:"Select an attendant"}),c&&c.length>0?c.map(e=>(0,n.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id)):(0,n.jsx)("option",{value:"",disabled:!0,children:"No attendants available"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"positionId",className:"block text-sm font-medium text-gray-700 mb-1",children:"Position *"}),(0,n.jsxs)("select",{id:"positionId",value:b.positionId,onChange:e=>y({...b,positionId:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,n.jsx)("option",{value:"",children:"Select a position"}),m&&m.length>0?m.map(e=>(0,n.jsxs)("option",{value:e.id,children:[e.positionName," (",e.department||"No Area",")"]},e.id)):(0,n.jsx)("option",{value:"",disabled:!0,children:"No positions available"})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"shiftStart",className:"block text-sm font-medium text-gray-700 mb-1",children:"Shift Start *"}),(0,n.jsx)("input",{type:"datetime-local",id:"shiftStart",value:b.shiftStart,onChange:e=>y({...b,shiftStart:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"shiftEnd",className:"block text-sm font-medium text-gray-700 mb-1",children:"Shift End *"}),(0,n.jsx)("input",{type:"datetime-local",id:"shiftEnd",value:b.shiftEnd,onChange:e=>y({...b,shiftEnd:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),(0,n.jsx)("textarea",{id:"notes",value:b.notes,onChange:e=>y({...b,notes:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Any additional notes or instructions..."})]})]}),(0,n.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,n.jsx)("button",{type:"button",onClick:k,className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium transition-colors",children:"Cancel"}),(0,n.jsx)("button",{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:N?"Update Assignment":"Create Assignment"})]})]})})})]})]}):null}},9008:function(e,s,t){e.exports=t(3867)}},function(e){e.O(0,[424,888,774,179],function(){return e(e.s=440)}),_N_E=e.O()}]);