generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id                String  @id
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  users             users   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id
  sessionToken String   @unique
  userId       String
  expires      DateTime
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model user_activity {
  id             String   @id @default(uuid())
  userId         String
  sessionId      String   @unique
  loginAt        DateTime @default(now())
  lastActivityAt DateTime @default(now())
  logoutAt       DateTime?
  ipAddress      String?
  userAgent      String?
  isActive       Boolean  @default(true)
  users          users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isActive])
  @@index([lastActivityAt])
}

model announcements {
  id        String    @id
  eventId   String
  title     String
  message   String
  type      String?   @default("INFO")
  isActive  Boolean?  @default(true)
  startDate DateTime? @db.Timestamp(6)
  endDate   DateTime? @db.Timestamp(6)
  createdBy String
  createdAt DateTime? @default(now()) @db.Timestamp(6)
  updatedAt DateTime? @default(now()) @db.Timestamp(6)
  users     users     @relation(fields: [createdBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
  events    events    @relation(fields: [eventId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([endDate], map: "announcements_enddate_idx")
  @@index([eventId], map: "announcements_eventid_idx")
  @@index([isActive], map: "announcements_isactive_idx")
  @@index([startDate], map: "announcements_startdate_idx")
}

model assignments {
  id              String           @id
  eventId         String
  userId          String
  positionId      String
  shiftId         String?
  shiftStart      DateTime
  shiftEnd        DateTime
  status          AssignmentStatus @default(ASSIGNED)
  notes           String?
  assignedBy      String?
  assignedAt      DateTime         @default(now())
  createdAt       DateTime         @default(now())
  updatedAt       DateTime
  events          events           @relation(fields: [eventId], references: [id], onDelete: Cascade)
  event_positions event_positions  @relation(fields: [positionId], references: [id], onDelete: Cascade)
  users           users            @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model attendants {
  id                                                                                    String                           @id
  userId                                                                                String?                          @unique
  firstName                                                                             String
  lastName                                                                              String
  email                                                                                 String
  phone                                                                                 String?
  availabilityStatus                                                                    String?                          @default("AVAILABLE")
  isAvailable                                                                           Boolean                          @default(true)
  notes                                                                                 String?
  servingAs                                                                             Json?                            @default("[]")
  skills                                                                                Json?
  preferredDepartments                                                                  Json?
  unavailableDates                                                                      Json?
  totalAssignments                                                                      Int                              @default(0)
  totalHours                                                                            Float                            @default(0)
  createdAt                                                                             DateTime                         @default(now())
  updatedAt                                                                             DateTime
  congregation                                                                          String
  formsOfService                                                                        Json                             @default("[]")
  isActive                                                                              Boolean                          @default(true)
  pinHash                                                                               String?
  profileVerificationRequired                                                           Boolean                          @default(false)
  profileVerifiedAt                                                                     DateTime?
  users                                                                                 users?                           @relation(fields: [userId], references: [id], onDelete: Cascade)
  document_publications                                                                 document_publications[]
  event_attendants                                                                       event_attendants[]               @relation("event_attendants_attendantIdToattendants")
  event_attendants_event_attendants_keymanIdToattendants                                event_attendants[]               @relation("event_attendants_keymanIdToattendants")
  event_attendants_event_attendants_overseerIdToattendants                              event_attendants[]               @relation("event_attendants_overseerIdToattendants")
  position_assignments_position_assignments_attendantIdToattendants                     position_assignments[]           @relation("position_assignments_attendantIdToattendants")
  position_assignments_position_assignments_keymanIdToattendants                        position_assignments[]           @relation("position_assignments_keymanIdToattendants")
  position_assignments_position_assignments_overseerIdToattendants                      position_assignments[]           @relation("position_assignments_overseerIdToattendants")
  position_oversight_assignments_position_oversight_assignments_keyman_idToattendants   position_oversight_assignments[] @relation("position_oversight_assignments_keyman_idToattendants")
  position_oversight_assignments_position_oversight_assignments_overseer_idToattendants position_oversight_assignments[] @relation("position_oversight_assignments_overseer_idToattendants")
}

model count_sessions {
  id              String             @id
  eventId         String
  sessionName     String
  countTime       DateTime
  notes           String?
  isActive        Boolean            @default(true)
  status          CountSessionStatus @default(ACTIVE)
  createdAt       DateTime           @default(now())
  updatedAt       DateTime
  createdBy       String?
  uploadedAt      DateTime           @default(now())
  uploadedBy      String?
  events          events             @relation(fields: [eventId], references: [id])
  position_counts position_counts[]

  @@unique([eventId, sessionName])
}

model document_publications {
  id              String          @id
  documentId      String
  attendantId     String
  publishedAt     DateTime        @default(now())
  viewedAt        DateTime?
  downloadedAt    DateTime?
  attendants      attendants      @relation(fields: [attendantId], references: [id], onDelete: Cascade)
  event_documents event_documents @relation(fields: [documentId], references: [id], onDelete: Cascade)

  @@unique([documentId, attendantId])
  @@index([attendantId], map: "idx_document_publications_attendant")
  @@index([documentId], map: "idx_document_publications_document")
}

model email_configurations {
  id                 String   @id
  smtpServer         String
  smtpPort           Int
  smtpUser           String
  smtpPassword       String
  fromEmail          String
  fromName           String
  replyToEmail       String?
  inviteTemplate     String?
  assignmentTemplate String?
  reminderTemplate   String?
  isActive           Boolean  @default(true)
  createdAt          DateTime @default(now())
  updatedAt          DateTime
}

model event_attendants {
  id                                                  String      @id
  eventId                                             String
  userId                                              String?
  role                                                UserRole    @default(ATTENDANT)
  isActive                                            Boolean     @default(true)
  assignedDepartments                                 Json?
  assignedStationRanges                               Json?
  createdAt                                           DateTime    @default(now())
  updatedAt                                           DateTime
  attendantId                                         String?
  keymanId                                            String?
  overseerId                                          String?
  attendant                                           attendants? @relation("event_attendants_attendantIdToattendants", fields: [attendantId], references: [id], onDelete: Cascade)
  events                                              events      @relation(fields: [eventId], references: [id], onDelete: Cascade)
  keyman                                              attendants? @relation("event_attendants_keymanIdToattendants", fields: [keymanId], references: [id])
  overseer                                            attendants? @relation("event_attendants_overseerIdToattendants", fields: [overseerId], references: [id])
  users                                               users?      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([eventId, attendantId])
  @@unique([eventId, userId])
}

model event_documents {
  id                    String                  @id
  eventId               String
  title                 String
  description           String?
  fileName              String
  fileUrl               String
  fileType              String
  fileSize              Int
  uploadedBy            String
  uploadedAt            DateTime                @default(now())
  publishedTo           String                  @default("none")
  publishedCount        Int                     @default(0)
  publishedAt           DateTime?
  isActive              Boolean                 @default(true)
  createdAt             DateTime                @default(now())
  updatedAt             DateTime
  document_publications document_publications[]
  events                events                  @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@index([eventId], map: "idx_event_documents_event")
  @@index([uploadedBy], map: "idx_event_documents_uploader")
}

model event_permissions {
  id        String              @id
  userId    String
  eventId   String
  role      EventPermissionRole @default(VIEWER)
  scopeType EventScopeType?
  scopeIds  Json?
  createdAt DateTime            @default(now())
  updatedAt DateTime
  events    events              @relation(fields: [eventId], references: [id], onDelete: Cascade)
  users     users               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, eventId])
  @@index([eventId])
  @@index([eventId, role])
  @@index([userId])
}

model event_positions {
  id                   String        @id
  eventId              String
  positionNumber       Int
  positionName         String
  description          String?
  department           String?
  isActive             Boolean       @default(true)
  isAllDay             Boolean       @default(false)
  isLeadershipPosition Boolean       @default(false)
  requiresExperience   Boolean       @default(false)
  maxAttendants        Int           @default(1)
  minAttendants        Int           @default(1)
  tags                 Json?
  instructions         String?
  createdAt            DateTime      @default(now())
  updatedAt            DateTime
  assignments          assignments[]
  events               events        @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@unique([eventId, positionNumber])
}

model events {
  id                             String                           @id
  name                           String
  description                    String?
  status                         EventStatus                      @default(UPCOMING)
  startDate                      DateTime                         @db.Date
  endDate                        DateTime                         @db.Date
  location                       String?
  venue                          String?
  isActive                       Boolean                          @default(true)
  settings                       Json?
  createdAt                      DateTime                         @default(now())
  updatedAt                      DateTime
  createdBy                      String?
  startTime                      String?
  endTime                        String?
  eventType                      EventType                        @default(CIRCUIT_ASSEMBLY)
  attendantsNeeded               Int?
  capacity                       Int?
  assemblyoverseeremail          String?
  assemblyoverseername           String?
  assemblyoverseerphone          String?
  attendantoverseerassistants    Json?                            @default("[]")
  attendantoverseeremail         String?
  attendantoverseername          String?
  attendantoverseerphone         String?
  circuitoverseeremail           String?
  circuitoverseername            String?
  circuitoverseerphone           String?
  announcements                  announcements[]
  assignments                    assignments[]
  count_sessions                 count_sessions[]
  event_attendants               event_attendants[]
  event_documents                event_documents[]
  event_permissions              event_permissions[]
  event_positions                event_positions[]
  lanyard_settings               lanyard_settings?
  oversight_assignments          oversight_assignments[]
  position_oversight_assignments position_oversight_assignments[]
  positions                      positions[]
}

model feedback {
  id                   String                 @id
  type                 FeedbackType
  title                String
  description          String
  priority             FeedbackPriority       @default(MEDIUM)
  status               FeedbackStatus         @default(NEW)
  submittedBy          String
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  users                users                  @relation(fields: [submittedBy], references: [id], onDelete: Cascade)
  feedback_attachments feedback_attachments[]
  feedback_comments    feedback_comments[]
}

model feedback_attachments {
  id         String   @id
  feedbackId String
  filename   String
  filePath   String
  fileSize   Int
  mimeType   String
  createdAt  DateTime @default(now())
  feedback   feedback @relation(fields: [feedbackId], references: [id], onDelete: Cascade)
}

model feedback_comments {
  id         String   @id
  feedbackId String
  authorId   String
  content    String
  createdAt  DateTime @default(now())
  users      users    @relation(fields: [authorId], references: [id], onDelete: Cascade)
  feedback   feedback @relation(fields: [feedbackId], references: [id], onDelete: Cascade)
}

model lanyard_settings {
  id                String     @id
  eventId           String     @unique
  totalLanyards     Int
  availableLanyards Int
  isActive          Boolean    @default(true)
  createdAt         DateTime   @default(now())
  updatedAt         DateTime
  events            events     @relation(fields: [eventId], references: [id], onDelete: Cascade)
  lanyards          lanyards[]
}

model lanyards {
  id               String           @id
  lanyardSettingId String
  badgeNumber      String
  isCheckedOut     Boolean          @default(false)
  checkedOutTo     String?
  checkedOutAt     DateTime?
  checkedInAt      DateTime?
  status           LanyardStatus    @default(AVAILABLE)
  notes            String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime
  lanyard_settings lanyard_settings @relation(fields: [lanyardSettingId], references: [id], onDelete: Cascade)

  @@unique([lanyardSettingId, badgeNumber])
}

model oversight_assignments {
  id             String          @id
  eventId        String
  userId         String
  departmentId   String?
  stationRangeId String?
  oversightLevel OversightLevel
  isActive       Boolean         @default(true)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime
  events         events          @relation(fields: [eventId], references: [id], onDelete: Cascade)
  station_ranges station_ranges? @relation(fields: [stationRangeId], references: [id])
  users          users           @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model position_assignments {
  id                                                      String           @id
  positionId                                              String
  shiftId                                                 String?
  attendantId                                             String
  role                                                    PositionRole
  overseerId                                              String?
  keymanId                                                String?
  assignedAt                                              DateTime         @default(now())
  assignedBy                                              String?
  users      users?           @relation(fields: [assignedBy], references: [id])
  attendant  attendants       @relation("position_assignments_attendantIdToattendants", fields: [attendantId], references: [id], onDelete: Cascade)
  keyman     attendants?      @relation("position_assignments_keymanIdToattendants", fields: [keymanId], references: [id])
  overseer   attendants?      @relation("position_assignments_overseerIdToattendants", fields: [overseerId], references: [id])
  positions  positions        @relation("PositionToAssignments", fields: [positionId], references: [id], onDelete: Cascade)
  shift      position_shifts? @relation("ShiftToAssignments", fields: [shiftId], references: [id], onDelete: Cascade)

  @@unique([positionId, shiftId, attendantId])
  @@index([attendantId])
  @@index([overseerId, keymanId])
  @@index([positionId, shiftId])
  @@index([role])
}

model position_counts {
  id             String         @id
  countSessionId String
  positionId     String
  attendeeCount  Int?
  notes          String?
  countedBy      String?
  countedAt      DateTime       @default(now())
  createdAt      DateTime       @default(now())
  updatedAt      DateTime
  count_sessions count_sessions @relation(fields: [countSessionId], references: [id], onDelete: Cascade)
  position       positions      @relation("PositionToCounts", fields: [positionId], references: [id], onDelete: Cascade)

  @@unique([countSessionId, positionId])
}

model position_oversight_assignments {
  id                                                                String      @id @default(dbgenerated("(gen_random_uuid())::text"))
  positionId                                                        String      @map("position_id")
  eventId                                                           String      @map("event_id")
  overseerId                                                        String?     @map("overseer_id")
  keymanId                                                          String?     @map("keyman_id")
  assignedBy                                                        String?     @map("assigned_by")
  createdAt                                                         DateTime?   @default(now()) @db.Timestamp(6) @map("created_at")
  updatedAt                                                         DateTime?   @default(now()) @db.Timestamp(6) @map("updated_at")
  users                                                             users?      @relation(fields: [assignedBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
  events                                                            events      @relation(fields: [eventId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  keyman                                                            attendants? @relation("position_oversight_assignments_keyman_idToattendants", fields: [keymanId], references: [id], onUpdate: NoAction)
  overseer                                                          attendants? @relation("position_oversight_assignments_overseer_idToattendants", fields: [overseerId], references: [id], onUpdate: NoAction)
  positions                                                         positions   @relation("PositionToOversight", fields: [positionId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([positionId, eventId])
  @@index([eventId], map: "idx_position_oversight_event")
  @@index([keymanId], map: "idx_position_oversight_keyman")
  @@index([overseerId], map: "idx_position_oversight_overseer")
  @@index([positionId], map: "idx_position_oversight_position")
}

model position_shifts {
  id                   String                 @id
  positionId           String
  isAllDay             Boolean                @default(false)
  createdAt            DateTime               @default(now())
  endTime              String?
  name                 String
  sequence             Int
  startTime            String?
  position_assignments position_assignments[] @relation("ShiftToAssignments")
  positions            positions              @relation("PositionToShifts", fields: [positionId], references: [id], onDelete: Cascade)

  @@index([positionId])
  @@index([positionId, sequence])
}

model positions {
  id                             String                           @id
  eventId                        String
  positionNumber                 Int
  name                           String
  description                    String?
  area                           String?
  sequence                       Int
  isActive                       Boolean                          @default(true)
  createdAt                      DateTime                         @default(now())
  updatedAt                      DateTime
  assignments                    position_assignments[]           @relation("PositionToAssignments")
  counts                         position_counts[]                @relation("PositionToCounts")
  oversight                      position_oversight_assignments[] @relation("PositionToOversight")
  shifts                         position_shifts[]                @relation("PositionToShifts")
  events                         events                           @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@unique([eventId, positionNumber])
  @@index([eventId, isActive])
  @@index([eventId, sequence])
}

model shift_templates {
  id               String   @id
  name             String
  description      String?
  shifts           Json
  isSystemTemplate Boolean  @default(false)
  createdBy        String?
  createdAt        DateTime @default(now())
  users            users?   @relation(fields: [createdBy], references: [id])

  @@index([isSystemTemplate])
}

model station_ranges {
  id                    String                  @id
  departmentId          String
  name                  String
  startStation          Int
  endStation            Int
  description           String?
  isActive              Boolean                 @default(true)
  createdAt             DateTime                @default(now())
  updatedAt             DateTime
  oversight_assignments oversight_assignments[]
}

model system_settings {
  id        String   @id
  key       String   @unique
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime
  createdBy String?
  updatedBy String?
}

model users {
  id                             String                           @id
  email                          String                           @unique
  firstName                      String
  lastName                       String
  phone                          String?
  isActive                       Boolean                          @default(true)
  role                           UserRole                         @default(ATTENDANT)
  passwordHash                   String?
  inviteToken                    String?                          @unique
  inviteExpiry                   DateTime?
  lastLogin                      DateTime?
  lastSeenReleaseVersion         String?
  createdAt                      DateTime                         @default(now())
  updatedAt                      DateTime
  createdBy                      String?
  name                           String?
  image                          String?
  emailVerified                  DateTime?
  congregation                   String?
  Account                        Account[]
  Session                        Session[]
  user_activity                  user_activity[]
  announcements                  announcements[]
  assignments                    assignments[]
  attendants                     attendants?
  event_attendants               event_attendants[]
  event_permissions              event_permissions[]
  feedback                       feedback[]
  feedback_comments              feedback_comments[]
  oversight_assignments          oversight_assignments[]
  position_assignments           position_assignments[]
  position_oversight_assignments position_oversight_assignments[]
  shift_templates                shift_templates[]
}

enum AssignmentStatus {
  ASSIGNED
  CONFIRMED
  DECLINED
  COMPLETED
  NO_SHOW
}

enum CountSessionStatus {
  ACTIVE
  COMPLETED
  CANCELLED
}

enum DocumentAccessLevel {
  PUBLIC
  ATTENDANTS_ONLY
  LEADERSHIP_ONLY
  DEPARTMENT_SPECIFIC
  POSITION_SPECIFIC
  ADMIN_ONLY
}

enum DocumentCategory {
  EMERGENCY_INFO
  POSITION_INSTRUCTIONS
  EVENT_DOCUMENTATION
  TRAINING_MATERIALS
  ANNOUNCEMENTS
  FORMS
  REPORTS
  OTHER
}

enum EventPermissionRole {
  OWNER
  MANAGER
  OVERSEER
  KEYMAN
  VIEWER
}

enum EventScopeType {
  DEPARTMENT
  STATION_RANGE
  POSITION
}

enum EventStatus {
  UPCOMING
  CURRENT
  COMPLETED
  CANCELLED
  ARCHIVED
}

enum EventType {
  CIRCUIT_ASSEMBLY
  REGIONAL_CONVENTION
  SPECIAL_EVENT
  OTHER
}

enum ExperienceLevel {
  BEGINNER
  INTERMEDIATE
  EXPERIENCED
  EXPERT
}

enum FeedbackPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum FeedbackStatus {
  NEW
  IN_PROGRESS
  RESOLVED
  CLOSED
}

enum FeedbackType {
  BUG
  ENHANCEMENT
  FEATURE
}

enum LanyardStatus {
  AVAILABLE
  CHECKED_OUT
  LOST
  DAMAGED
  RETIRED
}

enum OversightLevel {
  OVERSEER
  ASSISTANT_OVERSEER
  DEPARTMENT_HEAD
  STATION_OVERSEER
}

enum PositionRole {
  OVERSEER
  KEYMAN
  ATTENDANT
}

enum UserRole {
  ADMIN
  OVERSEER
  ASSISTANT_OVERSEER
  KEYMAN
  ATTENDANT
}
